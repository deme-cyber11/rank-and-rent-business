import { supabase } from "/src/lib/supabase.ts";
export class DealStatementsSubAgent {
  name = "deal-statements-subagent";
  description = "Orchestrator for specialized bank statement parsing agents";
  async execute(input, onProgress) {
    const startTime = performance.now();
    const warnings = [];
    try {
      const { files } = input;
      const statementFiles = files.filter((f) => f.category === "statements");
      console.log("[DIAGNOSTIC] ========== STATEMENTS SUBAGENT START ==========");
      console.log("[DIAGNOSTIC] Total files received:", files.length);
      console.log("[DIAGNOSTIC] Files by category:", files.map((f) => ({ name: f.name, category: f.category, hasContent: !!f.content, contentLength: f.content?.length })));
      console.log("[DIAGNOSTIC] Statement files found:", statementFiles.length);
      if (statementFiles.length === 0) {
        onProgress?.({
          stage: "parseStatements",
          status: "skipped",
          message: "No bank statements provided",
          percentage: 100
        });
        return {
          success: true,
          data: {
            statements: [],
            fundingPositions: [],
            threeMonthAverages: void 0,
            confidence: { statements: [] },
            warnings: ["No bank statements provided"]
          },
          duration_ms: Math.round(performance.now() - startTime)
        };
      }
      onProgress?.({
        stage: "parseStatements",
        status: "running",
        message: `Analyzing ${statementFiles.length} bank statement${statementFiles.length > 1 ? "s" : ""} with specialized agents...`,
        percentage: 5
      });
      const payload = statementFiles.map((f) => ({
        name: f.name,
        type: f.type,
        content: f.content
      }));
      console.log(`[deal-statements-subagent] Starting parallel analysis of ${statementFiles.length} statements`);
      onProgress?.({
        stage: "parseStatements",
        status: "running",
        message: "Running specialized analysis agents in parallel...",
        percentage: 10
      });
      const [infoResult, balanceResult, totalsResult, countsResult, positionsResult] = await Promise.all([
        this.callInfoAgent(payload),
        this.callBalanceAgent(payload),
        this.callTotalsAgent(payload),
        this.callCountsAgent(payload),
        this.callPositionsAgent(payload)
      ]);
      console.log("[deal-statements-subagent] All parallel agents completed:", {
        info: infoResult.info.length,
        balances: balanceResult.balances.length,
        totals: totalsResult.totals.length,
        counts: countsResult.counts.length,
        positions: positionsResult.positions.length
      });
      warnings.push(...infoResult.warnings);
      warnings.push(...balanceResult.warnings);
      warnings.push(...totalsResult.warnings);
      warnings.push(...countsResult.warnings);
      warnings.push(...positionsResult.warnings);
      onProgress?.({
        stage: "parseStatements",
        status: "running",
        message: "Combining results from specialized agents...",
        percentage: 60
      });
      const combinedStatements = this.combineResults(
        infoResult.info,
        balanceResult.balances,
        totalsResult.totals,
        countsResult.counts
      );
      console.log("[deal-statements-subagent] Combined statements:", combinedStatements.length);
      onProgress?.({
        stage: "parseStatements",
        status: "running",
        message: "Running quality control checks...",
        percentage: 70
      });
      const qcResult = this.qualityControl(combinedStatements, statementFiles.length);
      if (qcResult.issues.length > 0) {
        console.warn("[deal-statements-subagent] Quality control issues:", qcResult.issues);
        warnings.push(...qcResult.issues);
      }
      if (qcResult.statementsNeedingRetry.length > 0) {
        console.log("[deal-statements-subagent] Retrying statements:", qcResult.statementsNeedingRetry);
        onProgress?.({
          stage: "parseStatements",
          status: "running",
          message: `Re-analyzing ${qcResult.statementsNeedingRetry.length} statement(s) with issues...`,
          percentage: 75
        });
        const retryFiles = payload.filter(
          (f) => qcResult.statementsNeedingRetry.some((s) => f.name.includes(s))
        );
        if (retryFiles.length > 0) {
          const retryResults = await this.retryWithFallback(retryFiles, qcResult.missingFields);
          for (const retry of retryResults) {
            const existing = combinedStatements.find((s) => s.statement_month === retry.statement_month);
            if (existing) {
              if (!existing.has_balance && retry.average_daily_balance !== null) {
                existing.average_daily_balance = retry.average_daily_balance;
                existing.has_balance = true;
              }
              if (!existing.has_totals && retry.credits !== null) {
                existing.credits = retry.credits;
                existing.debits = retry.debits;
                existing.has_totals = true;
              }
              if (!existing.has_counts && retry.deposit_count !== null) {
                existing.nsfs = retry.nsfs;
                existing.overdrafts = retry.overdrafts;
                existing.negative_days = retry.negative_days;
                existing.deposit_count = retry.deposit_count;
                existing.has_counts = true;
              }
            }
          }
        }
      }
      onProgress?.({
        stage: "parseStatements",
        status: "running",
        message: "Calculating averages...",
        percentage: 85
      });
      const averages = this.calculateAverages(combinedStatements);
      const statements = combinedStatements.map((s) => ({
        statement_id: s.statement_id,
        bank_name: s.bank_name,
        statement_month: s.statement_month,
        credits: s.credits ?? 0,
        debits: s.debits ?? 0,
        nsfs: s.nsfs,
        overdrafts: s.overdrafts,
        negative_days: s.negative_days,
        average_daily_balance: s.average_daily_balance ?? 0,
        deposit_count: s.deposit_count ?? 0
      }));
      const fundingPositions = positionsResult.positions;
      console.log("[deal-statements-subagent] Final results:", {
        statements: statements.length,
        fundingPositions: fundingPositions.length,
        threeMonthAvg: averages.threeMonth,
        sixMonthAvg: averages.sixMonth
      });
      onProgress?.({
        stage: "parseStatements",
        status: "success",
        message: `Processed ${statements.length} statement${statements.length !== 1 ? "s" : ""}, found ${fundingPositions.length} funding position${fundingPositions.length !== 1 ? "s" : ""}`,
        percentage: 100
      });
      return {
        success: true,
        data: {
          statements,
          fundingPositions,
          threeMonthAverages: averages.threeMonth,
          sixMonthAverages: averages.sixMonth,
          confidence: {
            statements: statements.map(() => qcResult.overallConfidence)
          },
          warnings: warnings.length > 0 ? warnings : []
        },
        warnings: warnings.length > 0 ? warnings : void 0,
        duration_ms: Math.round(performance.now() - startTime)
      };
    } catch (err) {
      console.error("[deal-statements-subagent] Error:", err);
      onProgress?.({
        stage: "parseStatements",
        status: "error",
        message: err instanceof Error ? err.message : "Statement parsing failed",
        percentage: 100
      });
      return {
        success: false,
        error: err instanceof Error ? err.message : "Unknown error during statement parsing",
        warnings: warnings.length > 0 ? warnings : void 0,
        duration_ms: Math.round(performance.now() - startTime)
      };
    }
  }
  // ================================================================
  // SPECIALIZED AGENT CALLS
  // ================================================================
  async callInfoAgent(files) {
    console.log("[DIAGNOSTIC] callInfoAgent START - files:", files.length);
    const startTime = performance.now();
    try {
      console.log("[DIAGNOSTIC] Invoking parse-statement-info edge function...");
      const { data, error } = await supabase.functions.invoke("parse-statement-info", {
        body: { files }
      });
      const duration = Math.round(performance.now() - startTime);
      console.log("[DIAGNOSTIC] parse-statement-info response:", { duration: `${duration}ms`, error: error?.message, dataKeys: data ? Object.keys(data) : null });
      if (error) {
        console.error("[DIAGNOSTIC] Info agent FAILED:", error);
        return { info: [], warnings: [`Info agent failed: ${error.message}`] };
      }
      const result = {
        info: Array.isArray(data?.info) ? data.info : [],
        warnings: Array.isArray(data?.warnings) ? data.warnings : []
      };
      console.log("[DIAGNOSTIC] Info agent SUCCESS:", { infoCount: result.info.length, warningCount: result.warnings.length, infoData: JSON.stringify(result.info) });
      return result;
    } catch (err) {
      console.error("[DIAGNOSTIC] Info agent EXCEPTION:", err);
      return { info: [], warnings: [`Info agent exception: ${err}`] };
    }
  }
  async callBalanceAgent(files) {
    console.log("[DIAGNOSTIC] callBalanceAgent START - files:", files.length);
    const startTime = performance.now();
    try {
      console.log("[DIAGNOSTIC] Invoking parse-statement-balance edge function...");
      const { data, error } = await supabase.functions.invoke("parse-statement-balance", {
        body: { files }
      });
      const duration = Math.round(performance.now() - startTime);
      console.log("[DIAGNOSTIC] parse-statement-balance response:", { duration: `${duration}ms`, error: error?.message, dataKeys: data ? Object.keys(data) : null });
      if (error) {
        console.error("[DIAGNOSTIC] Balance agent FAILED:", error);
        return { balances: [], warnings: [`Balance agent failed: ${error.message}`] };
      }
      const result = {
        balances: Array.isArray(data?.balances) ? data.balances : [],
        warnings: Array.isArray(data?.warnings) ? data.warnings : []
      };
      console.log("[DIAGNOSTIC] Balance agent SUCCESS:", { balanceCount: result.balances.length, warningCount: result.warnings.length, balanceData: JSON.stringify(result.balances) });
      return result;
    } catch (err) {
      console.error("[DIAGNOSTIC] Balance agent EXCEPTION:", err);
      return { balances: [], warnings: [`Balance agent exception: ${err}`] };
    }
  }
  async callTotalsAgent(files) {
    console.log("[DIAGNOSTIC] callTotalsAgent START - files:", files.length);
    const startTime = performance.now();
    try {
      console.log("[DIAGNOSTIC] Invoking parse-statement-totals edge function...");
      const { data, error } = await supabase.functions.invoke("parse-statement-totals", {
        body: { files }
      });
      const duration = Math.round(performance.now() - startTime);
      console.log("[DIAGNOSTIC] parse-statement-totals response:", { duration: `${duration}ms`, error: error?.message, dataKeys: data ? Object.keys(data) : null });
      if (error) {
        console.error("[DIAGNOSTIC] Totals agent FAILED:", error);
        return { totals: [], warnings: [`Totals agent failed: ${error.message}`] };
      }
      const result = {
        totals: Array.isArray(data?.totals) ? data.totals : [],
        warnings: Array.isArray(data?.warnings) ? data.warnings : []
      };
      console.log("[DIAGNOSTIC] Totals agent SUCCESS:", { totalsCount: result.totals.length, warningCount: result.warnings.length, totalsData: JSON.stringify(result.totals) });
      return result;
    } catch (err) {
      console.error("[DIAGNOSTIC] Totals agent EXCEPTION:", err);
      return { totals: [], warnings: [`Totals agent exception: ${err}`] };
    }
  }
  async callCountsAgent(files) {
    console.log("[DIAGNOSTIC] callCountsAgent START - files:", files.length);
    const startTime = performance.now();
    try {
      console.log("[DIAGNOSTIC] Invoking parse-statement-counts edge function...");
      const { data, error } = await supabase.functions.invoke("parse-statement-counts", {
        body: { files }
      });
      const duration = Math.round(performance.now() - startTime);
      console.log("[DIAGNOSTIC] parse-statement-counts response:", { duration: `${duration}ms`, error: error?.message, dataKeys: data ? Object.keys(data) : null });
      if (error) {
        console.error("[DIAGNOSTIC] Counts agent FAILED:", error);
        return { counts: [], warnings: [`Counts agent failed: ${error.message}`] };
      }
      const result = {
        counts: Array.isArray(data?.counts) ? data.counts : [],
        warnings: Array.isArray(data?.warnings) ? data.warnings : []
      };
      console.log("[DIAGNOSTIC] Counts agent SUCCESS:", { countsCount: result.counts.length, warningCount: result.warnings.length, countsData: JSON.stringify(result.counts) });
      return result;
    } catch (err) {
      console.error("[DIAGNOSTIC] Counts agent EXCEPTION:", err);
      return { counts: [], warnings: [`Counts agent exception: ${err}`] };
    }
  }
  async callPositionsAgent(files) {
    console.log("[DIAGNOSTIC] callPositionsAgent START - files:", files.length);
    const startTime = performance.now();
    try {
      console.log("[DIAGNOSTIC] Invoking parse-statement-positions edge function...");
      const { data, error } = await supabase.functions.invoke("parse-statement-positions", {
        body: { files }
      });
      const duration = Math.round(performance.now() - startTime);
      console.log("[DIAGNOSTIC] parse-statement-positions response:", { duration: `${duration}ms`, error: error?.message, dataKeys: data ? Object.keys(data) : null });
      if (error) {
        console.error("[DIAGNOSTIC] Positions agent FAILED:", error);
        return { positions: [], warnings: [`Positions agent failed: ${error.message}`] };
      }
      const result = {
        positions: Array.isArray(data?.positions) ? data.positions : [],
        warnings: Array.isArray(data?.warnings) ? data.warnings : []
      };
      console.log("[DIAGNOSTIC] Positions agent SUCCESS:", { positionsCount: result.positions.length, warningCount: result.warnings.length, positionsData: JSON.stringify(result.positions) });
      return result;
    } catch (err) {
      console.error("[DIAGNOSTIC] Positions agent EXCEPTION:", err);
      return { positions: [], warnings: [`Positions agent exception: ${err}`] };
    }
  }
  // ================================================================
  // RESULT COMBINATION
  // ================================================================
  combineResults(info, balances, totals, counts) {
    const combined = [];
    for (const stmt of info) {
      const month = stmt.statement_month;
      const balance = balances.find((b) => b.statement_month === month);
      const total = totals.find((t) => t.statement_month === month);
      const count = counts.find((c) => c.statement_month === month);
      combined.push({
        statement_id: stmt.statement_id,
        bank_name: stmt.bank_name,
        statement_month: month,
        credits: total?.credits ?? null,
        debits: total?.debits ?? null,
        nsfs: count?.nsfs ?? 0,
        overdrafts: count?.overdrafts ?? 0,
        negative_days: count?.negative_days ?? 0,
        average_daily_balance: balance?.average_daily_balance ?? null,
        deposit_count: count?.deposit_count ?? null,
        has_balance: balance?.average_daily_balance !== null && balance?.average_daily_balance !== void 0,
        has_totals: total?.credits !== null && total?.credits !== void 0,
        has_counts: count?.deposit_count !== null && count?.deposit_count !== void 0
      });
    }
    const infoMonths = new Set(info.map((i) => i.statement_month));
    for (const balance of balances) {
      if (!infoMonths.has(balance.statement_month)) {
        const total = totals.find((t) => t.statement_month === balance.statement_month);
        const count = counts.find((c) => c.statement_month === balance.statement_month);
        combined.push({
          statement_id: `UNKNOWN_${balance.statement_month}`,
          bank_name: "Unknown",
          statement_month: balance.statement_month,
          credits: total?.credits ?? null,
          debits: total?.debits ?? null,
          nsfs: count?.nsfs ?? 0,
          overdrafts: count?.overdrafts ?? 0,
          negative_days: count?.negative_days ?? 0,
          average_daily_balance: balance.average_daily_balance,
          deposit_count: count?.deposit_count ?? null,
          has_balance: true,
          has_totals: total !== void 0,
          has_counts: count !== void 0
        });
      }
    }
    combined.sort((a, b) => b.statement_month.localeCompare(a.statement_month));
    return combined;
  }
  // ================================================================
  // QUALITY CONTROL
  // ================================================================
  qualityControl(statements, expectedCount) {
    const issues = [];
    const statementsNeedingRetry = [];
    const missingFields = {};
    if (statements.length < expectedCount) {
      issues.push(`Expected ${expectedCount} statements but only got ${statements.length}`);
    }
    for (const stmt of statements) {
      const missing = [];
      if (stmt.average_daily_balance === null) {
        missing.push("average_daily_balance");
      }
      if (stmt.credits === null) {
        missing.push("credits");
      }
      if (stmt.debits === null) {
        missing.push("debits");
      }
      if (stmt.deposit_count === null) {
        missing.push("deposit_count");
      }
      if (missing.length > 0) {
        issues.push(`Statement ${stmt.statement_month} missing: ${missing.join(", ")}`);
        statementsNeedingRetry.push(stmt.statement_month);
        missingFields[stmt.statement_month] = missing;
      }
      if (stmt.average_daily_balance !== null && stmt.average_daily_balance < -1e6) {
        issues.push(`Statement ${stmt.statement_month} has suspiciously low average_daily_balance: ${stmt.average_daily_balance}`);
      }
      if (stmt.credits !== null && stmt.debits !== null) {
        if (stmt.credits < 0) {
          issues.push(`Statement ${stmt.statement_month} has negative credits: ${stmt.credits}`);
        }
        if (stmt.debits < 0) {
          issues.push(`Statement ${stmt.statement_month} has negative debits: ${stmt.debits}`);
        }
      }
    }
    const totalFields = statements.length * 4;
    const missingCount = Object.values(missingFields).flat().length;
    const overallConfidence = totalFields > 0 ? Math.round((totalFields - missingCount) / totalFields * 100) : 0;
    return {
      issues,
      statementsNeedingRetry,
      missingFields,
      overallConfidence
    };
  }
  // ================================================================
  // RETRY WITH FALLBACK (using original monolithic function)
  // ================================================================
  async retryWithFallback(files, _missingFields) {
    try {
      console.log("[deal-statements-subagent] Retrying with fallback parser...");
      const { data, error } = await supabase.functions.invoke("parse-bank-statements", {
        body: { files }
      });
      if (error) {
        console.error("[deal-statements-subagent] Fallback retry failed:", error);
        return [];
      }
      const results = [];
      if (Array.isArray(data?.statements)) {
        for (const stmt of data.statements) {
          results.push({
            statement_id: stmt.statement_id || "unknown",
            bank_name: stmt.bank_name || "Unknown",
            statement_month: stmt.statement_month || "unknown",
            credits: stmt.credits ?? null,
            debits: stmt.debits ?? null,
            nsfs: stmt.nsfs ?? 0,
            overdrafts: stmt.overdrafts ?? 0,
            negative_days: stmt.negative_days ?? 0,
            average_daily_balance: stmt.average_daily_balance ?? null,
            deposit_count: stmt.deposit_count ?? null,
            has_balance: stmt.average_daily_balance !== null,
            has_totals: stmt.credits !== null,
            has_counts: stmt.deposit_count !== null
          });
        }
      }
      return results;
    } catch (err) {
      console.error("[deal-statements-subagent] Fallback retry exception:", err);
      return [];
    }
  }
  // ================================================================
  // CALCULATE AVERAGES
  // ================================================================
  calculateAverages(statements) {
    const sorted = [...statements].sort(
      (a, b) => b.statement_month.localeCompare(a.statement_month)
    );
    const result = {};
    if (sorted.length >= 3) {
      const last3 = sorted.slice(0, 3);
      result.threeMonth = {
        credits: Math.round(
          last3.reduce((sum, s) => sum + (s.credits || 0), 0) / 3
        ),
        debits: Math.round(
          last3.reduce((sum, s) => sum + (s.debits || 0), 0) / 3
        ),
        avgDailyBalance: Math.round(
          last3.reduce((sum, s) => sum + (s.average_daily_balance || 0), 0) / 3
        )
      };
      console.log("[deal-statements-subagent] 3-month averages:", result.threeMonth);
    }
    if (sorted.length >= 6) {
      const last6 = sorted.slice(0, 6);
      result.sixMonth = {
        credits: Math.round(
          last6.reduce((sum, s) => sum + (s.credits || 0), 0) / 6
        ),
        debits: Math.round(
          last6.reduce((sum, s) => sum + (s.debits || 0), 0) / 6
        ),
        avgDailyBalance: Math.round(
          last6.reduce((sum, s) => sum + (s.average_daily_balance || 0), 0) / 6
        )
      };
      console.log("[deal-statements-subagent] 6-month averages:", result.sixMonth);
    }
    return result;
  }
}
export const dealStatementsSubAgent = new DealStatementsSubAgent();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlYWwtc3RhdGVtZW50cy1zdWJhZ2VudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIERlYWwgU3RhdGVtZW50cyBTdWItQWdlbnQgKE9yY2hlc3RyYXRvcilcbiAqXG4gKiBUaGlzIGlzIHRoZSBtYWluIG9yY2hlc3RyYXRvciBmb3IgYmFuayBzdGF0ZW1lbnQgcGFyc2luZy5cbiAqIEl0IGNvb3JkaW5hdGVzIDUgc3BlY2lhbGl6ZWQgc3ViLWFnZW50cyB0aGF0IHJ1biBpbiBQQVJBTExFTDpcbiAqXG4gKiAxLiBTdGF0ZW1lbnQgSW5mbyBBZ2VudCAtIEV4dHJhY3RzIGJhbmsgbmFtZSwgc3RhdGVtZW50IG1vbnRoLCBJRFxuICogMi4gU3RhdGVtZW50IEJhbGFuY2UgQWdlbnQgLSBDYWxjdWxhdGVzIGF2ZXJhZ2UgZGFpbHkgYmFsYW5jZVxuICogMy4gU3RhdGVtZW50IFRvdGFscyBBZ2VudCAtIENhbGN1bGF0ZXMgY3JlZGl0cyBhbmQgZGViaXRzXG4gKiA0LiBTdGF0ZW1lbnQgQ291bnRzIEFnZW50IC0gQ291bnRzIE5TRnMsIG5lZ2F0aXZlIGRheXMsIG92ZXJkcmFmdHMsIGRlcG9zaXRzXG4gKiA1LiBTdGF0ZW1lbnQgUG9zaXRpb25zIEFnZW50IC0gRGV0ZWN0cyBleGlzdGluZyBmdW5kaW5nIHBvc2l0aW9uc1xuICpcbiAqIEFmdGVyIGFsbCBhZ2VudHMgY29tcGxldGUsIGEgUXVhbGl0eSBDb250cm9sIHN0ZXAgdmFsaWRhdGVzIHRoZSBkYXRhXG4gKiBhbmQgdHJpZ2dlcnMgcmUtcnVucyBmb3IgYW55IHN0YXRlbWVudHMgd2l0aCBpbnN1ZmZpY2llbnQgZGF0YS5cbiAqXG4gKiBGaW5hbGx5LCBpdCBjYWxjdWxhdGVzIDMtbW9udGggYW5kIDYtbW9udGggYXZlcmFnZXMuXG4gKi9cblxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICcuLi9saWIvc3VwYWJhc2UnO1xuaW1wb3J0IHR5cGUge1xuICBTdWJBZ2VudCxcbiAgQWdlbnRTdGVwUmVzdWx0LFxuICBBZ2VudFByb2dyZXNzQ2FsbGJhY2ssXG4gIFVwbG9hZEZpbGVJbmZvLFxuICBQYXJzZWRTdGF0ZW1lbnREYXRhXG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXRlbWVudHNTdWJBZ2VudElucHV0IHtcbiAgZmlsZXM6IFVwbG9hZEZpbGVJbmZvW107XG59XG5cbi8vIFR5cGVzIGZvciB0aGUgc3BlY2lhbGl6ZWQgZWRnZSBmdW5jdGlvbiByZXNwb25zZXNcbmludGVyZmFjZSBTdGF0ZW1lbnRJbmZvIHtcbiAgc3RhdGVtZW50X2lkOiBzdHJpbmc7XG4gIGJhbmtfbmFtZTogc3RyaW5nO1xuICBzdGF0ZW1lbnRfbW9udGg6IHN0cmluZztcbiAgZmlsZV9uYW1lOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBCYWxhbmNlUmVzdWx0IHtcbiAgc3RhdGVtZW50X21vbnRoOiBzdHJpbmc7XG4gIGF2ZXJhZ2VfZGFpbHlfYmFsYW5jZTogbnVtYmVyO1xuICBjYWxjdWxhdGlvbl9tZXRob2Q6IHN0cmluZztcbiAgZGF5c19jb3VudGVkOiBudW1iZXI7XG4gIG1pbl9iYWxhbmNlOiBudW1iZXI7XG4gIG1heF9iYWxhbmNlOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBUb3RhbHNSZXN1bHQge1xuICBzdGF0ZW1lbnRfbW9udGg6IHN0cmluZztcbiAgY3JlZGl0czogbnVtYmVyO1xuICBkZWJpdHM6IG51bWJlcjtcbiAgbmV0X2NoYW5nZTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgQ291bnRzUmVzdWx0IHtcbiAgc3RhdGVtZW50X21vbnRoOiBzdHJpbmc7XG4gIG5zZnM6IG51bWJlcjtcbiAgbmVnYXRpdmVfZGF5czogbnVtYmVyO1xuICBvdmVyZHJhZnRzOiBudW1iZXI7XG4gIGRlcG9zaXRfY291bnQ6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIEZ1bmRpbmdQb3NpdGlvbiB7XG4gIGxlbmRlcl9uYW1lOiBzdHJpbmc7XG4gIGFtb3VudDogbnVtYmVyO1xuICBmcmVxdWVuY3k6ICdkYWlseScgfCAnd2Vla2x5JyB8ICdtb250aGx5JztcbiAgZGV0ZWN0ZWRfZGF0ZXM6IHN0cmluZ1tdO1xuICBzdGF0ZW1lbnRfbW9udGg6IHN0cmluZztcbn1cblxuLy8gQ29tYmluZWQgc3RhdGVtZW50IGRhdGEgZnJvbSBhbGwgc3ViLWFnZW50c1xuaW50ZXJmYWNlIENvbWJpbmVkU3RhdGVtZW50RGF0YSB7XG4gIHN0YXRlbWVudF9pZDogc3RyaW5nO1xuICBiYW5rX25hbWU6IHN0cmluZztcbiAgc3RhdGVtZW50X21vbnRoOiBzdHJpbmc7XG4gIGNyZWRpdHM6IG51bWJlciB8IG51bGw7XG4gIGRlYml0czogbnVtYmVyIHwgbnVsbDtcbiAgbnNmczogbnVtYmVyO1xuICBvdmVyZHJhZnRzOiBudW1iZXI7XG4gIG5lZ2F0aXZlX2RheXM6IG51bWJlcjtcbiAgYXZlcmFnZV9kYWlseV9iYWxhbmNlOiBudW1iZXIgfCBudWxsO1xuICBkZXBvc2l0X2NvdW50OiBudW1iZXIgfCBudWxsO1xuICAvLyBRdWFsaXR5IGZsYWdzXG4gIGhhc19iYWxhbmNlOiBib29sZWFuO1xuICBoYXNfdG90YWxzOiBib29sZWFuO1xuICBoYXNfY291bnRzOiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgRGVhbFN0YXRlbWVudHNTdWJBZ2VudCBpbXBsZW1lbnRzIFN1YkFnZW50PFN0YXRlbWVudHNTdWJBZ2VudElucHV0LCBQYXJzZWRTdGF0ZW1lbnREYXRhPiB7XG4gIG5hbWUgPSAnZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50JztcbiAgZGVzY3JpcHRpb24gPSAnT3JjaGVzdHJhdG9yIGZvciBzcGVjaWFsaXplZCBiYW5rIHN0YXRlbWVudCBwYXJzaW5nIGFnZW50cyc7XG5cbiAgYXN5bmMgZXhlY3V0ZShcbiAgICBpbnB1dDogU3RhdGVtZW50c1N1YkFnZW50SW5wdXQsXG4gICAgb25Qcm9ncmVzcz86IEFnZW50UHJvZ3Jlc3NDYWxsYmFja1xuICApOiBQcm9taXNlPEFnZW50U3RlcFJlc3VsdDxQYXJzZWRTdGF0ZW1lbnREYXRhPj4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGNvbnN0IHdhcm5pbmdzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZmlsZXMgfSA9IGlucHV0O1xuXG4gICAgICAvLyBGaWx0ZXIgdG8gb25seSBzdGF0ZW1lbnQgZmlsZXNcbiAgICAgIGNvbnN0IHN0YXRlbWVudEZpbGVzID0gZmlsZXMuZmlsdGVyKGYgPT4gZi5jYXRlZ29yeSA9PT0gJ3N0YXRlbWVudHMnKTtcblxuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSA9PT09PT09PT09IFNUQVRFTUVOVFMgU1VCQUdFTlQgU1RBUlQgPT09PT09PT09PScpO1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBUb3RhbCBmaWxlcyByZWNlaXZlZDonLCBmaWxlcy5sZW5ndGgpO1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBGaWxlcyBieSBjYXRlZ29yeTonLCBmaWxlcy5tYXAoZiA9PiAoeyBuYW1lOiBmLm5hbWUsIGNhdGVnb3J5OiBmLmNhdGVnb3J5LCBoYXNDb250ZW50OiAhIWYuY29udGVudCwgY29udGVudExlbmd0aDogZi5jb250ZW50Py5sZW5ndGggfSkpKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbRElBR05PU1RJQ10gU3RhdGVtZW50IGZpbGVzIGZvdW5kOicsIHN0YXRlbWVudEZpbGVzLmxlbmd0aCk7XG5cbiAgICAgIGlmIChzdGF0ZW1lbnRGaWxlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgb25Qcm9ncmVzcz8uKHtcbiAgICAgICAgICBzdGFnZTogJ3BhcnNlU3RhdGVtZW50cycsXG4gICAgICAgICAgc3RhdHVzOiAnc2tpcHBlZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ05vIGJhbmsgc3RhdGVtZW50cyBwcm92aWRlZCcsXG4gICAgICAgICAgcGVyY2VudGFnZTogMTAwLFxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgc3RhdGVtZW50czogW10sXG4gICAgICAgICAgICBmdW5kaW5nUG9zaXRpb25zOiBbXSxcbiAgICAgICAgICAgIHRocmVlTW9udGhBdmVyYWdlczogdW5kZWZpbmVkLFxuICAgICAgICAgICAgY29uZmlkZW5jZTogeyBzdGF0ZW1lbnRzOiBbXSB9LFxuICAgICAgICAgICAgd2FybmluZ3M6IFsnTm8gYmFuayBzdGF0ZW1lbnRzIHByb3ZpZGVkJ10sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkdXJhdGlvbl9tczogTWF0aC5yb3VuZChwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZSksXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIG9uUHJvZ3Jlc3M/Lih7XG4gICAgICAgIHN0YWdlOiAncGFyc2VTdGF0ZW1lbnRzJyxcbiAgICAgICAgc3RhdHVzOiAncnVubmluZycsXG4gICAgICAgIG1lc3NhZ2U6IGBBbmFseXppbmcgJHtzdGF0ZW1lbnRGaWxlcy5sZW5ndGh9IGJhbmsgc3RhdGVtZW50JHtzdGF0ZW1lbnRGaWxlcy5sZW5ndGggPiAxID8gJ3MnIDogJyd9IHdpdGggc3BlY2lhbGl6ZWQgYWdlbnRzLi4uYCxcbiAgICAgICAgcGVyY2VudGFnZTogNSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBQcmVwYXJlIHBheWxvYWQgZm9yIGVkZ2UgZnVuY3Rpb25zXG4gICAgICBjb25zdCBwYXlsb2FkID0gc3RhdGVtZW50RmlsZXMubWFwKGYgPT4gKHtcbiAgICAgICAgbmFtZTogZi5uYW1lLFxuICAgICAgICB0eXBlOiBmLnR5cGUsXG4gICAgICAgIGNvbnRlbnQ6IGYuY29udGVudCxcbiAgICAgIH0pKTtcblxuICAgICAgY29uc29sZS5sb2coYFtkZWFsLXN0YXRlbWVudHMtc3ViYWdlbnRdIFN0YXJ0aW5nIHBhcmFsbGVsIGFuYWx5c2lzIG9mICR7c3RhdGVtZW50RmlsZXMubGVuZ3RofSBzdGF0ZW1lbnRzYCk7XG5cbiAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgIC8vIFNURVAgMTogUnVuIGFsbCA1IHNwZWNpYWxpemVkIGFnZW50cyBpbiBQQVJBTExFTFxuICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgICAgb25Qcm9ncmVzcz8uKHtcbiAgICAgICAgc3RhZ2U6ICdwYXJzZVN0YXRlbWVudHMnLFxuICAgICAgICBzdGF0dXM6ICdydW5uaW5nJyxcbiAgICAgICAgbWVzc2FnZTogJ1J1bm5pbmcgc3BlY2lhbGl6ZWQgYW5hbHlzaXMgYWdlbnRzIGluIHBhcmFsbGVsLi4uJyxcbiAgICAgICAgcGVyY2VudGFnZTogMTAsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgW2luZm9SZXN1bHQsIGJhbGFuY2VSZXN1bHQsIHRvdGFsc1Jlc3VsdCwgY291bnRzUmVzdWx0LCBwb3NpdGlvbnNSZXN1bHRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICB0aGlzLmNhbGxJbmZvQWdlbnQocGF5bG9hZCksXG4gICAgICAgIHRoaXMuY2FsbEJhbGFuY2VBZ2VudChwYXlsb2FkKSxcbiAgICAgICAgdGhpcy5jYWxsVG90YWxzQWdlbnQocGF5bG9hZCksXG4gICAgICAgIHRoaXMuY2FsbENvdW50c0FnZW50KHBheWxvYWQpLFxuICAgICAgICB0aGlzLmNhbGxQb3NpdGlvbnNBZ2VudChwYXlsb2FkKSxcbiAgICAgIF0pO1xuXG4gICAgICBjb25zb2xlLmxvZygnW2RlYWwtc3RhdGVtZW50cy1zdWJhZ2VudF0gQWxsIHBhcmFsbGVsIGFnZW50cyBjb21wbGV0ZWQ6Jywge1xuICAgICAgICBpbmZvOiBpbmZvUmVzdWx0LmluZm8ubGVuZ3RoLFxuICAgICAgICBiYWxhbmNlczogYmFsYW5jZVJlc3VsdC5iYWxhbmNlcy5sZW5ndGgsXG4gICAgICAgIHRvdGFsczogdG90YWxzUmVzdWx0LnRvdGFscy5sZW5ndGgsXG4gICAgICAgIGNvdW50czogY291bnRzUmVzdWx0LmNvdW50cy5sZW5ndGgsXG4gICAgICAgIHBvc2l0aW9uczogcG9zaXRpb25zUmVzdWx0LnBvc2l0aW9ucy5sZW5ndGgsXG4gICAgICB9KTtcblxuICAgICAgLy8gQ29sbGVjdCB3YXJuaW5ncyBmcm9tIGFsbCBhZ2VudHNcbiAgICAgIHdhcm5pbmdzLnB1c2goLi4uaW5mb1Jlc3VsdC53YXJuaW5ncyk7XG4gICAgICB3YXJuaW5ncy5wdXNoKC4uLmJhbGFuY2VSZXN1bHQud2FybmluZ3MpO1xuICAgICAgd2FybmluZ3MucHVzaCguLi50b3RhbHNSZXN1bHQud2FybmluZ3MpO1xuICAgICAgd2FybmluZ3MucHVzaCguLi5jb3VudHNSZXN1bHQud2FybmluZ3MpO1xuICAgICAgd2FybmluZ3MucHVzaCguLi5wb3NpdGlvbnNSZXN1bHQud2FybmluZ3MpO1xuXG4gICAgICBvblByb2dyZXNzPy4oe1xuICAgICAgICBzdGFnZTogJ3BhcnNlU3RhdGVtZW50cycsXG4gICAgICAgIHN0YXR1czogJ3J1bm5pbmcnLFxuICAgICAgICBtZXNzYWdlOiAnQ29tYmluaW5nIHJlc3VsdHMgZnJvbSBzcGVjaWFsaXplZCBhZ2VudHMuLi4nLFxuICAgICAgICBwZXJjZW50YWdlOiA2MCxcbiAgICAgIH0pO1xuXG4gICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAvLyBTVEVQIDI6IENvbWJpbmUgcmVzdWx0cyBmcm9tIGFsbCBhZ2VudHMgYnkgc3RhdGVtZW50X21vbnRoXG4gICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICBjb25zdCBjb21iaW5lZFN0YXRlbWVudHMgPSB0aGlzLmNvbWJpbmVSZXN1bHRzKFxuICAgICAgICBpbmZvUmVzdWx0LmluZm8sXG4gICAgICAgIGJhbGFuY2VSZXN1bHQuYmFsYW5jZXMsXG4gICAgICAgIHRvdGFsc1Jlc3VsdC50b3RhbHMsXG4gICAgICAgIGNvdW50c1Jlc3VsdC5jb3VudHNcbiAgICAgICk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50XSBDb21iaW5lZCBzdGF0ZW1lbnRzOicsIGNvbWJpbmVkU3RhdGVtZW50cy5sZW5ndGgpO1xuXG4gICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAvLyBTVEVQIDM6IFF1YWxpdHkgQ29udHJvbCAtIENoZWNrIGZvciBtaXNzaW5nIGRhdGFcbiAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAgIG9uUHJvZ3Jlc3M/Lih7XG4gICAgICAgIHN0YWdlOiAncGFyc2VTdGF0ZW1lbnRzJyxcbiAgICAgICAgc3RhdHVzOiAncnVubmluZycsXG4gICAgICAgIG1lc3NhZ2U6ICdSdW5uaW5nIHF1YWxpdHkgY29udHJvbCBjaGVja3MuLi4nLFxuICAgICAgICBwZXJjZW50YWdlOiA3MCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBxY1Jlc3VsdCA9IHRoaXMucXVhbGl0eUNvbnRyb2woY29tYmluZWRTdGF0ZW1lbnRzLCBzdGF0ZW1lbnRGaWxlcy5sZW5ndGgpO1xuXG4gICAgICBpZiAocWNSZXN1bHQuaXNzdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdbZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50XSBRdWFsaXR5IGNvbnRyb2wgaXNzdWVzOicsIHFjUmVzdWx0Lmlzc3Vlcyk7XG4gICAgICAgIHdhcm5pbmdzLnB1c2goLi4ucWNSZXN1bHQuaXNzdWVzKTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgcXVhbGl0eSBjb250cm9sIGZpbmRzIHN0YXRlbWVudHMgbmVlZGluZyByZS1wcm9jZXNzaW5nLCByZXRyeSB0aGVtXG4gICAgICBpZiAocWNSZXN1bHQuc3RhdGVtZW50c05lZWRpbmdSZXRyeS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50XSBSZXRyeWluZyBzdGF0ZW1lbnRzOicsIHFjUmVzdWx0LnN0YXRlbWVudHNOZWVkaW5nUmV0cnkpO1xuICAgICAgICBvblByb2dyZXNzPy4oe1xuICAgICAgICAgIHN0YWdlOiAncGFyc2VTdGF0ZW1lbnRzJyxcbiAgICAgICAgICBzdGF0dXM6ICdydW5uaW5nJyxcbiAgICAgICAgICBtZXNzYWdlOiBgUmUtYW5hbHl6aW5nICR7cWNSZXN1bHQuc3RhdGVtZW50c05lZWRpbmdSZXRyeS5sZW5ndGh9IHN0YXRlbWVudChzKSB3aXRoIGlzc3Vlcy4uLmAsXG4gICAgICAgICAgcGVyY2VudGFnZTogNzUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEdldCB0aGUgZmlsZXMgdGhhdCBuZWVkIHJldHJ5XG4gICAgICAgIGNvbnN0IHJldHJ5RmlsZXMgPSBwYXlsb2FkLmZpbHRlcihmID0+XG4gICAgICAgICAgcWNSZXN1bHQuc3RhdGVtZW50c05lZWRpbmdSZXRyeS5zb21lKHMgPT4gZi5uYW1lLmluY2x1ZGVzKHMpKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChyZXRyeUZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCByZXRyeVJlc3VsdHMgPSBhd2FpdCB0aGlzLnJldHJ5V2l0aEZhbGxiYWNrKHJldHJ5RmlsZXMsIHFjUmVzdWx0Lm1pc3NpbmdGaWVsZHMpO1xuXG4gICAgICAgICAgLy8gTWVyZ2UgcmV0cnkgcmVzdWx0cyBpbnRvIGNvbWJpbmVkIHN0YXRlbWVudHNcbiAgICAgICAgICBmb3IgKGNvbnN0IHJldHJ5IG9mIHJldHJ5UmVzdWx0cykge1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBjb21iaW5lZFN0YXRlbWVudHMuZmluZChzID0+IHMuc3RhdGVtZW50X21vbnRoID09PSByZXRyeS5zdGF0ZW1lbnRfbW9udGgpO1xuICAgICAgICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgICAgICAgIC8vIEZpbGwgaW4gbWlzc2luZyBmaWVsZHMgZnJvbSByZXRyeVxuICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nLmhhc19iYWxhbmNlICYmIHJldHJ5LmF2ZXJhZ2VfZGFpbHlfYmFsYW5jZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGV4aXN0aW5nLmF2ZXJhZ2VfZGFpbHlfYmFsYW5jZSA9IHJldHJ5LmF2ZXJhZ2VfZGFpbHlfYmFsYW5jZTtcbiAgICAgICAgICAgICAgICBleGlzdGluZy5oYXNfYmFsYW5jZSA9IHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKCFleGlzdGluZy5oYXNfdG90YWxzICYmIHJldHJ5LmNyZWRpdHMgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBleGlzdGluZy5jcmVkaXRzID0gcmV0cnkuY3JlZGl0cztcbiAgICAgICAgICAgICAgICBleGlzdGluZy5kZWJpdHMgPSByZXRyeS5kZWJpdHM7XG4gICAgICAgICAgICAgICAgZXhpc3RpbmcuaGFzX3RvdGFscyA9IHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKCFleGlzdGluZy5oYXNfY291bnRzICYmIHJldHJ5LmRlcG9zaXRfY291bnQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBleGlzdGluZy5uc2ZzID0gcmV0cnkubnNmcztcbiAgICAgICAgICAgICAgICBleGlzdGluZy5vdmVyZHJhZnRzID0gcmV0cnkub3ZlcmRyYWZ0cztcbiAgICAgICAgICAgICAgICBleGlzdGluZy5uZWdhdGl2ZV9kYXlzID0gcmV0cnkubmVnYXRpdmVfZGF5cztcbiAgICAgICAgICAgICAgICBleGlzdGluZy5kZXBvc2l0X2NvdW50ID0gcmV0cnkuZGVwb3NpdF9jb3VudDtcbiAgICAgICAgICAgICAgICBleGlzdGluZy5oYXNfY291bnRzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICAvLyBTVEVQIDQ6IENhbGN1bGF0ZSAzLW1vbnRoIGFuZCA2LW1vbnRoIGF2ZXJhZ2VzXG4gICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgICBvblByb2dyZXNzPy4oe1xuICAgICAgICBzdGFnZTogJ3BhcnNlU3RhdGVtZW50cycsXG4gICAgICAgIHN0YXR1czogJ3J1bm5pbmcnLFxuICAgICAgICBtZXNzYWdlOiAnQ2FsY3VsYXRpbmcgYXZlcmFnZXMuLi4nLFxuICAgICAgICBwZXJjZW50YWdlOiA4NSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBhdmVyYWdlcyA9IHRoaXMuY2FsY3VsYXRlQXZlcmFnZXMoY29tYmluZWRTdGF0ZW1lbnRzKTtcblxuICAgICAgLy8gQ29udmVydCB0byBmaW5hbCBvdXRwdXQgZm9ybWF0IChlbnN1cmUgbm9uLW51bGwgdmFsdWVzKVxuICAgICAgY29uc3Qgc3RhdGVtZW50cyA9IGNvbWJpbmVkU3RhdGVtZW50cy5tYXAocyA9PiAoe1xuICAgICAgICBzdGF0ZW1lbnRfaWQ6IHMuc3RhdGVtZW50X2lkLFxuICAgICAgICBiYW5rX25hbWU6IHMuYmFua19uYW1lLFxuICAgICAgICBzdGF0ZW1lbnRfbW9udGg6IHMuc3RhdGVtZW50X21vbnRoLFxuICAgICAgICBjcmVkaXRzOiBzLmNyZWRpdHMgPz8gMCxcbiAgICAgICAgZGViaXRzOiBzLmRlYml0cyA/PyAwLFxuICAgICAgICBuc2ZzOiBzLm5zZnMsXG4gICAgICAgIG92ZXJkcmFmdHM6IHMub3ZlcmRyYWZ0cyxcbiAgICAgICAgbmVnYXRpdmVfZGF5czogcy5uZWdhdGl2ZV9kYXlzLFxuICAgICAgICBhdmVyYWdlX2RhaWx5X2JhbGFuY2U6IHMuYXZlcmFnZV9kYWlseV9iYWxhbmNlID8/IDAsXG4gICAgICAgIGRlcG9zaXRfY291bnQ6IHMuZGVwb3NpdF9jb3VudCA/PyAwLFxuICAgICAgfSkpO1xuXG4gICAgICAvLyBBZGQgc3RhdGVtZW50X21vbnRoIHRvIGZ1bmRpbmcgcG9zaXRpb25zXG4gICAgICBjb25zdCBmdW5kaW5nUG9zaXRpb25zID0gcG9zaXRpb25zUmVzdWx0LnBvc2l0aW9ucztcblxuICAgICAgY29uc29sZS5sb2coJ1tkZWFsLXN0YXRlbWVudHMtc3ViYWdlbnRdIEZpbmFsIHJlc3VsdHM6Jywge1xuICAgICAgICBzdGF0ZW1lbnRzOiBzdGF0ZW1lbnRzLmxlbmd0aCxcbiAgICAgICAgZnVuZGluZ1Bvc2l0aW9uczogZnVuZGluZ1Bvc2l0aW9ucy5sZW5ndGgsXG4gICAgICAgIHRocmVlTW9udGhBdmc6IGF2ZXJhZ2VzLnRocmVlTW9udGgsXG4gICAgICAgIHNpeE1vbnRoQXZnOiBhdmVyYWdlcy5zaXhNb250aCxcbiAgICAgIH0pO1xuXG4gICAgICBvblByb2dyZXNzPy4oe1xuICAgICAgICBzdGFnZTogJ3BhcnNlU3RhdGVtZW50cycsXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICBtZXNzYWdlOiBgUHJvY2Vzc2VkICR7c3RhdGVtZW50cy5sZW5ndGh9IHN0YXRlbWVudCR7c3RhdGVtZW50cy5sZW5ndGggIT09IDEgPyAncycgOiAnJ30sIGZvdW5kICR7ZnVuZGluZ1Bvc2l0aW9ucy5sZW5ndGh9IGZ1bmRpbmcgcG9zaXRpb24ke2Z1bmRpbmdQb3NpdGlvbnMubGVuZ3RoICE9PSAxID8gJ3MnIDogJyd9YCxcbiAgICAgICAgcGVyY2VudGFnZTogMTAwLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBzdGF0ZW1lbnRzLFxuICAgICAgICAgIGZ1bmRpbmdQb3NpdGlvbnMsXG4gICAgICAgICAgdGhyZWVNb250aEF2ZXJhZ2VzOiBhdmVyYWdlcy50aHJlZU1vbnRoLFxuICAgICAgICAgIHNpeE1vbnRoQXZlcmFnZXM6IGF2ZXJhZ2VzLnNpeE1vbnRoLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IHtcbiAgICAgICAgICAgIHN0YXRlbWVudHM6IHN0YXRlbWVudHMubWFwKCgpID0+IHFjUmVzdWx0Lm92ZXJhbGxDb25maWRlbmNlKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHdhcm5pbmdzOiB3YXJuaW5ncy5sZW5ndGggPiAwID8gd2FybmluZ3MgOiBbXSxcbiAgICAgICAgfSxcbiAgICAgICAgd2FybmluZ3M6IHdhcm5pbmdzLmxlbmd0aCA+IDAgPyB3YXJuaW5ncyA6IHVuZGVmaW5lZCxcbiAgICAgICAgZHVyYXRpb25fbXM6IE1hdGgucm91bmQocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUpLFxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignW2RlYWwtc3RhdGVtZW50cy1zdWJhZ2VudF0gRXJyb3I6JywgZXJyKTtcblxuICAgICAgb25Qcm9ncmVzcz8uKHtcbiAgICAgICAgc3RhZ2U6ICdwYXJzZVN0YXRlbWVudHMnLFxuICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnU3RhdGVtZW50IHBhcnNpbmcgZmFpbGVkJyxcbiAgICAgICAgcGVyY2VudGFnZTogMTAwLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIGR1cmluZyBzdGF0ZW1lbnQgcGFyc2luZycsXG4gICAgICAgIHdhcm5pbmdzOiB3YXJuaW5ncy5sZW5ndGggPiAwID8gd2FybmluZ3MgOiB1bmRlZmluZWQsXG4gICAgICAgIGR1cmF0aW9uX21zOiBNYXRoLnJvdW5kKHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lKSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBTUEVDSUFMSVpFRCBBR0VOVCBDQUxMU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxsSW5mb0FnZW50KGZpbGVzOiBhbnlbXSk6IFByb21pc2U8eyBpbmZvOiBTdGF0ZW1lbnRJbmZvW107IHdhcm5pbmdzOiBzdHJpbmdbXSB9PiB7XG4gICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBjYWxsSW5mb0FnZW50IFNUQVJUIC0gZmlsZXM6JywgZmlsZXMubGVuZ3RoKTtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBJbnZva2luZyBwYXJzZS1zdGF0ZW1lbnQtaW5mbyBlZGdlIGZ1bmN0aW9uLi4uJyk7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mdW5jdGlvbnMuaW52b2tlKCdwYXJzZS1zdGF0ZW1lbnQtaW5mbycsIHtcbiAgICAgICAgYm9keTogeyBmaWxlcyB9LFxuICAgICAgfSk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IE1hdGgucm91bmQocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUpO1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBwYXJzZS1zdGF0ZW1lbnQtaW5mbyByZXNwb25zZTonLCB7IGR1cmF0aW9uOiBgJHtkdXJhdGlvbn1tc2AsIGVycm9yOiBlcnJvcj8ubWVzc2FnZSwgZGF0YUtleXM6IGRhdGEgPyBPYmplY3Qua2V5cyhkYXRhKSA6IG51bGwgfSk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRElBR05PU1RJQ10gSW5mbyBhZ2VudCBGQUlMRUQ6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBpbmZvOiBbXSwgd2FybmluZ3M6IFtgSW5mbyBhZ2VudCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gXSB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICAgIGluZm86IEFycmF5LmlzQXJyYXkoZGF0YT8uaW5mbykgPyBkYXRhLmluZm8gOiBbXSxcbiAgICAgICAgd2FybmluZ3M6IEFycmF5LmlzQXJyYXkoZGF0YT8ud2FybmluZ3MpID8gZGF0YS53YXJuaW5ncyA6IFtdLFxuICAgICAgfTtcbiAgICAgIGNvbnNvbGUubG9nKCdbRElBR05PU1RJQ10gSW5mbyBhZ2VudCBTVUNDRVNTOicsIHsgaW5mb0NvdW50OiByZXN1bHQuaW5mby5sZW5ndGgsIHdhcm5pbmdDb3VudDogcmVzdWx0Lndhcm5pbmdzLmxlbmd0aCwgaW5mb0RhdGE6IEpTT04uc3RyaW5naWZ5KHJlc3VsdC5pbmZvKSB9KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRElBR05PU1RJQ10gSW5mbyBhZ2VudCBFWENFUFRJT046JywgZXJyKTtcbiAgICAgIHJldHVybiB7IGluZm86IFtdLCB3YXJuaW5nczogW2BJbmZvIGFnZW50IGV4Y2VwdGlvbjogJHtlcnJ9YF0gfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGxCYWxhbmNlQWdlbnQoZmlsZXM6IGFueVtdKTogUHJvbWlzZTx7IGJhbGFuY2VzOiBCYWxhbmNlUmVzdWx0W107IHdhcm5pbmdzOiBzdHJpbmdbXSB9PiB7XG4gICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBjYWxsQmFsYW5jZUFnZW50IFNUQVJUIC0gZmlsZXM6JywgZmlsZXMubGVuZ3RoKTtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBJbnZva2luZyBwYXJzZS1zdGF0ZW1lbnQtYmFsYW5jZSBlZGdlIGZ1bmN0aW9uLi4uJyk7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mdW5jdGlvbnMuaW52b2tlKCdwYXJzZS1zdGF0ZW1lbnQtYmFsYW5jZScsIHtcbiAgICAgICAgYm9keTogeyBmaWxlcyB9LFxuICAgICAgfSk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IE1hdGgucm91bmQocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUpO1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBwYXJzZS1zdGF0ZW1lbnQtYmFsYW5jZSByZXNwb25zZTonLCB7IGR1cmF0aW9uOiBgJHtkdXJhdGlvbn1tc2AsIGVycm9yOiBlcnJvcj8ubWVzc2FnZSwgZGF0YUtleXM6IGRhdGEgPyBPYmplY3Qua2V5cyhkYXRhKSA6IG51bGwgfSk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRElBR05PU1RJQ10gQmFsYW5jZSBhZ2VudCBGQUlMRUQ6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBiYWxhbmNlczogW10sIHdhcm5pbmdzOiBbYEJhbGFuY2UgYWdlbnQgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YF0gfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICBiYWxhbmNlczogQXJyYXkuaXNBcnJheShkYXRhPy5iYWxhbmNlcykgPyBkYXRhLmJhbGFuY2VzIDogW10sXG4gICAgICAgIHdhcm5pbmdzOiBBcnJheS5pc0FycmF5KGRhdGE/Lndhcm5pbmdzKSA/IGRhdGEud2FybmluZ3MgOiBbXSxcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZygnW0RJQUdOT1NUSUNdIEJhbGFuY2UgYWdlbnQgU1VDQ0VTUzonLCB7IGJhbGFuY2VDb3VudDogcmVzdWx0LmJhbGFuY2VzLmxlbmd0aCwgd2FybmluZ0NvdW50OiByZXN1bHQud2FybmluZ3MubGVuZ3RoLCBiYWxhbmNlRGF0YTogSlNPTi5zdHJpbmdpZnkocmVzdWx0LmJhbGFuY2VzKSB9KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRElBR05PU1RJQ10gQmFsYW5jZSBhZ2VudCBFWENFUFRJT046JywgZXJyKTtcbiAgICAgIHJldHVybiB7IGJhbGFuY2VzOiBbXSwgd2FybmluZ3M6IFtgQmFsYW5jZSBhZ2VudCBleGNlcHRpb246ICR7ZXJyfWBdIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxsVG90YWxzQWdlbnQoZmlsZXM6IGFueVtdKTogUHJvbWlzZTx7IHRvdGFsczogVG90YWxzUmVzdWx0W107IHdhcm5pbmdzOiBzdHJpbmdbXSB9PiB7XG4gICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBjYWxsVG90YWxzQWdlbnQgU1RBUlQgLSBmaWxlczonLCBmaWxlcy5sZW5ndGgpO1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygnW0RJQUdOT1NUSUNdIEludm9raW5nIHBhcnNlLXN0YXRlbWVudC10b3RhbHMgZWRnZSBmdW5jdGlvbi4uLicpO1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnVuY3Rpb25zLmludm9rZSgncGFyc2Utc3RhdGVtZW50LXRvdGFscycsIHtcbiAgICAgICAgYm9keTogeyBmaWxlcyB9LFxuICAgICAgfSk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IE1hdGgucm91bmQocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWUpO1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBwYXJzZS1zdGF0ZW1lbnQtdG90YWxzIHJlc3BvbnNlOicsIHsgZHVyYXRpb246IGAke2R1cmF0aW9ufW1zYCwgZXJyb3I6IGVycm9yPy5tZXNzYWdlLCBkYXRhS2V5czogZGF0YSA/IE9iamVjdC5rZXlzKGRhdGEpIDogbnVsbCB9KTtcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tESUFHTk9TVElDXSBUb3RhbHMgYWdlbnQgRkFJTEVEOicsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgdG90YWxzOiBbXSwgd2FybmluZ3M6IFtgVG90YWxzIGFnZW50IGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWBdIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgdG90YWxzOiBBcnJheS5pc0FycmF5KGRhdGE/LnRvdGFscykgPyBkYXRhLnRvdGFscyA6IFtdLFxuICAgICAgICB3YXJuaW5nczogQXJyYXkuaXNBcnJheShkYXRhPy53YXJuaW5ncykgPyBkYXRhLndhcm5pbmdzIDogW10sXG4gICAgICB9O1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBUb3RhbHMgYWdlbnQgU1VDQ0VTUzonLCB7IHRvdGFsc0NvdW50OiByZXN1bHQudG90YWxzLmxlbmd0aCwgd2FybmluZ0NvdW50OiByZXN1bHQud2FybmluZ3MubGVuZ3RoLCB0b3RhbHNEYXRhOiBKU09OLnN0cmluZ2lmeShyZXN1bHQudG90YWxzKSB9KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbRElBR05PU1RJQ10gVG90YWxzIGFnZW50IEVYQ0VQVElPTjonLCBlcnIpO1xuICAgICAgcmV0dXJuIHsgdG90YWxzOiBbXSwgd2FybmluZ3M6IFtgVG90YWxzIGFnZW50IGV4Y2VwdGlvbjogJHtlcnJ9YF0gfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGxDb3VudHNBZ2VudChmaWxlczogYW55W10pOiBQcm9taXNlPHsgY291bnRzOiBDb3VudHNSZXN1bHRbXTsgd2FybmluZ3M6IHN0cmluZ1tdIH0+IHtcbiAgICBjb25zb2xlLmxvZygnW0RJQUdOT1NUSUNdIGNhbGxDb3VudHNBZ2VudCBTVEFSVCAtIGZpbGVzOicsIGZpbGVzLmxlbmd0aCk7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbRElBR05PU1RJQ10gSW52b2tpbmcgcGFyc2Utc3RhdGVtZW50LWNvdW50cyBlZGdlIGZ1bmN0aW9uLi4uJyk7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mdW5jdGlvbnMuaW52b2tlKCdwYXJzZS1zdGF0ZW1lbnQtY291bnRzJywge1xuICAgICAgICBib2R5OiB7IGZpbGVzIH0sXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gTWF0aC5yb3VuZChwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZSk7XG4gICAgICBjb25zb2xlLmxvZygnW0RJQUdOT1NUSUNdIHBhcnNlLXN0YXRlbWVudC1jb3VudHMgcmVzcG9uc2U6JywgeyBkdXJhdGlvbjogYCR7ZHVyYXRpb259bXNgLCBlcnJvcjogZXJyb3I/Lm1lc3NhZ2UsIGRhdGFLZXlzOiBkYXRhID8gT2JqZWN0LmtleXMoZGF0YSkgOiBudWxsIH0pO1xuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW0RJQUdOT1NUSUNdIENvdW50cyBhZ2VudCBGQUlMRUQ6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBjb3VudHM6IFtdLCB3YXJuaW5nczogW2BDb3VudHMgYWdlbnQgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YF0gfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICBjb3VudHM6IEFycmF5LmlzQXJyYXkoZGF0YT8uY291bnRzKSA/IGRhdGEuY291bnRzIDogW10sXG4gICAgICAgIHdhcm5pbmdzOiBBcnJheS5pc0FycmF5KGRhdGE/Lndhcm5pbmdzKSA/IGRhdGEud2FybmluZ3MgOiBbXSxcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZygnW0RJQUdOT1NUSUNdIENvdW50cyBhZ2VudCBTVUNDRVNTOicsIHsgY291bnRzQ291bnQ6IHJlc3VsdC5jb3VudHMubGVuZ3RoLCB3YXJuaW5nQ291bnQ6IHJlc3VsdC53YXJuaW5ncy5sZW5ndGgsIGNvdW50c0RhdGE6IEpTT04uc3RyaW5naWZ5KHJlc3VsdC5jb3VudHMpIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tESUFHTk9TVElDXSBDb3VudHMgYWdlbnQgRVhDRVBUSU9OOicsIGVycik7XG4gICAgICByZXR1cm4geyBjb3VudHM6IFtdLCB3YXJuaW5nczogW2BDb3VudHMgYWdlbnQgZXhjZXB0aW9uOiAke2Vycn1gXSB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsbFBvc2l0aW9uc0FnZW50KGZpbGVzOiBhbnlbXSk6IFByb21pc2U8eyBwb3NpdGlvbnM6IEZ1bmRpbmdQb3NpdGlvbltdOyB3YXJuaW5nczogc3RyaW5nW10gfT4ge1xuICAgIGNvbnNvbGUubG9nKCdbRElBR05PU1RJQ10gY2FsbFBvc2l0aW9uc0FnZW50IFNUQVJUIC0gZmlsZXM6JywgZmlsZXMubGVuZ3RoKTtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1tESUFHTk9TVElDXSBJbnZva2luZyBwYXJzZS1zdGF0ZW1lbnQtcG9zaXRpb25zIGVkZ2UgZnVuY3Rpb24uLi4nKTtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZ1bmN0aW9ucy5pbnZva2UoJ3BhcnNlLXN0YXRlbWVudC1wb3NpdGlvbnMnLCB7XG4gICAgICAgIGJvZHk6IHsgZmlsZXMgfSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBNYXRoLnJvdW5kKHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lKTtcbiAgICAgIGNvbnNvbGUubG9nKCdbRElBR05PU1RJQ10gcGFyc2Utc3RhdGVtZW50LXBvc2l0aW9ucyByZXNwb25zZTonLCB7IGR1cmF0aW9uOiBgJHtkdXJhdGlvbn1tc2AsIGVycm9yOiBlcnJvcj8ubWVzc2FnZSwgZGF0YUtleXM6IGRhdGEgPyBPYmplY3Qua2V5cyhkYXRhKSA6IG51bGwgfSk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbRElBR05PU1RJQ10gUG9zaXRpb25zIGFnZW50IEZBSUxFRDonLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHBvc2l0aW9uczogW10sIHdhcm5pbmdzOiBbYFBvc2l0aW9ucyBhZ2VudCBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gXSB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICAgIHBvc2l0aW9uczogQXJyYXkuaXNBcnJheShkYXRhPy5wb3NpdGlvbnMpID8gZGF0YS5wb3NpdGlvbnMgOiBbXSxcbiAgICAgICAgd2FybmluZ3M6IEFycmF5LmlzQXJyYXkoZGF0YT8ud2FybmluZ3MpID8gZGF0YS53YXJuaW5ncyA6IFtdLFxuICAgICAgfTtcbiAgICAgIGNvbnNvbGUubG9nKCdbRElBR05PU1RJQ10gUG9zaXRpb25zIGFnZW50IFNVQ0NFU1M6JywgeyBwb3NpdGlvbnNDb3VudDogcmVzdWx0LnBvc2l0aW9ucy5sZW5ndGgsIHdhcm5pbmdDb3VudDogcmVzdWx0Lndhcm5pbmdzLmxlbmd0aCwgcG9zaXRpb25zRGF0YTogSlNPTi5zdHJpbmdpZnkocmVzdWx0LnBvc2l0aW9ucykgfSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcignW0RJQUdOT1NUSUNdIFBvc2l0aW9ucyBhZ2VudCBFWENFUFRJT046JywgZXJyKTtcbiAgICAgIHJldHVybiB7IHBvc2l0aW9uczogW10sIHdhcm5pbmdzOiBbYFBvc2l0aW9ucyBhZ2VudCBleGNlcHRpb246ICR7ZXJyfWBdIH07XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBSRVNVTFQgQ09NQklOQVRJT05cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIHByaXZhdGUgY29tYmluZVJlc3VsdHMoXG4gICAgaW5mbzogU3RhdGVtZW50SW5mb1tdLFxuICAgIGJhbGFuY2VzOiBCYWxhbmNlUmVzdWx0W10sXG4gICAgdG90YWxzOiBUb3RhbHNSZXN1bHRbXSxcbiAgICBjb3VudHM6IENvdW50c1Jlc3VsdFtdXG4gICk6IENvbWJpbmVkU3RhdGVtZW50RGF0YVtdIHtcbiAgICAvLyBTdGFydCB3aXRoIGluZm8gYXMgdGhlIGJhc2UgKGl0IGhhcyB0aGUgbW9zdCByZWxpYWJsZSBzdGF0ZW1lbnRfbW9udGggbWFwcGluZylcbiAgICBjb25zdCBjb21iaW5lZDogQ29tYmluZWRTdGF0ZW1lbnREYXRhW10gPSBbXTtcblxuICAgIGZvciAoY29uc3Qgc3RtdCBvZiBpbmZvKSB7XG4gICAgICBjb25zdCBtb250aCA9IHN0bXQuc3RhdGVtZW50X21vbnRoO1xuXG4gICAgICAvLyBGaW5kIG1hdGNoaW5nIGRhdGEgZnJvbSBvdGhlciBhZ2VudHNcbiAgICAgIGNvbnN0IGJhbGFuY2UgPSBiYWxhbmNlcy5maW5kKGIgPT4gYi5zdGF0ZW1lbnRfbW9udGggPT09IG1vbnRoKTtcbiAgICAgIGNvbnN0IHRvdGFsID0gdG90YWxzLmZpbmQodCA9PiB0LnN0YXRlbWVudF9tb250aCA9PT0gbW9udGgpO1xuICAgICAgY29uc3QgY291bnQgPSBjb3VudHMuZmluZChjID0+IGMuc3RhdGVtZW50X21vbnRoID09PSBtb250aCk7XG5cbiAgICAgIGNvbWJpbmVkLnB1c2goe1xuICAgICAgICBzdGF0ZW1lbnRfaWQ6IHN0bXQuc3RhdGVtZW50X2lkLFxuICAgICAgICBiYW5rX25hbWU6IHN0bXQuYmFua19uYW1lLFxuICAgICAgICBzdGF0ZW1lbnRfbW9udGg6IG1vbnRoLFxuICAgICAgICBjcmVkaXRzOiB0b3RhbD8uY3JlZGl0cyA/PyBudWxsLFxuICAgICAgICBkZWJpdHM6IHRvdGFsPy5kZWJpdHMgPz8gbnVsbCxcbiAgICAgICAgbnNmczogY291bnQ/Lm5zZnMgPz8gMCxcbiAgICAgICAgb3ZlcmRyYWZ0czogY291bnQ/Lm92ZXJkcmFmdHMgPz8gMCxcbiAgICAgICAgbmVnYXRpdmVfZGF5czogY291bnQ/Lm5lZ2F0aXZlX2RheXMgPz8gMCxcbiAgICAgICAgYXZlcmFnZV9kYWlseV9iYWxhbmNlOiBiYWxhbmNlPy5hdmVyYWdlX2RhaWx5X2JhbGFuY2UgPz8gbnVsbCxcbiAgICAgICAgZGVwb3NpdF9jb3VudDogY291bnQ/LmRlcG9zaXRfY291bnQgPz8gbnVsbCxcbiAgICAgICAgaGFzX2JhbGFuY2U6IGJhbGFuY2U/LmF2ZXJhZ2VfZGFpbHlfYmFsYW5jZSAhPT0gbnVsbCAmJiBiYWxhbmNlPy5hdmVyYWdlX2RhaWx5X2JhbGFuY2UgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgaGFzX3RvdGFsczogdG90YWw/LmNyZWRpdHMgIT09IG51bGwgJiYgdG90YWw/LmNyZWRpdHMgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgaGFzX2NvdW50czogY291bnQ/LmRlcG9zaXRfY291bnQgIT09IG51bGwgJiYgY291bnQ/LmRlcG9zaXRfY291bnQgIT09IHVuZGVmaW5lZCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFsc28gYWRkIGFueSBzdGF0ZW1lbnRzIGZyb20gb3RoZXIgYWdlbnRzIHRoYXQgd2VyZW4ndCBpbiBpbmZvXG4gICAgY29uc3QgaW5mb01vbnRocyA9IG5ldyBTZXQoaW5mby5tYXAoaSA9PiBpLnN0YXRlbWVudF9tb250aCkpO1xuXG4gICAgZm9yIChjb25zdCBiYWxhbmNlIG9mIGJhbGFuY2VzKSB7XG4gICAgICBpZiAoIWluZm9Nb250aHMuaGFzKGJhbGFuY2Uuc3RhdGVtZW50X21vbnRoKSkge1xuICAgICAgICBjb25zdCB0b3RhbCA9IHRvdGFscy5maW5kKHQgPT4gdC5zdGF0ZW1lbnRfbW9udGggPT09IGJhbGFuY2Uuc3RhdGVtZW50X21vbnRoKTtcbiAgICAgICAgY29uc3QgY291bnQgPSBjb3VudHMuZmluZChjID0+IGMuc3RhdGVtZW50X21vbnRoID09PSBiYWxhbmNlLnN0YXRlbWVudF9tb250aCk7XG5cbiAgICAgICAgY29tYmluZWQucHVzaCh7XG4gICAgICAgICAgc3RhdGVtZW50X2lkOiBgVU5LTk9XTl8ke2JhbGFuY2Uuc3RhdGVtZW50X21vbnRofWAsXG4gICAgICAgICAgYmFua19uYW1lOiAnVW5rbm93bicsXG4gICAgICAgICAgc3RhdGVtZW50X21vbnRoOiBiYWxhbmNlLnN0YXRlbWVudF9tb250aCxcbiAgICAgICAgICBjcmVkaXRzOiB0b3RhbD8uY3JlZGl0cyA/PyBudWxsLFxuICAgICAgICAgIGRlYml0czogdG90YWw/LmRlYml0cyA/PyBudWxsLFxuICAgICAgICAgIG5zZnM6IGNvdW50Py5uc2ZzID8/IDAsXG4gICAgICAgICAgb3ZlcmRyYWZ0czogY291bnQ/Lm92ZXJkcmFmdHMgPz8gMCxcbiAgICAgICAgICBuZWdhdGl2ZV9kYXlzOiBjb3VudD8ubmVnYXRpdmVfZGF5cyA/PyAwLFxuICAgICAgICAgIGF2ZXJhZ2VfZGFpbHlfYmFsYW5jZTogYmFsYW5jZS5hdmVyYWdlX2RhaWx5X2JhbGFuY2UsXG4gICAgICAgICAgZGVwb3NpdF9jb3VudDogY291bnQ/LmRlcG9zaXRfY291bnQgPz8gbnVsbCxcbiAgICAgICAgICBoYXNfYmFsYW5jZTogdHJ1ZSxcbiAgICAgICAgICBoYXNfdG90YWxzOiB0b3RhbCAhPT0gdW5kZWZpbmVkLFxuICAgICAgICAgIGhhc19jb3VudHM6IGNvdW50ICE9PSB1bmRlZmluZWQsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNvcnQgYnkgc3RhdGVtZW50X21vbnRoIGRlc2NlbmRpbmcgKG1vc3QgcmVjZW50IGZpcnN0KVxuICAgIGNvbWJpbmVkLnNvcnQoKGEsIGIpID0+IGIuc3RhdGVtZW50X21vbnRoLmxvY2FsZUNvbXBhcmUoYS5zdGF0ZW1lbnRfbW9udGgpKTtcblxuICAgIHJldHVybiBjb21iaW5lZDtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gUVVBTElUWSBDT05UUk9MXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBwcml2YXRlIHF1YWxpdHlDb250cm9sKFxuICAgIHN0YXRlbWVudHM6IENvbWJpbmVkU3RhdGVtZW50RGF0YVtdLFxuICAgIGV4cGVjdGVkQ291bnQ6IG51bWJlclxuICApOiB7XG4gICAgaXNzdWVzOiBzdHJpbmdbXTtcbiAgICBzdGF0ZW1lbnRzTmVlZGluZ1JldHJ5OiBzdHJpbmdbXTtcbiAgICBtaXNzaW5nRmllbGRzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT47XG4gICAgb3ZlcmFsbENvbmZpZGVuY2U6IG51bWJlcjtcbiAgfSB7XG4gICAgY29uc3QgaXNzdWVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHN0YXRlbWVudHNOZWVkaW5nUmV0cnk6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgbWlzc2luZ0ZpZWxkczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge307XG5cbiAgICAvLyBDaGVjayBpZiB3ZSBnb3QgZGF0YSBmb3IgYWxsIGV4cGVjdGVkIHN0YXRlbWVudHNcbiAgICBpZiAoc3RhdGVtZW50cy5sZW5ndGggPCBleHBlY3RlZENvdW50KSB7XG4gICAgICBpc3N1ZXMucHVzaChgRXhwZWN0ZWQgJHtleHBlY3RlZENvdW50fSBzdGF0ZW1lbnRzIGJ1dCBvbmx5IGdvdCAke3N0YXRlbWVudHMubGVuZ3RofWApO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGVhY2ggc3RhdGVtZW50IGZvciBtaXNzaW5nIGNyaXRpY2FsIGRhdGFcbiAgICBmb3IgKGNvbnN0IHN0bXQgb2Ygc3RhdGVtZW50cykge1xuICAgICAgY29uc3QgbWlzc2luZzogc3RyaW5nW10gPSBbXTtcblxuICAgICAgaWYgKHN0bXQuYXZlcmFnZV9kYWlseV9iYWxhbmNlID09PSBudWxsKSB7XG4gICAgICAgIG1pc3NpbmcucHVzaCgnYXZlcmFnZV9kYWlseV9iYWxhbmNlJyk7XG4gICAgICB9XG4gICAgICBpZiAoc3RtdC5jcmVkaXRzID09PSBudWxsKSB7XG4gICAgICAgIG1pc3NpbmcucHVzaCgnY3JlZGl0cycpO1xuICAgICAgfVxuICAgICAgaWYgKHN0bXQuZGViaXRzID09PSBudWxsKSB7XG4gICAgICAgIG1pc3NpbmcucHVzaCgnZGViaXRzJyk7XG4gICAgICB9XG4gICAgICBpZiAoc3RtdC5kZXBvc2l0X2NvdW50ID09PSBudWxsKSB7XG4gICAgICAgIG1pc3NpbmcucHVzaCgnZGVwb3NpdF9jb3VudCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAobWlzc2luZy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlzc3Vlcy5wdXNoKGBTdGF0ZW1lbnQgJHtzdG10LnN0YXRlbWVudF9tb250aH0gbWlzc2luZzogJHttaXNzaW5nLmpvaW4oJywgJyl9YCk7XG4gICAgICAgIHN0YXRlbWVudHNOZWVkaW5nUmV0cnkucHVzaChzdG10LnN0YXRlbWVudF9tb250aCk7XG4gICAgICAgIG1pc3NpbmdGaWVsZHNbc3RtdC5zdGF0ZW1lbnRfbW9udGhdID0gbWlzc2luZztcbiAgICAgIH1cblxuICAgICAgLy8gU2FuaXR5IGNoZWNrc1xuICAgICAgaWYgKHN0bXQuYXZlcmFnZV9kYWlseV9iYWxhbmNlICE9PSBudWxsICYmIHN0bXQuYXZlcmFnZV9kYWlseV9iYWxhbmNlIDwgLTEwMDAwMDApIHtcbiAgICAgICAgaXNzdWVzLnB1c2goYFN0YXRlbWVudCAke3N0bXQuc3RhdGVtZW50X21vbnRofSBoYXMgc3VzcGljaW91c2x5IGxvdyBhdmVyYWdlX2RhaWx5X2JhbGFuY2U6ICR7c3RtdC5hdmVyYWdlX2RhaWx5X2JhbGFuY2V9YCk7XG4gICAgICB9XG4gICAgICBpZiAoc3RtdC5jcmVkaXRzICE9PSBudWxsICYmIHN0bXQuZGViaXRzICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChzdG10LmNyZWRpdHMgPCAwKSB7XG4gICAgICAgICAgaXNzdWVzLnB1c2goYFN0YXRlbWVudCAke3N0bXQuc3RhdGVtZW50X21vbnRofSBoYXMgbmVnYXRpdmUgY3JlZGl0czogJHtzdG10LmNyZWRpdHN9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0bXQuZGViaXRzIDwgMCkge1xuICAgICAgICAgIGlzc3Vlcy5wdXNoKGBTdGF0ZW1lbnQgJHtzdG10LnN0YXRlbWVudF9tb250aH0gaGFzIG5lZ2F0aXZlIGRlYml0czogJHtzdG10LmRlYml0c31gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBvdmVyYWxsIGNvbmZpZGVuY2VcbiAgICBjb25zdCB0b3RhbEZpZWxkcyA9IHN0YXRlbWVudHMubGVuZ3RoICogNDsgLy8gNCBjcml0aWNhbCBmaWVsZHMgcGVyIHN0YXRlbWVudFxuICAgIGNvbnN0IG1pc3NpbmdDb3VudCA9IE9iamVjdC52YWx1ZXMobWlzc2luZ0ZpZWxkcykuZmxhdCgpLmxlbmd0aDtcbiAgICBjb25zdCBvdmVyYWxsQ29uZmlkZW5jZSA9IHRvdGFsRmllbGRzID4gMFxuICAgICAgPyBNYXRoLnJvdW5kKCgodG90YWxGaWVsZHMgLSBtaXNzaW5nQ291bnQpIC8gdG90YWxGaWVsZHMpICogMTAwKVxuICAgICAgOiAwO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzc3VlcyxcbiAgICAgIHN0YXRlbWVudHNOZWVkaW5nUmV0cnksXG4gICAgICBtaXNzaW5nRmllbGRzLFxuICAgICAgb3ZlcmFsbENvbmZpZGVuY2UsXG4gICAgfTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gUkVUUlkgV0lUSCBGQUxMQkFDSyAodXNpbmcgb3JpZ2luYWwgbW9ub2xpdGhpYyBmdW5jdGlvbilcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIHByaXZhdGUgYXN5bmMgcmV0cnlXaXRoRmFsbGJhY2soXG4gICAgZmlsZXM6IGFueVtdLFxuICAgIF9taXNzaW5nRmllbGRzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT5cbiAgKTogUHJvbWlzZTxDb21iaW5lZFN0YXRlbWVudERhdGFbXT4ge1xuICAgIC8vIEZvciByZXRyeSwgd2UgdXNlIHRoZSBvcmlnaW5hbCBjb21wcmVoZW5zaXZlIHBhcnNlLWJhbmstc3RhdGVtZW50cyBmdW5jdGlvblxuICAgIC8vIGFzIGEgZmFsbGJhY2sgc2luY2UgaXQgbWlnaHQgZXh0cmFjdCBkYXRhIHRoZSBzcGVjaWFsaXplZCBhZ2VudHMgbWlzc2VkXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCdbZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50XSBSZXRyeWluZyB3aXRoIGZhbGxiYWNrIHBhcnNlci4uLicpO1xuXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mdW5jdGlvbnMuaW52b2tlKCdwYXJzZS1iYW5rLXN0YXRlbWVudHMnLCB7XG4gICAgICAgIGJvZHk6IHsgZmlsZXMgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW2RlYWwtc3RhdGVtZW50cy1zdWJhZ2VudF0gRmFsbGJhY2sgcmV0cnkgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHRzOiBDb21iaW5lZFN0YXRlbWVudERhdGFbXSA9IFtdO1xuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhPy5zdGF0ZW1lbnRzKSkge1xuICAgICAgICBmb3IgKGNvbnN0IHN0bXQgb2YgZGF0YS5zdGF0ZW1lbnRzKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgICAgIHN0YXRlbWVudF9pZDogc3RtdC5zdGF0ZW1lbnRfaWQgfHwgJ3Vua25vd24nLFxuICAgICAgICAgICAgYmFua19uYW1lOiBzdG10LmJhbmtfbmFtZSB8fCAnVW5rbm93bicsXG4gICAgICAgICAgICBzdGF0ZW1lbnRfbW9udGg6IHN0bXQuc3RhdGVtZW50X21vbnRoIHx8ICd1bmtub3duJyxcbiAgICAgICAgICAgIGNyZWRpdHM6IHN0bXQuY3JlZGl0cyA/PyBudWxsLFxuICAgICAgICAgICAgZGViaXRzOiBzdG10LmRlYml0cyA/PyBudWxsLFxuICAgICAgICAgICAgbnNmczogc3RtdC5uc2ZzID8/IDAsXG4gICAgICAgICAgICBvdmVyZHJhZnRzOiBzdG10Lm92ZXJkcmFmdHMgPz8gMCxcbiAgICAgICAgICAgIG5lZ2F0aXZlX2RheXM6IHN0bXQubmVnYXRpdmVfZGF5cyA/PyAwLFxuICAgICAgICAgICAgYXZlcmFnZV9kYWlseV9iYWxhbmNlOiBzdG10LmF2ZXJhZ2VfZGFpbHlfYmFsYW5jZSA/PyBudWxsLFxuICAgICAgICAgICAgZGVwb3NpdF9jb3VudDogc3RtdC5kZXBvc2l0X2NvdW50ID8/IG51bGwsXG4gICAgICAgICAgICBoYXNfYmFsYW5jZTogc3RtdC5hdmVyYWdlX2RhaWx5X2JhbGFuY2UgIT09IG51bGwsXG4gICAgICAgICAgICBoYXNfdG90YWxzOiBzdG10LmNyZWRpdHMgIT09IG51bGwsXG4gICAgICAgICAgICBoYXNfY291bnRzOiBzdG10LmRlcG9zaXRfY291bnQgIT09IG51bGwsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdbZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50XSBGYWxsYmFjayByZXRyeSBleGNlcHRpb246JywgZXJyKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENBTENVTEFURSBBVkVSQUdFU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVBdmVyYWdlcyhzdGF0ZW1lbnRzOiBDb21iaW5lZFN0YXRlbWVudERhdGFbXSk6IHtcbiAgICB0aHJlZU1vbnRoPzogeyBjcmVkaXRzOiBudW1iZXI7IGRlYml0czogbnVtYmVyOyBhdmdEYWlseUJhbGFuY2U6IG51bWJlciB9O1xuICAgIHNpeE1vbnRoPzogeyBjcmVkaXRzOiBudW1iZXI7IGRlYml0czogbnVtYmVyOyBhdmdEYWlseUJhbGFuY2U6IG51bWJlciB9O1xuICB9IHtcbiAgICAvLyBTb3J0IHN0YXRlbWVudHMgYnkgbW9udGggKG1vc3QgcmVjZW50IGZpcnN0KVxuICAgIGNvbnN0IHNvcnRlZCA9IFsuLi5zdGF0ZW1lbnRzXS5zb3J0KChhLCBiKSA9PlxuICAgICAgYi5zdGF0ZW1lbnRfbW9udGgubG9jYWxlQ29tcGFyZShhLnN0YXRlbWVudF9tb250aClcbiAgICApO1xuXG4gICAgY29uc3QgcmVzdWx0OiB7XG4gICAgICB0aHJlZU1vbnRoPzogeyBjcmVkaXRzOiBudW1iZXI7IGRlYml0czogbnVtYmVyOyBhdmdEYWlseUJhbGFuY2U6IG51bWJlciB9O1xuICAgICAgc2l4TW9udGg/OiB7IGNyZWRpdHM6IG51bWJlcjsgZGViaXRzOiBudW1iZXI7IGF2Z0RhaWx5QmFsYW5jZTogbnVtYmVyIH07XG4gICAgfSA9IHt9O1xuXG4gICAgLy8gQ2FsY3VsYXRlIDMtbW9udGggYXZlcmFnZSBpZiB3ZSBoYXZlIGF0IGxlYXN0IDMgc3RhdGVtZW50c1xuICAgIGlmIChzb3J0ZWQubGVuZ3RoID49IDMpIHtcbiAgICAgIGNvbnN0IGxhc3QzID0gc29ydGVkLnNsaWNlKDAsIDMpO1xuICAgICAgcmVzdWx0LnRocmVlTW9udGggPSB7XG4gICAgICAgIGNyZWRpdHM6IE1hdGgucm91bmQoXG4gICAgICAgICAgbGFzdDMucmVkdWNlKChzdW0sIHMpID0+IHN1bSArIChzLmNyZWRpdHMgfHwgMCksIDApIC8gM1xuICAgICAgICApLFxuICAgICAgICBkZWJpdHM6IE1hdGgucm91bmQoXG4gICAgICAgICAgbGFzdDMucmVkdWNlKChzdW0sIHMpID0+IHN1bSArIChzLmRlYml0cyB8fCAwKSwgMCkgLyAzXG4gICAgICAgICksXG4gICAgICAgIGF2Z0RhaWx5QmFsYW5jZTogTWF0aC5yb3VuZChcbiAgICAgICAgICBsYXN0My5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgKHMuYXZlcmFnZV9kYWlseV9iYWxhbmNlIHx8IDApLCAwKSAvIDNcbiAgICAgICAgKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50XSAzLW1vbnRoIGF2ZXJhZ2VzOicsIHJlc3VsdC50aHJlZU1vbnRoKTtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgNi1tb250aCBhdmVyYWdlIGlmIHdlIGhhdmUgYXQgbGVhc3QgNiBzdGF0ZW1lbnRzXG4gICAgaWYgKHNvcnRlZC5sZW5ndGggPj0gNikge1xuICAgICAgY29uc3QgbGFzdDYgPSBzb3J0ZWQuc2xpY2UoMCwgNik7XG4gICAgICByZXN1bHQuc2l4TW9udGggPSB7XG4gICAgICAgIGNyZWRpdHM6IE1hdGgucm91bmQoXG4gICAgICAgICAgbGFzdDYucmVkdWNlKChzdW0sIHMpID0+IHN1bSArIChzLmNyZWRpdHMgfHwgMCksIDApIC8gNlxuICAgICAgICApLFxuICAgICAgICBkZWJpdHM6IE1hdGgucm91bmQoXG4gICAgICAgICAgbGFzdDYucmVkdWNlKChzdW0sIHMpID0+IHN1bSArIChzLmRlYml0cyB8fCAwKSwgMCkgLyA2XG4gICAgICAgICksXG4gICAgICAgIGF2Z0RhaWx5QmFsYW5jZTogTWF0aC5yb3VuZChcbiAgICAgICAgICBsYXN0Ni5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgKHMuYXZlcmFnZV9kYWlseV9iYWxhbmNlIHx8IDApLCAwKSAvIDZcbiAgICAgICAgKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnNvbGUubG9nKCdbZGVhbC1zdGF0ZW1lbnRzLXN1YmFnZW50XSA2LW1vbnRoIGF2ZXJhZ2VzOicsIHJlc3VsdC5zaXhNb250aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgZGVhbFN0YXRlbWVudHNTdWJBZ2VudCA9IG5ldyBEZWFsU3RhdGVtZW50c1N1YkFnZW50KCk7XG4iXSwi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