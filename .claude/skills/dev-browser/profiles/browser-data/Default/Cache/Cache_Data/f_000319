const STORAGE_KEY = "huge-capital-content-library";
export function getAllLibraryContent() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (!stored) return [];
    return JSON.parse(stored);
  } catch (error) {
    console.error("[ContentLibrary] Failed to load content:", error);
    return [];
  }
}
export function saveToLibrary(content, topic) {
  const library = getAllLibraryContent();
  const newItem = {
    id: `lib-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
    content: content.content,
    persona: content.metadata.persona,
    platform: content.metadata.platform,
    hashtags: content.hashtags,
    imagePrompt: content.imagePrompt,
    topic,
    voiceScore: content.metadata.voiceScore,
    complianceScore: content.metadata.complianceScore,
    createdAt: (/* @__PURE__ */ new Date()).toISOString(),
    isScheduled: false
  };
  library.unshift(newItem);
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
    console.log(`[ContentLibrary] Saved content for ${content.metadata.persona} on ${content.metadata.platform}. Library size: ${library.length}`);
  } catch (error) {
    console.error("[ContentLibrary] Failed to save content:", error);
  }
  return newItem;
}
export function saveMultipleToLibrary(contents, topic) {
  const library = getAllLibraryContent();
  const newItems = [];
  for (const content of contents) {
    const newItem = {
      id: `lib-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      content: content.content,
      persona: content.metadata.persona,
      platform: content.metadata.platform,
      hashtags: content.hashtags,
      imagePrompt: content.imagePrompt,
      topic,
      voiceScore: content.metadata.voiceScore,
      complianceScore: content.metadata.complianceScore,
      createdAt: (/* @__PURE__ */ new Date()).toISOString(),
      isScheduled: false
    };
    newItems.push(newItem);
  }
  const updatedLibrary = [...newItems, ...library];
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedLibrary));
    console.log(`[ContentLibrary] Batch saved ${newItems.length} items. Library size: ${updatedLibrary.length}`);
  } catch (error) {
    console.error("[ContentLibrary] Failed to batch save content:", error);
  }
  return newItems;
}
export function saveDraft(content, persona, platform, existingId) {
  const library = getAllLibraryContent();
  if (existingId) {
    const index = library.findIndex((item) => item.id === existingId);
    if (index !== -1) {
      library[index].content = content;
      library[index].updatedAt = (/* @__PURE__ */ new Date()).toISOString();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
      console.log(`[ContentLibrary] Updated draft ${existingId}`);
      return library[index];
    }
  }
  const newDraft = {
    id: `draft-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
    content,
    persona,
    platform,
    hashtags: [],
    imagePrompt: {
      subject: "",
      briefConceptPrompt: "",
      plugAndPlayPrompt: ""
    },
    createdAt: (/* @__PURE__ */ new Date()).toISOString(),
    isScheduled: false,
    isDraft: true
  };
  library.unshift(newDraft);
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
    console.log(`[ContentLibrary] Saved new draft for ${persona} on ${platform}. Library size: ${library.length}`);
  } catch (error) {
    console.error("[ContentLibrary] Failed to save draft:", error);
  }
  return newDraft;
}
export function updateDraft(draftId, updates) {
  const library = getAllLibraryContent();
  const index = library.findIndex((item) => item.id === draftId);
  if (index === -1) {
    console.warn(`[ContentLibrary] Draft ${draftId} not found`);
    return null;
  }
  library[index] = {
    ...library[index],
    ...updates,
    updatedAt: (/* @__PURE__ */ new Date()).toISOString()
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
  console.log(`[ContentLibrary] Updated draft ${draftId}`);
  return library[index];
}
export function publishDraft(draftId) {
  const library = getAllLibraryContent();
  const index = library.findIndex((item) => item.id === draftId);
  if (index === -1) {
    console.warn(`[ContentLibrary] Draft ${draftId} not found`);
    return null;
  }
  library[index].isDraft = false;
  library[index].updatedAt = (/* @__PURE__ */ new Date()).toISOString();
  localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
  console.log(`[ContentLibrary] Published draft ${draftId}`);
  return library[index];
}
export function getAllDrafts() {
  return getAllLibraryContent().filter((item) => item.isDraft === true);
}
export function markAsScheduled(libraryId, scheduledPostId) {
  const library = getAllLibraryContent();
  const index = library.findIndex((item) => item.id === libraryId);
  if (index !== -1) {
    library[index].isScheduled = true;
    library[index].scheduledPostId = scheduledPostId;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
    console.log(`[ContentLibrary] Marked ${libraryId} as scheduled`);
  }
}
export function deleteFromLibrary(libraryId) {
  const library = getAllLibraryContent().filter((item) => item.id !== libraryId);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
  console.log(`[ContentLibrary] Deleted item ${libraryId}. Library size: ${library.length}`);
}
export function setLikedStatus(libraryId, isLiked) {
  const library = getAllLibraryContent();
  const index = library.findIndex((item) => item.id === libraryId);
  if (index !== -1) {
    library[index].isLiked = isLiked;
    if (isLiked) {
      library[index].isDisliked = false;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
    console.log(`[ContentLibrary] Set liked status for ${libraryId}: ${isLiked}`);
  }
}
export function setDislikedStatus(libraryId, isDisliked) {
  const library = getAllLibraryContent();
  const index = library.findIndex((item) => item.id === libraryId);
  if (index !== -1) {
    library[index].isDisliked = isDisliked;
    if (isDisliked) {
      library[index].isLiked = false;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
    console.log(`[ContentLibrary] Set disliked status for ${libraryId}: ${isDisliked}`);
  }
}
export function toggleLiked(libraryId) {
  const library = getAllLibraryContent();
  const index = library.findIndex((item) => item.id === libraryId);
  if (index !== -1) {
    const newLikedStatus = !library[index].isLiked;
    library[index].isLiked = newLikedStatus;
    if (newLikedStatus) {
      library[index].isDisliked = false;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
    return newLikedStatus;
  }
  return false;
}
export function toggleDisliked(libraryId) {
  const library = getAllLibraryContent();
  const index = library.findIndex((item) => item.id === libraryId);
  if (index !== -1) {
    const newDislikedStatus = !library[index].isDisliked;
    library[index].isDisliked = newDislikedStatus;
    if (newDislikedStatus) {
      library[index].isLiked = false;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(library));
    return newDislikedStatus;
  }
  return false;
}
export function getFilteredLibraryContent(filters) {
  let library = getAllLibraryContent();
  if (filters.personas.length > 0) {
    library = library.filter((item) => filters.personas.includes(item.persona));
  }
  if (filters.platforms.length > 0) {
    library = library.filter((item) => filters.platforms.includes(item.platform));
  }
  if (filters.topic) {
    library = library.filter((item) => item.topic === filters.topic);
  }
  if (filters.showLiked) {
    library = library.filter((item) => item.isLiked === true);
  }
  if (filters.showDisliked) {
    library = library.filter((item) => item.isDisliked === true);
  }
  if (filters.showDrafts) {
    library = library.filter((item) => item.isDraft === true);
  }
  if (filters.searchQuery) {
    const query = filters.searchQuery.toLowerCase();
    library = library.filter(
      (item) => item.content.toLowerCase().includes(query) || item.hashtags.some((tag) => tag.toLowerCase().includes(query))
    );
  }
  return library;
}
export function getLibraryStats() {
  const library = getAllLibraryContent();
  const stats = {
    total: library.length,
    byPersona: {},
    byPlatform: {},
    scheduled: 0,
    drafts: 0,
    liked: 0,
    disliked: 0
  };
  for (const item of library) {
    stats.byPersona[item.persona] = (stats.byPersona[item.persona] || 0) + 1;
    stats.byPlatform[item.platform] = (stats.byPlatform[item.platform] || 0) + 1;
    if (item.isScheduled) stats.scheduled++;
    if (item.isDraft) stats.drafts++;
    if (item.isLiked) stats.liked++;
    if (item.isDisliked) stats.disliked++;
  }
  return stats;
}
export function clearLibrary() {
  localStorage.removeItem(STORAGE_KEY);
  console.log("[ContentLibrary] Library cleared");
}
export default {
  getAllLibraryContent,
  saveToLibrary,
  saveMultipleToLibrary,
  saveDraft,
  updateDraft,
  publishDraft,
  getAllDrafts,
  markAsScheduled,
  deleteFromLibrary,
  getFilteredLibraryContent,
  getLibraryStats,
  clearLibrary,
  setLikedStatus,
  setDislikedStatus,
  toggleLiked,
  toggleDisliked
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRlbnRMaWJyYXJ5U2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29udGVudCBMaWJyYXJ5IFNlcnZpY2VcclxuICpcclxuICogTWFuYWdlcyB0aGUgc3RvcmFnZSBhbmQgcmV0cmlldmFsIG9mIEFMTCBnZW5lcmF0ZWQgY29udGVudC5cclxuICogVGhpcyBpcyBzZXBhcmF0ZSBmcm9tIHNjaGVkdWxlZCBwb3N0cyAtIHRoaXMgc3RvcmVzIGV2ZXJ5dGhpbmcgdGhhdCdzIGV2ZXIgYmVlbiBnZW5lcmF0ZWQuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUgeyBQZXJzb24sIFBsYXRmb3JtIH0gZnJvbSAnLi4vdHlwZXMvY29udGVudCc7XHJcbmltcG9ydCB0eXBlIHsgR2VuZXJhdGVkQ29udGVudCB9IGZyb20gJy4vc2tpbGxzUnVubmVyJztcclxuXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIFRZUEVTXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExpYnJhcnlJdGVtIHtcclxuICBpZDogc3RyaW5nO1xyXG4gIGNvbnRlbnQ6IHN0cmluZztcclxuICBwZXJzb25hOiBQZXJzb247XHJcbiAgcGxhdGZvcm06IFBsYXRmb3JtO1xyXG4gIGhhc2h0YWdzOiBzdHJpbmdbXTtcclxuICBpbWFnZVByb21wdDoge1xyXG4gICAgc3ViamVjdDogc3RyaW5nO1xyXG4gICAgYnJpZWZDb25jZXB0UHJvbXB0OiBzdHJpbmc7XHJcbiAgICBwbHVnQW5kUGxheVByb21wdDogc3RyaW5nO1xyXG4gIH07XHJcbiAgdG9waWM/OiBzdHJpbmc7XHJcbiAgdm9pY2VTY29yZT86IG51bWJlcjtcclxuICBjb21wbGlhbmNlU2NvcmU/OiBudW1iZXI7XHJcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XHJcbiAgdXBkYXRlZEF0Pzogc3RyaW5nO1xyXG4gIGlzU2NoZWR1bGVkOiBib29sZWFuO1xyXG4gIHNjaGVkdWxlZFBvc3RJZD86IHN0cmluZztcclxuICBpc0xpa2VkPzogYm9vbGVhbjtcclxuICBpc0Rpc2xpa2VkPzogYm9vbGVhbjtcclxuICBpc0RyYWZ0PzogYm9vbGVhbjsgIC8vIFRydWUgaWYgc2F2ZWQgYXMgYSBkcmFmdCBmcm9tIGVkaXRvclxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExpYnJhcnlGaWx0ZXJzIHtcclxuICBwZXJzb25hczogUGVyc29uW107XHJcbiAgcGxhdGZvcm1zOiBQbGF0Zm9ybVtdO1xyXG4gIHRvcGljPzogc3RyaW5nO1xyXG4gIHNlYXJjaFF1ZXJ5Pzogc3RyaW5nO1xyXG4gIHNob3dMaWtlZD86IGJvb2xlYW47XHJcbiAgc2hvd0Rpc2xpa2VkPzogYm9vbGVhbjtcclxuICBzaG93RHJhZnRzPzogYm9vbGVhbjtcclxufVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuLy8gTE9DQUwgU1RPUkFHRSBNQU5BR0VNRU5UXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG5jb25zdCBTVE9SQUdFX0tFWSA9ICdodWdlLWNhcGl0YWwtY29udGVudC1saWJyYXJ5JztcclxuXHJcbi8qKlxyXG4gKiBHZXQgYWxsIGNvbnRlbnQgZnJvbSB0aGUgbGlicmFyeVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEFsbExpYnJhcnlDb250ZW50KCk6IExpYnJhcnlJdGVtW10ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWSk7XHJcbiAgICBpZiAoIXN0b3JlZCkgcmV0dXJuIFtdO1xyXG4gICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RvcmVkKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignW0NvbnRlbnRMaWJyYXJ5XSBGYWlsZWQgdG8gbG9hZCBjb250ZW50OicsIGVycm9yKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTYXZlIGEgc2luZ2xlIHBpZWNlIG9mIGdlbmVyYXRlZCBjb250ZW50IHRvIHRoZSBsaWJyYXJ5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gc2F2ZVRvTGlicmFyeShcclxuICBjb250ZW50OiBHZW5lcmF0ZWRDb250ZW50LFxyXG4gIHRvcGljPzogc3RyaW5nXHJcbik6IExpYnJhcnlJdGVtIHtcclxuICBjb25zdCBsaWJyYXJ5ID0gZ2V0QWxsTGlicmFyeUNvbnRlbnQoKTtcclxuXHJcbiAgY29uc3QgbmV3SXRlbTogTGlicmFyeUl0ZW0gPSB7XHJcbiAgICBpZDogYGxpYi0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXHJcbiAgICBjb250ZW50OiBjb250ZW50LmNvbnRlbnQsXHJcbiAgICBwZXJzb25hOiBjb250ZW50Lm1ldGFkYXRhLnBlcnNvbmEsXHJcbiAgICBwbGF0Zm9ybTogY29udGVudC5tZXRhZGF0YS5wbGF0Zm9ybSxcclxuICAgIGhhc2h0YWdzOiBjb250ZW50Lmhhc2h0YWdzLFxyXG4gICAgaW1hZ2VQcm9tcHQ6IGNvbnRlbnQuaW1hZ2VQcm9tcHQsXHJcbiAgICB0b3BpYyxcclxuICAgIHZvaWNlU2NvcmU6IGNvbnRlbnQubWV0YWRhdGEudm9pY2VTY29yZSxcclxuICAgIGNvbXBsaWFuY2VTY29yZTogY29udGVudC5tZXRhZGF0YS5jb21wbGlhbmNlU2NvcmUsXHJcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgIGlzU2NoZWR1bGVkOiBmYWxzZSxcclxuICB9O1xyXG5cclxuICBsaWJyYXJ5LnVuc2hpZnQobmV3SXRlbSk7IC8vIEFkZCB0byBiZWdpbm5pbmcgKG5ld2VzdCBmaXJzdClcclxuXHJcbiAgdHJ5IHtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShsaWJyYXJ5KSk7XHJcbiAgICBjb25zb2xlLmxvZyhgW0NvbnRlbnRMaWJyYXJ5XSBTYXZlZCBjb250ZW50IGZvciAke2NvbnRlbnQubWV0YWRhdGEucGVyc29uYX0gb24gJHtjb250ZW50Lm1ldGFkYXRhLnBsYXRmb3JtfS4gTGlicmFyeSBzaXplOiAke2xpYnJhcnkubGVuZ3RofWApO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbQ29udGVudExpYnJhcnldIEZhaWxlZCB0byBzYXZlIGNvbnRlbnQ6JywgZXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG5ld0l0ZW07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTYXZlIG11bHRpcGxlIHBpZWNlcyBvZiBnZW5lcmF0ZWQgY29udGVudCB0byB0aGUgbGlicmFyeSAoYmF0Y2ggc2F2ZSlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzYXZlTXVsdGlwbGVUb0xpYnJhcnkoXHJcbiAgY29udGVudHM6IEdlbmVyYXRlZENvbnRlbnRbXSxcclxuICB0b3BpYz86IHN0cmluZ1xyXG4pOiBMaWJyYXJ5SXRlbVtdIHtcclxuICBjb25zdCBsaWJyYXJ5ID0gZ2V0QWxsTGlicmFyeUNvbnRlbnQoKTtcclxuICBjb25zdCBuZXdJdGVtczogTGlicmFyeUl0ZW1bXSA9IFtdO1xyXG5cclxuICBmb3IgKGNvbnN0IGNvbnRlbnQgb2YgY29udGVudHMpIHtcclxuICAgIGNvbnN0IG5ld0l0ZW06IExpYnJhcnlJdGVtID0ge1xyXG4gICAgICBpZDogYGxpYi0ke0RhdGUubm93KCl9LSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWAsXHJcbiAgICAgIGNvbnRlbnQ6IGNvbnRlbnQuY29udGVudCxcclxuICAgICAgcGVyc29uYTogY29udGVudC5tZXRhZGF0YS5wZXJzb25hLFxyXG4gICAgICBwbGF0Zm9ybTogY29udGVudC5tZXRhZGF0YS5wbGF0Zm9ybSxcclxuICAgICAgaGFzaHRhZ3M6IGNvbnRlbnQuaGFzaHRhZ3MsXHJcbiAgICAgIGltYWdlUHJvbXB0OiBjb250ZW50LmltYWdlUHJvbXB0LFxyXG4gICAgICB0b3BpYyxcclxuICAgICAgdm9pY2VTY29yZTogY29udGVudC5tZXRhZGF0YS52b2ljZVNjb3JlLFxyXG4gICAgICBjb21wbGlhbmNlU2NvcmU6IGNvbnRlbnQubWV0YWRhdGEuY29tcGxpYW5jZVNjb3JlLFxyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgaXNTY2hlZHVsZWQ6IGZhbHNlLFxyXG4gICAgfTtcclxuICAgIG5ld0l0ZW1zLnB1c2gobmV3SXRlbSk7XHJcbiAgfVxyXG5cclxuICAvLyBBZGQgYWxsIG5ldyBpdGVtcyB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBsaWJyYXJ5XHJcbiAgY29uc3QgdXBkYXRlZExpYnJhcnkgPSBbLi4ubmV3SXRlbXMsIC4uLmxpYnJhcnldO1xyXG5cclxuICB0cnkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRMaWJyYXJ5KSk7XHJcbiAgICBjb25zb2xlLmxvZyhgW0NvbnRlbnRMaWJyYXJ5XSBCYXRjaCBzYXZlZCAke25ld0l0ZW1zLmxlbmd0aH0gaXRlbXMuIExpYnJhcnkgc2l6ZTogJHt1cGRhdGVkTGlicmFyeS5sZW5ndGh9YCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tDb250ZW50TGlicmFyeV0gRmFpbGVkIHRvIGJhdGNoIHNhdmUgY29udGVudDonLCBlcnJvcik7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbmV3SXRlbXM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTYXZlIGEgZHJhZnQgdG8gdGhlIGxpYnJhcnkgKGZyb20gZWRpdG9yKVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNhdmVEcmFmdChcclxuICBjb250ZW50OiBzdHJpbmcsXHJcbiAgcGVyc29uYTogUGVyc29uLFxyXG4gIHBsYXRmb3JtOiBQbGF0Zm9ybSxcclxuICBleGlzdGluZ0lkPzogc3RyaW5nXHJcbik6IExpYnJhcnlJdGVtIHtcclxuICBjb25zdCBsaWJyYXJ5ID0gZ2V0QWxsTGlicmFyeUNvbnRlbnQoKTtcclxuXHJcbiAgLy8gSWYgdXBkYXRpbmcgZXhpc3RpbmcgZHJhZnRcclxuICBpZiAoZXhpc3RpbmdJZCkge1xyXG4gICAgY29uc3QgaW5kZXggPSBsaWJyYXJ5LmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaWQgPT09IGV4aXN0aW5nSWQpO1xyXG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICBsaWJyYXJ5W2luZGV4XS5jb250ZW50ID0gY29udGVudDtcclxuICAgICAgbGlicmFyeVtpbmRleF0udXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkobGlicmFyeSkpO1xyXG4gICAgICBjb25zb2xlLmxvZyhgW0NvbnRlbnRMaWJyYXJ5XSBVcGRhdGVkIGRyYWZ0ICR7ZXhpc3RpbmdJZH1gKTtcclxuICAgICAgcmV0dXJuIGxpYnJhcnlbaW5kZXhdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQ3JlYXRlIG5ldyBkcmFmdFxyXG4gIGNvbnN0IG5ld0RyYWZ0OiBMaWJyYXJ5SXRlbSA9IHtcclxuICAgIGlkOiBgZHJhZnQtJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxyXG4gICAgY29udGVudCxcclxuICAgIHBlcnNvbmEsXHJcbiAgICBwbGF0Zm9ybSxcclxuICAgIGhhc2h0YWdzOiBbXSxcclxuICAgIGltYWdlUHJvbXB0OiB7XHJcbiAgICAgIHN1YmplY3Q6ICcnLFxyXG4gICAgICBicmllZkNvbmNlcHRQcm9tcHQ6ICcnLFxyXG4gICAgICBwbHVnQW5kUGxheVByb21wdDogJycsXHJcbiAgICB9LFxyXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICBpc1NjaGVkdWxlZDogZmFsc2UsXHJcbiAgICBpc0RyYWZ0OiB0cnVlLFxyXG4gIH07XHJcblxyXG4gIGxpYnJhcnkudW5zaGlmdChuZXdEcmFmdCk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkobGlicmFyeSkpO1xyXG4gICAgY29uc29sZS5sb2coYFtDb250ZW50TGlicmFyeV0gU2F2ZWQgbmV3IGRyYWZ0IGZvciAke3BlcnNvbmF9IG9uICR7cGxhdGZvcm19LiBMaWJyYXJ5IHNpemU6ICR7bGlicmFyeS5sZW5ndGh9YCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1tDb250ZW50TGlicmFyeV0gRmFpbGVkIHRvIHNhdmUgZHJhZnQ6JywgZXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG5ld0RyYWZ0O1xyXG59XHJcblxyXG4vKipcclxuICogVXBkYXRlIGFuIGV4aXN0aW5nIGRyYWZ0XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlRHJhZnQoXHJcbiAgZHJhZnRJZDogc3RyaW5nLFxyXG4gIHVwZGF0ZXM6IFBhcnRpYWw8UGljazxMaWJyYXJ5SXRlbSwgJ2NvbnRlbnQnIHwgJ2hhc2h0YWdzJyB8ICd0b3BpYycgfCAncGxhdGZvcm0nPj5cclxuKTogTGlicmFyeUl0ZW0gfCBudWxsIHtcclxuICBjb25zdCBsaWJyYXJ5ID0gZ2V0QWxsTGlicmFyeUNvbnRlbnQoKTtcclxuICBjb25zdCBpbmRleCA9IGxpYnJhcnkuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gZHJhZnRJZCk7XHJcblxyXG4gIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgIGNvbnNvbGUud2FybihgW0NvbnRlbnRMaWJyYXJ5XSBEcmFmdCAke2RyYWZ0SWR9IG5vdCBmb3VuZGApO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBsaWJyYXJ5W2luZGV4XSA9IHtcclxuICAgIC4uLmxpYnJhcnlbaW5kZXhdLFxyXG4gICAgLi4udXBkYXRlcyxcclxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gIH07XHJcblxyXG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShsaWJyYXJ5KSk7XHJcbiAgY29uc29sZS5sb2coYFtDb250ZW50TGlicmFyeV0gVXBkYXRlZCBkcmFmdCAke2RyYWZ0SWR9YCk7XHJcbiAgcmV0dXJuIGxpYnJhcnlbaW5kZXhdO1xyXG59XHJcblxyXG4vKipcclxuICogQ29udmVydCBhIGRyYWZ0IHRvIGEgcmVndWxhciBsaWJyYXJ5IGl0ZW0gKG5vIGxvbmdlciBkcmFmdClcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwdWJsaXNoRHJhZnQoZHJhZnRJZDogc3RyaW5nKTogTGlicmFyeUl0ZW0gfCBudWxsIHtcclxuICBjb25zdCBsaWJyYXJ5ID0gZ2V0QWxsTGlicmFyeUNvbnRlbnQoKTtcclxuICBjb25zdCBpbmRleCA9IGxpYnJhcnkuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gZHJhZnRJZCk7XHJcblxyXG4gIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgIGNvbnNvbGUud2FybihgW0NvbnRlbnRMaWJyYXJ5XSBEcmFmdCAke2RyYWZ0SWR9IG5vdCBmb3VuZGApO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBsaWJyYXJ5W2luZGV4XS5pc0RyYWZ0ID0gZmFsc2U7XHJcbiAgbGlicmFyeVtpbmRleF0udXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG5cclxuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkobGlicmFyeSkpO1xyXG4gIGNvbnNvbGUubG9nKGBbQ29udGVudExpYnJhcnldIFB1Ymxpc2hlZCBkcmFmdCAke2RyYWZ0SWR9YCk7XHJcbiAgcmV0dXJuIGxpYnJhcnlbaW5kZXhdO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGFsbCBkcmFmdHNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxEcmFmdHMoKTogTGlicmFyeUl0ZW1bXSB7XHJcbiAgcmV0dXJuIGdldEFsbExpYnJhcnlDb250ZW50KCkuZmlsdGVyKGl0ZW0gPT4gaXRlbS5pc0RyYWZ0ID09PSB0cnVlKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIE1hcmsgYSBsaWJyYXJ5IGl0ZW0gYXMgc2NoZWR1bGVkXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbWFya0FzU2NoZWR1bGVkKGxpYnJhcnlJZDogc3RyaW5nLCBzY2hlZHVsZWRQb3N0SWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gIGNvbnN0IGxpYnJhcnkgPSBnZXRBbGxMaWJyYXJ5Q29udGVudCgpO1xyXG4gIGNvbnN0IGluZGV4ID0gbGlicmFyeS5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSBsaWJyYXJ5SWQpO1xyXG5cclxuICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICBsaWJyYXJ5W2luZGV4XS5pc1NjaGVkdWxlZCA9IHRydWU7XHJcbiAgICBsaWJyYXJ5W2luZGV4XS5zY2hlZHVsZWRQb3N0SWQgPSBzY2hlZHVsZWRQb3N0SWQ7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkobGlicmFyeSkpO1xyXG4gICAgY29uc29sZS5sb2coYFtDb250ZW50TGlicmFyeV0gTWFya2VkICR7bGlicmFyeUlkfSBhcyBzY2hlZHVsZWRgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBEZWxldGUgYW4gaXRlbSBmcm9tIHRoZSBsaWJyYXJ5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlRnJvbUxpYnJhcnkobGlicmFyeUlkOiBzdHJpbmcpOiB2b2lkIHtcclxuICBjb25zdCBsaWJyYXJ5ID0gZ2V0QWxsTGlicmFyeUNvbnRlbnQoKS5maWx0ZXIoaXRlbSA9PiBpdGVtLmlkICE9PSBsaWJyYXJ5SWQpO1xyXG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShsaWJyYXJ5KSk7XHJcbiAgY29uc29sZS5sb2coYFtDb250ZW50TGlicmFyeV0gRGVsZXRlZCBpdGVtICR7bGlicmFyeUlkfS4gTGlicmFyeSBzaXplOiAke2xpYnJhcnkubGVuZ3RofWApO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IHRoZSBsaWtlZCBzdGF0dXMgb2YgYSBsaWJyYXJ5IGl0ZW1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXRMaWtlZFN0YXR1cyhsaWJyYXJ5SWQ6IHN0cmluZywgaXNMaWtlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gIGNvbnN0IGxpYnJhcnkgPSBnZXRBbGxMaWJyYXJ5Q29udGVudCgpO1xyXG4gIGNvbnN0IGluZGV4ID0gbGlicmFyeS5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSBsaWJyYXJ5SWQpO1xyXG5cclxuICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICBsaWJyYXJ5W2luZGV4XS5pc0xpa2VkID0gaXNMaWtlZDtcclxuICAgIC8vIElmIGxpa2luZywgcmVtb3ZlIGRpc2xpa2VcclxuICAgIGlmIChpc0xpa2VkKSB7XHJcbiAgICAgIGxpYnJhcnlbaW5kZXhdLmlzRGlzbGlrZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShsaWJyYXJ5KSk7XHJcbiAgICBjb25zb2xlLmxvZyhgW0NvbnRlbnRMaWJyYXJ5XSBTZXQgbGlrZWQgc3RhdHVzIGZvciAke2xpYnJhcnlJZH06ICR7aXNMaWtlZH1gKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgdGhlIGRpc2xpa2VkIHN0YXR1cyBvZiBhIGxpYnJhcnkgaXRlbVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHNldERpc2xpa2VkU3RhdHVzKGxpYnJhcnlJZDogc3RyaW5nLCBpc0Rpc2xpa2VkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgY29uc3QgbGlicmFyeSA9IGdldEFsbExpYnJhcnlDb250ZW50KCk7XHJcbiAgY29uc3QgaW5kZXggPSBsaWJyYXJ5LmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaWQgPT09IGxpYnJhcnlJZCk7XHJcblxyXG4gIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgIGxpYnJhcnlbaW5kZXhdLmlzRGlzbGlrZWQgPSBpc0Rpc2xpa2VkO1xyXG4gICAgLy8gSWYgZGlzbGlraW5nLCByZW1vdmUgbGlrZVxyXG4gICAgaWYgKGlzRGlzbGlrZWQpIHtcclxuICAgICAgbGlicmFyeVtpbmRleF0uaXNMaWtlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KGxpYnJhcnkpKTtcclxuICAgIGNvbnNvbGUubG9nKGBbQ29udGVudExpYnJhcnldIFNldCBkaXNsaWtlZCBzdGF0dXMgZm9yICR7bGlicmFyeUlkfTogJHtpc0Rpc2xpa2VkfWApO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFRvZ2dsZSB0aGUgbGlrZWQgc3RhdHVzIG9mIGEgbGlicmFyeSBpdGVtXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdG9nZ2xlTGlrZWQobGlicmFyeUlkOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICBjb25zdCBsaWJyYXJ5ID0gZ2V0QWxsTGlicmFyeUNvbnRlbnQoKTtcclxuICBjb25zdCBpbmRleCA9IGxpYnJhcnkuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gbGlicmFyeUlkKTtcclxuXHJcbiAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgY29uc3QgbmV3TGlrZWRTdGF0dXMgPSAhbGlicmFyeVtpbmRleF0uaXNMaWtlZDtcclxuICAgIGxpYnJhcnlbaW5kZXhdLmlzTGlrZWQgPSBuZXdMaWtlZFN0YXR1cztcclxuICAgIGlmIChuZXdMaWtlZFN0YXR1cykge1xyXG4gICAgICBsaWJyYXJ5W2luZGV4XS5pc0Rpc2xpa2VkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShTVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkobGlicmFyeSkpO1xyXG4gICAgcmV0dXJuIG5ld0xpa2VkU3RhdHVzO1xyXG4gIH1cclxuICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUb2dnbGUgdGhlIGRpc2xpa2VkIHN0YXR1cyBvZiBhIGxpYnJhcnkgaXRlbVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHRvZ2dsZURpc2xpa2VkKGxpYnJhcnlJZDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgbGlicmFyeSA9IGdldEFsbExpYnJhcnlDb250ZW50KCk7XHJcbiAgY29uc3QgaW5kZXggPSBsaWJyYXJ5LmZpbmRJbmRleChpdGVtID0+IGl0ZW0uaWQgPT09IGxpYnJhcnlJZCk7XHJcblxyXG4gIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgIGNvbnN0IG5ld0Rpc2xpa2VkU3RhdHVzID0gIWxpYnJhcnlbaW5kZXhdLmlzRGlzbGlrZWQ7XHJcbiAgICBsaWJyYXJ5W2luZGV4XS5pc0Rpc2xpa2VkID0gbmV3RGlzbGlrZWRTdGF0dXM7XHJcbiAgICBpZiAobmV3RGlzbGlrZWRTdGF0dXMpIHtcclxuICAgICAgbGlicmFyeVtpbmRleF0uaXNMaWtlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KGxpYnJhcnkpKTtcclxuICAgIHJldHVybiBuZXdEaXNsaWtlZFN0YXR1cztcclxuICB9XHJcbiAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGZpbHRlcmVkIGNvbnRlbnQgZnJvbSB0aGUgbGlicmFyeVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEZpbHRlcmVkTGlicmFyeUNvbnRlbnQoZmlsdGVyczogTGlicmFyeUZpbHRlcnMpOiBMaWJyYXJ5SXRlbVtdIHtcclxuICBsZXQgbGlicmFyeSA9IGdldEFsbExpYnJhcnlDb250ZW50KCk7XHJcblxyXG4gIC8vIEZpbHRlciBieSBwZXJzb25hc1xyXG4gIGlmIChmaWx0ZXJzLnBlcnNvbmFzLmxlbmd0aCA+IDApIHtcclxuICAgIGxpYnJhcnkgPSBsaWJyYXJ5LmZpbHRlcihpdGVtID0+IGZpbHRlcnMucGVyc29uYXMuaW5jbHVkZXMoaXRlbS5wZXJzb25hKSk7XHJcbiAgfVxyXG5cclxuICAvLyBGaWx0ZXIgYnkgcGxhdGZvcm1zXHJcbiAgaWYgKGZpbHRlcnMucGxhdGZvcm1zLmxlbmd0aCA+IDApIHtcclxuICAgIGxpYnJhcnkgPSBsaWJyYXJ5LmZpbHRlcihpdGVtID0+IGZpbHRlcnMucGxhdGZvcm1zLmluY2x1ZGVzKGl0ZW0ucGxhdGZvcm0pKTtcclxuICB9XHJcblxyXG4gIC8vIEZpbHRlciBieSB0b3BpY1xyXG4gIGlmIChmaWx0ZXJzLnRvcGljKSB7XHJcbiAgICBsaWJyYXJ5ID0gbGlicmFyeS5maWx0ZXIoaXRlbSA9PiBpdGVtLnRvcGljID09PSBmaWx0ZXJzLnRvcGljKTtcclxuICB9XHJcblxyXG4gIC8vIEZpbHRlciBieSBsaWtlZCBzdGF0dXNcclxuICBpZiAoZmlsdGVycy5zaG93TGlrZWQpIHtcclxuICAgIGxpYnJhcnkgPSBsaWJyYXJ5LmZpbHRlcihpdGVtID0+IGl0ZW0uaXNMaWtlZCA9PT0gdHJ1ZSk7XHJcbiAgfVxyXG5cclxuICAvLyBGaWx0ZXIgYnkgZGlzbGlrZWQgc3RhdHVzXHJcbiAgaWYgKGZpbHRlcnMuc2hvd0Rpc2xpa2VkKSB7XHJcbiAgICBsaWJyYXJ5ID0gbGlicmFyeS5maWx0ZXIoaXRlbSA9PiBpdGVtLmlzRGlzbGlrZWQgPT09IHRydWUpO1xyXG4gIH1cclxuXHJcbiAgLy8gRmlsdGVyIGJ5IGRyYWZ0c1xyXG4gIGlmIChmaWx0ZXJzLnNob3dEcmFmdHMpIHtcclxuICAgIGxpYnJhcnkgPSBsaWJyYXJ5LmZpbHRlcihpdGVtID0+IGl0ZW0uaXNEcmFmdCA9PT0gdHJ1ZSk7XHJcbiAgfVxyXG5cclxuICAvLyBGaWx0ZXIgYnkgc2VhcmNoIHF1ZXJ5XHJcbiAgaWYgKGZpbHRlcnMuc2VhcmNoUXVlcnkpIHtcclxuICAgIGNvbnN0IHF1ZXJ5ID0gZmlsdGVycy5zZWFyY2hRdWVyeS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgbGlicmFyeSA9IGxpYnJhcnkuZmlsdGVyKGl0ZW0gPT5cclxuICAgICAgaXRlbS5jb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpIHx8XHJcbiAgICAgIGl0ZW0uaGFzaHRhZ3Muc29tZSh0YWcgPT4gdGFnLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBsaWJyYXJ5O1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGxpYnJhcnkgc3RhdGlzdGljc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldExpYnJhcnlTdGF0cygpOiB7XHJcbiAgdG90YWw6IG51bWJlcjtcclxuICBieVBlcnNvbmE6IFJlY29yZDxQZXJzb24sIG51bWJlcj47XHJcbiAgYnlQbGF0Zm9ybTogUmVjb3JkPFBsYXRmb3JtLCBudW1iZXI+O1xyXG4gIHNjaGVkdWxlZDogbnVtYmVyO1xyXG4gIGRyYWZ0czogbnVtYmVyO1xyXG4gIGxpa2VkOiBudW1iZXI7XHJcbiAgZGlzbGlrZWQ6IG51bWJlcjtcclxufSB7XHJcbiAgY29uc3QgbGlicmFyeSA9IGdldEFsbExpYnJhcnlDb250ZW50KCk7XHJcblxyXG4gIGNvbnN0IHN0YXRzID0ge1xyXG4gICAgdG90YWw6IGxpYnJhcnkubGVuZ3RoLFxyXG4gICAgYnlQZXJzb25hOiB7fSBhcyBSZWNvcmQ8UGVyc29uLCBudW1iZXI+LFxyXG4gICAgYnlQbGF0Zm9ybToge30gYXMgUmVjb3JkPFBsYXRmb3JtLCBudW1iZXI+LFxyXG4gICAgc2NoZWR1bGVkOiAwLFxyXG4gICAgZHJhZnRzOiAwLFxyXG4gICAgbGlrZWQ6IDAsXHJcbiAgICBkaXNsaWtlZDogMCxcclxuICB9O1xyXG5cclxuICBmb3IgKGNvbnN0IGl0ZW0gb2YgbGlicmFyeSkge1xyXG4gICAgc3RhdHMuYnlQZXJzb25hW2l0ZW0ucGVyc29uYV0gPSAoc3RhdHMuYnlQZXJzb25hW2l0ZW0ucGVyc29uYV0gfHwgMCkgKyAxO1xyXG4gICAgc3RhdHMuYnlQbGF0Zm9ybVtpdGVtLnBsYXRmb3JtXSA9IChzdGF0cy5ieVBsYXRmb3JtW2l0ZW0ucGxhdGZvcm1dIHx8IDApICsgMTtcclxuICAgIGlmIChpdGVtLmlzU2NoZWR1bGVkKSBzdGF0cy5zY2hlZHVsZWQrKztcclxuICAgIGlmIChpdGVtLmlzRHJhZnQpIHN0YXRzLmRyYWZ0cysrO1xyXG4gICAgaWYgKGl0ZW0uaXNMaWtlZCkgc3RhdHMubGlrZWQrKztcclxuICAgIGlmIChpdGVtLmlzRGlzbGlrZWQpIHN0YXRzLmRpc2xpa2VkKys7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc3RhdHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBhbGwgY29udGVudCBmcm9tIHRoZSBsaWJyYXJ5ICh1c2Ugd2l0aCBjYXV0aW9uISlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhckxpYnJhcnkoKTogdm9pZCB7XHJcbiAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oU1RPUkFHRV9LRVkpO1xyXG4gIGNvbnNvbGUubG9nKCdbQ29udGVudExpYnJhcnldIExpYnJhcnkgY2xlYXJlZCcpO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgZ2V0QWxsTGlicmFyeUNvbnRlbnQsXHJcbiAgc2F2ZVRvTGlicmFyeSxcclxuICBzYXZlTXVsdGlwbGVUb0xpYnJhcnksXHJcbiAgc2F2ZURyYWZ0LFxyXG4gIHVwZGF0ZURyYWZ0LFxyXG4gIHB1Ymxpc2hEcmFmdCxcclxuICBnZXRBbGxEcmFmdHMsXHJcbiAgbWFya0FzU2NoZWR1bGVkLFxyXG4gIGRlbGV0ZUZyb21MaWJyYXJ5LFxyXG4gIGdldEZpbHRlcmVkTGlicmFyeUNvbnRlbnQsXHJcbiAgZ2V0TGlicmFyeVN0YXRzLFxyXG4gIGNsZWFyTGlicmFyeSxcclxuICBzZXRMaWtlZFN0YXR1cyxcclxuICBzZXREaXNsaWtlZFN0YXR1cyxcclxuICB0b2dnbGVMaWtlZCxcclxuICB0b2dnbGVEaXNsaWtlZCxcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiQUFtREEsTUFBTSxjQUFjO0FBS2IsZ0JBQVMsdUJBQXNDO0FBQ3BELE1BQUk7QUFDRixVQUFNLFNBQVMsYUFBYSxRQUFRLFdBQVc7QUFDL0MsUUFBSSxDQUFDLE9BQVEsUUFBTyxDQUFDO0FBQ3JCLFdBQU8sS0FBSyxNQUFNLE1BQU07QUFBQSxFQUMxQixTQUFTLE9BQU87QUFDZCxZQUFRLE1BQU0sNENBQTRDLEtBQUs7QUFDL0QsV0FBTyxDQUFDO0FBQUEsRUFDVjtBQUNGO0FBS08sZ0JBQVMsY0FDZCxTQUNBLE9BQ2E7QUFDYixRQUFNLFVBQVUscUJBQXFCO0FBRXJDLFFBQU0sVUFBdUI7QUFBQSxJQUMzQixJQUFJLE9BQU8sS0FBSyxJQUFJLENBQUMsSUFBSSxLQUFLLE9BQU8sRUFBRSxTQUFTLEVBQUUsRUFBRSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQUEsSUFDaEUsU0FBUyxRQUFRO0FBQUEsSUFDakIsU0FBUyxRQUFRLFNBQVM7QUFBQSxJ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