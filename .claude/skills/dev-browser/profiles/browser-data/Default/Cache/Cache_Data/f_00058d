import __vite__cjsImport0_react from "/node_modules/.vite/deps/react.js?v=9303f522"; const useState = __vite__cjsImport0_react["useState"]; const useEffect = __vite__cjsImport0_react["useEffect"]; const useCallback = __vite__cjsImport0_react["useCallback"];
import { useAuth } from "/src/vite/auth/auth-provider.tsx";
import {
  fetchAllPeriods,
  fetchCompleteProfitLoss,
  fetchPeriodComparison,
  exportProfitLossToCSV,
  exportProfitLossToExcel
} from "/src/lib/data/profit-loss.ts";
export function useProfitLoss() {
  const auth = useAuth();
  const token = auth.session?.access_token;
  const [periods, setPeriods] = useState([]);
  const [selectedPeriodId, setSelectedPeriodId] = useState(null);
  const [loadingPeriods, setLoadingPeriods] = useState(true);
  const [periodsError, setPeriodsError] = useState(null);
  const [profitLossData, setProfitLossData] = useState(null);
  const [loadingData, setLoadingData] = useState(false);
  const [dataError, setDataError] = useState(null);
  const [comparisonMode, setComparisonMode] = useState("none");
  const [comparisonData, setComparisonData] = useState(null);
  const [loadingComparison, setLoadingComparison] = useState(false);
  const [comparisonError, setComparisonError] = useState(null);
  const loadPeriods = useCallback(async () => {
    if (!token) {
      setLoadingPeriods(false);
      return;
    }
    setLoadingPeriods(true);
    setPeriodsError(null);
    const result = await fetchAllPeriods(token);
    if (result.success && result.data) {
      setPeriods(result.data);
      if (!selectedPeriodId && result.data.length > 0) {
        const sortedPeriods = [...result.data].sort(
          (a, b) => new Date(b.period_end_date).getTime() - new Date(a.period_end_date).getTime()
        );
        setSelectedPeriodId(sortedPeriods[0].id);
      }
    } else {
      setPeriodsError(result.error || "Failed to load periods");
    }
    setLoadingPeriods(false);
  }, [token, selectedPeriodId]);
  const refreshPeriods = useCallback(async () => {
    await loadPeriods();
  }, [loadPeriods]);
  useEffect(() => {
    void loadPeriods();
  }, [loadPeriods]);
  const loadProfitLossData = useCallback(async () => {
    if (!token || !selectedPeriodId) {
      setProfitLossData(null);
      setDataError(null);
      return;
    }
    setLoadingData(true);
    setDataError(null);
    const result = await fetchCompleteProfitLoss(selectedPeriodId, token);
    if (result.success && result.data) {
      setProfitLossData(result.data);
    } else {
      setDataError(result.error || "Failed to load P&L data");
      setProfitLossData(null);
    }
    setLoadingData(false);
  }, [token, selectedPeriodId]);
  const refreshData = useCallback(async () => {
    await loadProfitLossData();
  }, [loadProfitLossData]);
  useEffect(() => {
    void loadProfitLossData();
  }, [loadProfitLossData]);
  const loadComparisonData = useCallback(async () => {
    if (!token || !selectedPeriodId || comparisonMode === "none") {
      setComparisonData(null);
      setComparisonError(null);
      setLoadingComparison(false);
      return;
    }
    setLoadingComparison(true);
    setComparisonError(null);
    const result = await fetchPeriodComparison(selectedPeriodId, comparisonMode, token);
    if (result.success && result.data) {
      setComparisonData(result.data);
    } else {
      setComparisonError(result.error || "Failed to load comparison data");
      setComparisonData(null);
    }
    setLoadingComparison(false);
  }, [token, selectedPeriodId, comparisonMode]);
  useEffect(() => {
    void loadComparisonData();
  }, [loadComparisonData]);
  const handleExportCSV = useCallback(() => {
    if (!profitLossData) {
      alert("No data to export");
      return;
    }
    try {
      exportProfitLossToCSV(profitLossData);
    } catch (error) {
      alert(`Export failed: ${error.message}`);
    }
  }, [profitLossData]);
  const handleExportExcel = useCallback(() => {
    if (!profitLossData) {
      alert("No data to export");
      return;
    }
    try {
      void exportProfitLossToExcel(profitLossData);
    } catch (error) {
      alert(`Export failed: ${error.message}`);
    }
  }, [profitLossData]);
  const handleUploadSuccess = useCallback(
    (periodId) => {
      void refreshPeriods();
      setSelectedPeriodId(periodId);
    },
    [refreshPeriods]
  );
  return {
    // Periods
    periods,
    selectedPeriodId,
    setSelectedPeriodId,
    // P&L Data
    profitLossData,
    comparisonData,
    // Comparison Mode
    comparisonMode,
    setComparisonMode,
    // Loading States
    loadingPeriods,
    loadingData,
    loadingComparison,
    // Error States
    periodsError,
    dataError,
    comparisonError,
    // Actions
    refreshPeriods,
    refreshData,
    handleExportCSV,
    handleExportExcel,
    handleUploadSuccess
  };
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZS1wcm9maXQtbG9zcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogdXNlUHJvZml0TG9zcyBIb29rXHJcbiAqXHJcbiAqIEN1c3RvbSBob29rIGZvciBtYW5hZ2luZyBQcm9maXQgJiBMb3NzIGRhdGEgZmV0Y2hpbmcsIHN0YXRlIG1hbmFnZW1lbnQsXHJcbiAqIGFuZCBwZXJpb2QgY29tcGFyaXNvbiBsb2dpYy5cclxuICpcclxuICogRmVhdHVyZXM6XHJcbiAqIC0gTG9hZHMgYWxsIGF2YWlsYWJsZSBwZXJpb2RzIG9uIG1vdW50XHJcbiAqIC0gRmV0Y2hlcyBjb21wbGV0ZSBQJkwgZGF0YSBmb3Igc2VsZWN0ZWQgcGVyaW9kXHJcbiAqIC0gSGFuZGxlcyBjb21wYXJpc29uIG1vZGUgKE1vTSwgWW9ZKVxyXG4gKiAtIE1hbmFnZXMgbG9hZGluZyBhbmQgZXJyb3Igc3RhdGVzXHJcbiAqIC0gQXV0by1zZWxlY3RzIG1vc3QgcmVjZW50IHBlcmlvZCBvbiBsb2FkXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tIFwicmVhY3RcIjtcclxuaW1wb3J0IHsgdXNlQXV0aCB9IGZyb20gXCJAL3ZpdGUvYXV0aC9hdXRoLXByb3ZpZGVyXCI7XHJcbmltcG9ydCB7XHJcbiAgZmV0Y2hBbGxQZXJpb2RzLFxyXG4gIGZldGNoQ29tcGxldGVQcm9maXRMb3NzLFxyXG4gIGZldGNoUGVyaW9kQ29tcGFyaXNvbixcclxuICBleHBvcnRQcm9maXRMb3NzVG9DU1YsXHJcbiAgZXhwb3J0UHJvZml0TG9zc1RvRXhjZWwsXHJcbiAgdHlwZSBDb21wbGV0ZVByb2ZpdExvc3MsXHJcbiAgdHlwZSBQcm9maXRMb3NzUGVyaW9kLFxyXG4gIHR5cGUgUGVyaW9kQ29tcGFyaXNvbkRhdGEsXHJcbiAgdHlwZSBDb21wYXJpc29uTW9kZSxcclxufSBmcm9tIFwiQC9saWIvZGF0YS9wcm9maXQtbG9zc1wiO1xyXG5cclxuaW50ZXJmYWNlIFVzZVByb2ZpdExvc3NSZXR1cm4ge1xyXG4gIC8vIFBlcmlvZHNcclxuICBwZXJpb2RzOiBQcm9maXRMb3NzUGVyaW9kW107XHJcbiAgc2VsZWN0ZWRQZXJpb2RJZDogc3RyaW5nIHwgbnVsbDtcclxuICBzZXRTZWxlY3RlZFBlcmlvZElkOiAocGVyaW9kSWQ6IHN0cmluZyB8IG51bGwpID0+IHZvaWQ7XHJcblxyXG4gIC8vIFAmTCBEYXRhXHJcbiAgcHJvZml0TG9zc0RhdGE6IENvbXBsZXRlUHJvZml0TG9zcyB8IG51bGw7XHJcbiAgY29tcGFyaXNvbkRhdGE6IFBlcmlvZENvbXBhcmlzb25EYXRhIHwgbnVsbDtcclxuXHJcbiAgLy8gQ29tcGFyaXNvbiBNb2RlXHJcbiAgY29tcGFyaXNvbk1vZGU6IENvbXBhcmlzb25Nb2RlO1xyXG4gIHNldENvbXBhcmlzb25Nb2RlOiAobW9kZTogQ29tcGFyaXNvbk1vZGUpID0+IHZvaWQ7XHJcblxyXG4gIC8vIExvYWRpbmcgU3RhdGVzXHJcbiAgbG9hZGluZ1BlcmlvZHM6IGJvb2xlYW47XHJcbiAgbG9hZGluZ0RhdGE6IGJvb2xlYW47XHJcbiAgbG9hZGluZ0NvbXBhcmlzb246IGJvb2xlYW47XHJcblxyXG4gIC8vIEVycm9yIFN0YXRlc1xyXG4gIHBlcmlvZHNFcnJvcjogc3RyaW5nIHwgbnVsbDtcclxuICBkYXRhRXJyb3I6IHN0cmluZyB8IG51bGw7XHJcbiAgY29tcGFyaXNvbkVycm9yOiBzdHJpbmcgfCBudWxsO1xyXG5cclxuICAvLyBBY3Rpb25zXHJcbiAgcmVmcmVzaFBlcmlvZHM6ICgpID0+IFByb21pc2U8dm9pZD47XHJcbiAgcmVmcmVzaERhdGE6ICgpID0+IFByb21pc2U8dm9pZD47XHJcbiAgaGFuZGxlRXhwb3J0Q1NWOiAoKSA9PiB2b2lkO1xyXG4gIGhhbmRsZUV4cG9ydEV4Y2VsOiAoKSA9PiB2b2lkO1xyXG4gIGhhbmRsZVVwbG9hZFN1Y2Nlc3M6IChwZXJpb2RJZDogc3RyaW5nKSA9PiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXNlUHJvZml0TG9zcygpOiBVc2VQcm9maXRMb3NzUmV0dXJuIHtcclxuICBjb25zdCBhdXRoID0gdXNlQXV0aCgpO1xyXG4gIGNvbnN0IHRva2VuID0gYXV0aC5zZXNzaW9uPy5hY2Nlc3NfdG9rZW47XHJcblxyXG4gIC8vIFN0YXRlOiBQZXJpb2RzXHJcbiAgY29uc3QgW3BlcmlvZHMsIHNldFBlcmlvZHNdID0gdXNlU3RhdGU8UHJvZml0TG9zc1BlcmlvZFtdPihbXSk7XHJcbiAgY29uc3QgW3NlbGVjdGVkUGVyaW9kSWQsIHNldFNlbGVjdGVkUGVyaW9kSWRdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XHJcbiAgY29uc3QgW2xvYWRpbmdQZXJpb2RzLCBzZXRMb2FkaW5nUGVyaW9kc10gPSB1c2VTdGF0ZSh0cnVlKTtcclxuICBjb25zdCBbcGVyaW9kc0Vycm9yLCBzZXRQZXJpb2RzRXJyb3JdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XHJcblxyXG4gIC8vIFN0YXRlOiBQJkwgRGF0YVxyXG4gIGNvbnN0IFtwcm9maXRMb3NzRGF0YSwgc2V0UHJvZml0TG9zc0RhdGFdID0gdXNlU3RhdGU8Q29tcGxldGVQcm9maXRMb3NzIHwgbnVsbD4obnVsbCk7XHJcbiAgY29uc3QgW2xvYWRpbmdEYXRhLCBzZXRMb2FkaW5nRGF0YV0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgY29uc3QgW2RhdGFFcnJvciwgc2V0RGF0YUVycm9yXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xyXG5cclxuICAvLyBTdGF0ZTogQ29tcGFyaXNvblxyXG4gIGNvbnN0IFtjb21wYXJpc29uTW9kZSwgc2V0Q29tcGFyaXNvbk1vZGVdID0gdXNlU3RhdGU8Q29tcGFyaXNvbk1vZGU+KFwibm9uZVwiKTtcclxuICBjb25zdCBbY29tcGFyaXNvbkRhdGEsIHNldENvbXBhcmlzb25EYXRhXSA9IHVzZVN0YXRlPFBlcmlvZENvbXBhcmlzb25EYXRhIHwgbnVsbD4obnVsbCk7XHJcbiAgY29uc3QgW2xvYWRpbmdDb21wYXJpc29uLCBzZXRMb2FkaW5nQ29tcGFyaXNvbl0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgY29uc3QgW2NvbXBhcmlzb25FcnJvciwgc2V0Q29tcGFyaXNvbkVycm9yXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8gTG9hZCBQZXJpb2RzIG9uIE1vdW50XHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICBjb25zdCBsb2FkUGVyaW9kcyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgc2V0TG9hZGluZ1BlcmlvZHMoZmFsc2UpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TG9hZGluZ1BlcmlvZHModHJ1ZSk7XHJcbiAgICBzZXRQZXJpb2RzRXJyb3IobnVsbCk7XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZmV0Y2hBbGxQZXJpb2RzKHRva2VuKTtcclxuXHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LmRhdGEpIHtcclxuICAgICAgc2V0UGVyaW9kcyhyZXN1bHQuZGF0YSk7XHJcblxyXG4gICAgICAvLyBBdXRvLXNlbGVjdCB0aGUgbW9zdCByZWNlbnQgcGVyaW9kIGlmIG5vbmUgc2VsZWN0ZWRcclxuICAgICAgaWYgKCFzZWxlY3RlZFBlcmlvZElkICYmIHJlc3VsdC5kYXRhLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBTb3J0IGJ5IGVuZCBkYXRlIGRlc2NlbmRpbmcgdG8gZ2V0IG1vc3QgcmVjZW50XHJcbiAgICAgICAgY29uc3Qgc29ydGVkUGVyaW9kcyA9IFsuLi5yZXN1bHQuZGF0YV0uc29ydChcclxuICAgICAgICAgIChhLCBiKSA9PiBuZXcgRGF0ZShiLnBlcmlvZF9lbmRfZGF0ZSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS5wZXJpb2RfZW5kX2RhdGUpLmdldFRpbWUoKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgc2V0U2VsZWN0ZWRQZXJpb2RJZChzb3J0ZWRQZXJpb2RzWzBdLmlkKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2V0UGVyaW9kc0Vycm9yKHJlc3VsdC5lcnJvciB8fCBcIkZhaWxlZCB0byBsb2FkIHBlcmlvZHNcIik7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TG9hZGluZ1BlcmlvZHMoZmFsc2UpO1xyXG4gIH0sIFt0b2tlbiwgc2VsZWN0ZWRQZXJpb2RJZF0pO1xyXG5cclxuICBjb25zdCByZWZyZXNoUGVyaW9kcyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIGF3YWl0IGxvYWRQZXJpb2RzKCk7XHJcbiAgfSwgW2xvYWRQZXJpb2RzXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICB2b2lkIGxvYWRQZXJpb2RzKCk7XHJcbiAgfSwgW2xvYWRQZXJpb2RzXSk7XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBMb2FkIFAmTCBEYXRhIHdoZW4gUGVyaW9kIENoYW5nZXNcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIGNvbnN0IGxvYWRQcm9maXRMb3NzRGF0YSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIGlmICghdG9rZW4gfHwgIXNlbGVjdGVkUGVyaW9kSWQpIHtcclxuICAgICAgc2V0UHJvZml0TG9zc0RhdGEobnVsbCk7XHJcbiAgICAgIHNldERhdGFFcnJvcihudWxsKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHNldExvYWRpbmdEYXRhKHRydWUpO1xyXG4gICAgc2V0RGF0YUVycm9yKG51bGwpO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZldGNoQ29tcGxldGVQcm9maXRMb3NzKHNlbGVjdGVkUGVyaW9kSWQsIHRva2VuKTtcclxuXHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LmRhdGEpIHtcclxuICAgICAgc2V0UHJvZml0TG9zc0RhdGEocmVzdWx0LmRhdGEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2V0RGF0YUVycm9yKHJlc3VsdC5lcnJvciB8fCBcIkZhaWxlZCB0byBsb2FkIFAmTCBkYXRhXCIpO1xyXG4gICAgICBzZXRQcm9maXRMb3NzRGF0YShudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRMb2FkaW5nRGF0YShmYWxzZSk7XHJcbiAgfSwgW3Rva2VuLCBzZWxlY3RlZFBlcmlvZElkXSk7XHJcblxyXG4gIGNvbnN0IHJlZnJlc2hEYXRhID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xyXG4gICAgYXdhaXQgbG9hZFByb2ZpdExvc3NEYXRhKCk7XHJcbiAgfSwgW2xvYWRQcm9maXRMb3NzRGF0YV0pO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgdm9pZCBsb2FkUHJvZml0TG9zc0RhdGEoKTtcclxuICB9LCBbbG9hZFByb2ZpdExvc3NEYXRhXSk7XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBMb2FkIENvbXBhcmlzb24gRGF0YSB3aGVuIE1vZGUgb3IgUGVyaW9kIENoYW5nZXNcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIGNvbnN0IGxvYWRDb21wYXJpc29uRGF0YSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIGlmICghdG9rZW4gfHwgIXNlbGVjdGVkUGVyaW9kSWQgfHwgY29tcGFyaXNvbk1vZGUgPT09IFwibm9uZVwiKSB7XHJcbiAgICAgIHNldENvbXBhcmlzb25EYXRhKG51bGwpO1xyXG4gICAgICBzZXRDb21wYXJpc29uRXJyb3IobnVsbCk7XHJcbiAgICAgIHNldExvYWRpbmdDb21wYXJpc29uKGZhbHNlKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHNldExvYWRpbmdDb21wYXJpc29uKHRydWUpO1xyXG4gICAgc2V0Q29tcGFyaXNvbkVycm9yKG51bGwpO1xyXG5cclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGZldGNoUGVyaW9kQ29tcGFyaXNvbihzZWxlY3RlZFBlcmlvZElkLCBjb21wYXJpc29uTW9kZSwgdG9rZW4pO1xyXG5cclxuICAgIGlmIChyZXN1bHQuc3VjY2VzcyAmJiByZXN1bHQuZGF0YSkge1xyXG4gICAgICBzZXRDb21wYXJpc29uRGF0YShyZXN1bHQuZGF0YSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZXRDb21wYXJpc29uRXJyb3IocmVzdWx0LmVycm9yIHx8IFwiRmFpbGVkIHRvIGxvYWQgY29tcGFyaXNvbiBkYXRhXCIpO1xyXG4gICAgICBzZXRDb21wYXJpc29uRGF0YShudWxsKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRMb2FkaW5nQ29tcGFyaXNvbihmYWxzZSk7XHJcbiAgfSwgW3Rva2VuLCBzZWxlY3RlZFBlcmlvZElkLCBjb21wYXJpc29uTW9kZV0pO1xyXG5cclxuICB1c2VFZmZlY3QoKCkgPT4ge1xyXG4gICAgdm9pZCBsb2FkQ29tcGFyaXNvbkRhdGEoKTtcclxuICB9LCBbbG9hZENvbXBhcmlzb25EYXRhXSk7XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBFeHBvcnQgSGFuZGxlcnNcclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcblxyXG4gIGNvbnN0IGhhbmRsZUV4cG9ydENTViA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIGlmICghcHJvZml0TG9zc0RhdGEpIHtcclxuICAgICAgYWxlcnQoXCJObyBkYXRhIHRvIGV4cG9ydFwiKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGV4cG9ydFByb2ZpdExvc3NUb0NTVihwcm9maXRMb3NzRGF0YSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGFsZXJ0KGBFeHBvcnQgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfSwgW3Byb2ZpdExvc3NEYXRhXSk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZUV4cG9ydEV4Y2VsID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xyXG4gICAgaWYgKCFwcm9maXRMb3NzRGF0YSkge1xyXG4gICAgICBhbGVydChcIk5vIGRhdGEgdG8gZXhwb3J0XCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgdm9pZCBleHBvcnRQcm9maXRMb3NzVG9FeGNlbChwcm9maXRMb3NzRGF0YSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGFsZXJ0KGBFeHBvcnQgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICB9XHJcbiAgfSwgW3Byb2ZpdExvc3NEYXRhXSk7XHJcblxyXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAvLyBVcGxvYWQgU3VjY2VzcyBIYW5kbGVyXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICBjb25zdCBoYW5kbGVVcGxvYWRTdWNjZXNzID0gdXNlQ2FsbGJhY2soXHJcbiAgICAocGVyaW9kSWQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAvLyBSZWxvYWQgcGVyaW9kcyB0byBpbmNsdWRlIHRoZSBuZXcgb25lXHJcbiAgICAgIHZvaWQgcmVmcmVzaFBlcmlvZHMoKTtcclxuXHJcbiAgICAgIC8vIFNlbGVjdCB0aGUgbmV3bHkgdXBsb2FkZWQgcGVyaW9kXHJcbiAgICAgIHNldFNlbGVjdGVkUGVyaW9kSWQocGVyaW9kSWQpO1xyXG4gICAgfSxcclxuICAgIFtyZWZyZXNoUGVyaW9kc11cclxuICApO1xyXG5cclxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAgLy8gUmV0dXJuXHJcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgLy8gUGVyaW9kc1xyXG4gICAgcGVyaW9kcyxcclxuICAgIHNlbGVjdGVkUGVyaW9kSWQsXHJcbiAgICBzZXRTZWxlY3RlZFBlcmlvZElkLFxyXG5cclxuICAgIC8vIFAmTCBEYXRhXHJcbiAgICBwcm9maXRMb3NzRGF0YSxcclxuICAgIGNvbXBhcmlzb25EYXRhLFxyXG5cclxuICAgIC8vIENvbXBhcmlzb24gTW9kZVxyXG4gICAgY29tcGFyaXNvbk1vZGUsXHJcbiAgICBzZXRDb21wYXJpc29uTW9kZSxcclxuXHJcbiAgICAvLyBMb2FkaW5nIFN0YXRlc1xyXG4gICAgbG9hZGluZ1BlcmlvZHMsXHJcbiAgICBsb2FkaW5nRGF0YSxcclxuICAgIGxvYWRpbmdDb21wYXJpc29uLFxyXG5cclxuICAgIC8vIEVycm9yIFN0YXRlc1xyXG4gICAgcGVyaW9kc0Vycm9yLFxyXG4gICAgZGF0YUVycm9yLFxyXG4gICAgY29tcGFyaXNvbkVycm9yLFxyXG5cclxuICAgIC8vIEFjdGlvbnNcclxuICAgIHJlZnJlc2hQZXJpb2RzLFxyXG4gICAgcmVmcmVzaERhdGEsXHJcbiAgICBoYW5kbGVFeHBvcnRDU1YsXHJcbiAgICBoYW5kbGVFeHBvcnRFeGNlbCxcclxuICAgIGhhbmRsZVVwbG9hZFN1Y2Nlc3MsXHJcbiAgfTtcclxufVxyXG4iXSwibWFwcGluZ3MiOiJBQWNBLFNBQVMsVUFBVSxXQUFXLG1CQUFtQjtBQUNqRCxTQUFTLGVBQWU7QUFDeEI7QUFBQSxFQUNFO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLE9BS0s7QUFrQ0EsZ0JBQVMsZ0JBQXFDO0FBQ25ELFFBQU0sT0FBTyxRQUFRO0FBQ3JCLFFBQU0sUUFBUSxLQUFLLFNBQVM7QUFHNUIsUUFBTSxDQUFDLFNBQVMsVUFBVSxJQUFJLFNBQTZCLENBQUMsQ0FBQztBQUM3RCxRQUFNLENBQUMsa0JBQWtCLG1CQUFtQixJQUFJLFNBQXdCLElBQUk7QUFDNUUsUUFBTSxDQUFDLGdCQUFnQixpQkFBaUIsSUFBSSxTQUFTLElBQUk7QUFDekQsUUFBTSxDQUFDLGNBQWMsZUFBZSxJQUFJLFNBQXdCLElBQUk7QUFHcEUsUUFBTSxDQUFDLGdCQUFnQixpQkFBaUIsSUFBSSxTQUFvQyxJQUFJO0FBQ3BGLFFBQU0sQ0FBQyxhQUFhLGNBQWMsSUFBSSxTQUFTLEtBQUs7QUFDcEQsUUFBTSxDQUFDLFdBQVcsWUFBWSxJQUFJLFNBQXdCLElBQUk7QUFHOUQsUUFBTSxDQUFD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