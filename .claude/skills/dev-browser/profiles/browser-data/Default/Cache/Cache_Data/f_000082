import {
  CATEGORY_KEYWORDS,
  VENDOR_CATEGORY_MAP,
  PRODUCT_CATEGORY_KEYWORDS
} from "/src/lib/ads/constants.ts";
import { detectVendorFromTitle } from "/src/lib/ads/utils/validators.ts";
export function suggestCategoryFromTitle(title) {
  if (!title) return { category: "", confidence: 0 };
  const titleLower = title.toLowerCase();
  let bestCategory = "";
  let bestScore = 0;
  for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
    for (const keyword of keywords) {
      if (titleLower.includes(keyword.toLowerCase())) {
        const score = keyword.split(" ").length;
        if (score > bestScore) {
          bestScore = score;
          bestCategory = category;
        }
      }
    }
  }
  const confidence = bestScore >= 2 ? Math.min(100, bestScore * 30) : bestScore * 20;
  return { category: bestCategory, confidence };
}
export function suggestProductCategoryFromTitle(title, vendorCategories) {
  if (!title) return { category: "", confidence: 0 };
  const titleLower = title.toLowerCase();
  let bestCategory = "";
  let bestScore = 0;
  for (const [category, keywords] of Object.entries(PRODUCT_CATEGORY_KEYWORDS)) {
    if (vendorCategories && vendorCategories.length > 0) {
      if (!vendorCategories.includes(category)) continue;
    }
    for (const keyword of keywords) {
      if (titleLower.includes(keyword.toLowerCase())) {
        const score = keyword.split(" ").length * 2;
        if (score > bestScore) {
          bestScore = score;
          bestCategory = category;
        }
      }
    }
  }
  if (!bestCategory) {
    for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
      if (vendorCategories && vendorCategories.length > 0) {
        if (!vendorCategories.includes(category)) continue;
      }
      for (const keyword of keywords) {
        if (titleLower.includes(keyword.toLowerCase())) {
          const score = keyword.split(" ").length;
          if (score > bestScore) {
            bestScore = score;
            bestCategory = category;
          }
        }
      }
    }
  }
  const confidence = bestScore >= 2 ? Math.min(100, bestScore * 30) : bestScore * 20;
  return { category: bestCategory, confidence };
}
export function suggestCategoriesForRow(vendor, title) {
  const result = {
    overallCategory: "",
    overallConfidence: 0,
    productCategory: "",
    productConfidence: 0,
    vendorProductCategories: []
  };
  if (!vendor && !title) return result;
  const vendorNormalized = vendor?.trim() || "";
  let vendorMapping = VENDOR_CATEGORY_MAP[vendorNormalized];
  if (!vendorMapping && vendorNormalized) {
    const vendorLower = vendorNormalized.toLowerCase();
    for (const [key, value] of Object.entries(VENDOR_CATEGORY_MAP)) {
      if (key.toLowerCase() === vendorLower) {
        vendorMapping = value;
        break;
      }
    }
  }
  if (vendorMapping) {
    result.overallCategory = vendorMapping.overall;
    result.overallConfidence = 95;
    result.vendorProductCategories = vendorMapping.productCategories;
    if (title) {
      const productSuggestion = suggestProductCategoryFromTitle(title, vendorMapping.productCategories);
      if (productSuggestion.category) {
        result.productCategory = productSuggestion.category;
        result.productConfidence = productSuggestion.confidence;
      }
    }
  } else {
    if (title) {
      const detectedVendor = detectVendorFromTitle(title);
      if (detectedVendor) {
        const detectedMapping = VENDOR_CATEGORY_MAP[detectedVendor];
        if (detectedMapping) {
          result.overallCategory = detectedMapping.overall;
          result.overallConfidence = 70;
          result.vendorProductCategories = detectedMapping.productCategories;
          const productSuggestion = suggestProductCategoryFromTitle(title, detectedMapping.productCategories);
          if (productSuggestion.category) {
            result.productCategory = productSuggestion.category;
            result.productConfidence = Math.min(productSuggestion.confidence, 70);
          }
        }
      }
      if (!result.overallCategory) {
        const generalCategory = suggestCategoryFromTitle(title);
        if (generalCategory.category) {
          result.productCategory = generalCategory.category;
          result.productConfidence = 40;
        }
      }
    }
  }
  return result;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhdGVnb3J5LXN1Z2dlc3Rlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ2F0ZWdvcnkgc3VnZ2VzdGlvbiB1dGlsaXRpZXMgZm9yIGFkcyBwcm9jZXNzaW5nLlxyXG4gKiBQcm92aWRlcyBmdW5jdGlvbnMgdG8gYXV0by1zdWdnZXN0IGNhdGVnb3JpZXMgYmFzZWQgb24gcHJvZHVjdCB0aXRsZXMgYW5kIHZlbmRvciBtYXBwaW5ncy5cclxuICovXHJcblxyXG5pbXBvcnQge1xyXG4gIENBVEVHT1JZX0tFWVdPUkRTLFxyXG4gIFZFTkRPUl9DQVRFR09SWV9NQVAsXHJcbiAgUFJPRFVDVF9DQVRFR09SWV9LRVlXT1JEUyxcclxufSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XHJcbmltcG9ydCB0eXBlIHsgQ2F0ZWdvcnlTdWdnZXN0aW9uIH0gZnJvbSBcIi4uL3R5cGVzXCI7XHJcbmltcG9ydCB7IGRldGVjdFZlbmRvckZyb21UaXRsZSB9IGZyb20gXCIuL3ZhbGlkYXRvcnNcIjtcclxuXHJcbi8qKlxyXG4gKiBSZXN1bHQgZnJvbSBpbnRlcm5hbCBjYXRlZ29yeSBzdWdnZXN0aW9uIHdpdGggY29uZmlkZW5jZSBzY29yZVxyXG4gKi9cclxuaW50ZXJmYWNlIENhdGVnb3J5V2l0aENvbmZpZGVuY2Uge1xyXG4gIGNhdGVnb3J5OiBzdHJpbmc7XHJcbiAgY29uZmlkZW5jZTogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogU3VnZ2VzdCBjYXRlZ29yeSBmcm9tIHRpdGxlIHVzaW5nIGdlbmVyYWwgY2F0ZWdvcnkga2V5d29yZHMuXHJcbiAqIFJldHVybnMgdGhlIGJlc3QgbWF0Y2hpbmcgY2F0ZWdvcnkgYmFzZWQgb24ga2V5d29yZCBzcGVjaWZpY2l0eS5cclxuICpcclxuICogQHBhcmFtIHRpdGxlIC0gUHJvZHVjdCB0aXRsZSB0byBhbmFseXplXHJcbiAqIEByZXR1cm5zIE9iamVjdCB3aXRoIGNhdGVnb3J5IG5hbWUgYW5kIGNvbmZpZGVuY2Ugc2NvcmUgKDAtMTAwKVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHN1Z2dlc3RDYXRlZ29yeUZyb21UaXRsZSh0aXRsZTogc3RyaW5nKTogQ2F0ZWdvcnlXaXRoQ29uZmlkZW5jZSB7XHJcbiAgaWYgKCF0aXRsZSkgcmV0dXJuIHsgY2F0ZWdvcnk6IFwiXCIsIGNvbmZpZGVuY2U6IDAgfTtcclxuXHJcbiAgY29uc3QgdGl0bGVMb3dlciA9IHRpdGxlLnRvTG93ZXJDYXNlKCk7XHJcbiAgbGV0IGJlc3RDYXRlZ29yeSA9IFwiXCI7XHJcbiAgbGV0IGJlc3RTY29yZSA9IDA7XHJcblxyXG4gIGZvciAoY29uc3QgW2NhdGVnb3J5LCBrZXl3b3Jkc10gb2YgT2JqZWN0LmVudHJpZXMoQ0FURUdPUllfS0VZV09SRFMpKSB7XHJcbiAgICBmb3IgKGNvbnN0IGtleXdvcmQgb2Yga2V5d29yZHMpIHtcclxuICAgICAgaWYgKHRpdGxlTG93ZXIuaW5jbHVkZXMoa2V5d29yZC50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgIC8vIFNjb3JlIGJhc2VkIG9uIGtleXdvcmQgc3BlY2lmaWNpdHkgKGxvbmdlciA9IG1vcmUgc3BlY2lmaWMpXHJcbiAgICAgICAgY29uc3Qgc2NvcmUgPSBrZXl3b3JkLnNwbGl0KFwiIFwiKS5sZW5ndGg7XHJcbiAgICAgICAgaWYgKHNjb3JlID4gYmVzdFNjb3JlKSB7XHJcbiAgICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTtcclxuICAgICAgICAgIGJlc3RDYXRlZ29yeSA9IGNhdGVnb3J5O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQ29uZmlkZW5jZTogc2NhbGVzIGJhc2VkIG9uIGtleXdvcmQgbWF0Y2ggcXVhbGl0eVxyXG4gIGNvbnN0IGNvbmZpZGVuY2UgPSBiZXN0U2NvcmUgPj0gMiA/IE1hdGgubWluKDEwMCwgYmVzdFNjb3JlICogMzApIDogYmVzdFNjb3JlICogMjA7XHJcblxyXG4gIHJldHVybiB7IGNhdGVnb3J5OiBiZXN0Q2F0ZWdvcnksIGNvbmZpZGVuY2UgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFN1Z2dlc3QgcHJvZHVjdCBjYXRlZ29yeSBmcm9tIHRpdGxlIHVzaW5nIGRldGFpbGVkIGtleXdvcmQgcGF0dGVybnMuXHJcbiAqIE9wdGlvbmFsbHkgY29uc3RyYWluZWQgdG8gYSBsaXN0IG9mIHZhbGlkIHZlbmRvciBjYXRlZ29yaWVzLlxyXG4gKlxyXG4gKiBAcGFyYW0gdGl0bGUgLSBQcm9kdWN0IHRpdGxlIHRvIGFuYWx5emVcclxuICogQHBhcmFtIHZlbmRvckNhdGVnb3JpZXMgLSBPcHRpb25hbCBhcnJheSBvZiB2YWxpZCBjYXRlZ29yaWVzIGZvciB0aGUgdmVuZG9yXHJcbiAqIEByZXR1cm5zIE9iamVjdCB3aXRoIGNhdGVnb3J5IG5hbWUgYW5kIGNvbmZpZGVuY2Ugc2NvcmUgKDAtMTAwKVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHN1Z2dlc3RQcm9kdWN0Q2F0ZWdvcnlGcm9tVGl0bGUoXHJcbiAgdGl0bGU6IHN0cmluZyxcclxuICB2ZW5kb3JDYXRlZ29yaWVzPzogc3RyaW5nW11cclxuKTogQ2F0ZWdvcnlXaXRoQ29uZmlkZW5jZSB7XHJcbiAgaWYgKCF0aXRsZSkgcmV0dXJuIHsgY2F0ZWdvcnk6IFwiXCIsIGNvbmZpZGVuY2U6IDAgfTtcclxuXHJcbiAgY29uc3QgdGl0bGVMb3dlciA9IHRpdGxlLnRvTG93ZXJDYXNlKCk7XHJcbiAgbGV0IGJlc3RDYXRlZ29yeSA9IFwiXCI7XHJcbiAgbGV0IGJlc3RTY29yZSA9IDA7XHJcblxyXG4gIGZvciAoY29uc3QgW2NhdGVnb3J5LCBrZXl3b3Jkc10gb2YgT2JqZWN0LmVudHJpZXMoUFJPRFVDVF9DQVRFR09SWV9LRVlXT1JEUykpIHtcclxuICAgIC8vIElmIHdlIGhhdmUgdmVuZG9yIGNhdGVnb3JpZXMsIG9ubHkgY29uc2lkZXIgY2F0ZWdvcmllcyBpbiB0aGF0IGxpc3RcclxuICAgIGlmICh2ZW5kb3JDYXRlZ29yaWVzICYmIHZlbmRvckNhdGVnb3JpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBpZiAoIXZlbmRvckNhdGVnb3JpZXMuaW5jbHVkZXMoY2F0ZWdvcnkpKSBjb250aW51ZTtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGNvbnN0IGtleXdvcmQgb2Yga2V5d29yZHMpIHtcclxuICAgICAgaWYgKHRpdGxlTG93ZXIuaW5jbHVkZXMoa2V5d29yZC50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgIC8vIFNjb3JlIGJhc2VkIG9uIGtleXdvcmQgc3BlY2lmaWNpdHkgKGxvbmdlciBwaHJhc2VzID0gbW9yZSBzcGVjaWZpYylcclxuICAgICAgICBjb25zdCBzY29yZSA9IGtleXdvcmQuc3BsaXQoXCIgXCIpLmxlbmd0aCAqIDI7XHJcbiAgICAgICAgaWYgKHNjb3JlID4gYmVzdFNjb3JlKSB7XHJcbiAgICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTtcclxuICAgICAgICAgIGJlc3RDYXRlZ29yeSA9IGNhdGVnb3J5O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWxzbyBjaGVjayB0aGUgZ2VuZXJhbCBDQVRFR09SWV9LRVlXT1JEUyBmb3IgZmFsbGJhY2tcclxuICBpZiAoIWJlc3RDYXRlZ29yeSkge1xyXG4gICAgZm9yIChjb25zdCBbY2F0ZWdvcnksIGtleXdvcmRzXSBvZiBPYmplY3QuZW50cmllcyhDQVRFR09SWV9LRVlXT1JEUykpIHtcclxuICAgICAgaWYgKHZlbmRvckNhdGVnb3JpZXMgJiYgdmVuZG9yQ2F0ZWdvcmllcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgaWYgKCF2ZW5kb3JDYXRlZ29yaWVzLmluY2x1ZGVzKGNhdGVnb3J5KSkgY29udGludWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAoY29uc3Qga2V5d29yZCBvZiBrZXl3b3Jkcykge1xyXG4gICAgICAgIGlmICh0aXRsZUxvd2VyLmluY2x1ZGVzKGtleXdvcmQudG9Mb3dlckNhc2UoKSkpIHtcclxuICAgICAgICAgIGNvbnN0IHNjb3JlID0ga2V5d29yZC5zcGxpdChcIiBcIikubGVuZ3RoO1xyXG4gICAgICAgICAgaWYgKHNjb3JlID4gYmVzdFNjb3JlKSB7XHJcbiAgICAgICAgICAgIGJlc3RTY29yZSA9IHNjb3JlO1xyXG4gICAgICAgICAgICBiZXN0Q2F0ZWdvcnkgPSBjYXRlZ29yeTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIENvbmZpZGVuY2U6IDEwMCUgaWYgbXVsdGktd29yZCBtYXRjaCwgc2NhbGVzIGRvd24gZm9yIHNpbmdsZSB3b3Jkc1xyXG4gIGNvbnN0IGNvbmZpZGVuY2UgPSBiZXN0U2NvcmUgPj0gMiA/IE1hdGgubWluKDEwMCwgYmVzdFNjb3JlICogMzApIDogYmVzdFNjb3JlICogMjA7XHJcblxyXG4gIHJldHVybiB7IGNhdGVnb3J5OiBiZXN0Q2F0ZWdvcnksIGNvbmZpZGVuY2UgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFN1Z2dlc3QgYm90aCBvdmVyYWxsIGFuZCBwcm9kdWN0IGNhdGVnb3J5IGZvciBhbiBhZCByb3cuXHJcbiAqIFVzZXMgdmVuZG9yIG1hcHBpbmcgKyB0aXRsZSBrZXl3b3JkIGFuYWx5c2lzIGZvciBjb21wcmVoZW5zaXZlIGNhdGVnb3J5IHN1Z2dlc3Rpb24uXHJcbiAqXHJcbiAqIEBwYXJhbSB2ZW5kb3IgLSBWZW5kb3IgbmFtZSAoY2FuIGJlIGVtcHR5KVxyXG4gKiBAcGFyYW0gdGl0bGUgLSBQcm9kdWN0IHRpdGxlIChjYW4gYmUgZW1wdHkpXHJcbiAqIEByZXR1cm5zIENhdGVnb3J5U3VnZ2VzdGlvbiB3aXRoIG92ZXJhbGwgYW5kIHByb2R1Y3QgY2F0ZWdvcnkgc3VnZ2VzdGlvbnNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzdWdnZXN0Q2F0ZWdvcmllc0ZvclJvdyhcclxuICB2ZW5kb3I6IHN0cmluZyxcclxuICB0aXRsZTogc3RyaW5nXHJcbik6IENhdGVnb3J5U3VnZ2VzdGlvbiB7XHJcbiAgY29uc3QgcmVzdWx0OiBDYXRlZ29yeVN1Z2dlc3Rpb24gPSB7XHJcbiAgICBvdmVyYWxsQ2F0ZWdvcnk6IFwiXCIsXHJcbiAgICBvdmVyYWxsQ29uZmlkZW5jZTogMCxcclxuICAgIHByb2R1Y3RDYXRlZ29yeTogXCJcIixcclxuICAgIHByb2R1Y3RDb25maWRlbmNlOiAwLFxyXG4gICAgdmVuZG9yUHJvZHVjdENhdGVnb3JpZXM6IFtdLFxyXG4gIH07XHJcblxyXG4gIGlmICghdmVuZG9yICYmICF0aXRsZSkgcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgLy8gTm9ybWFsaXplIHZlbmRvciBuYW1lIGZvciBsb29rdXBcclxuICBjb25zdCB2ZW5kb3JOb3JtYWxpemVkID0gdmVuZG9yPy50cmltKCkgfHwgXCJcIjtcclxuXHJcbiAgLy8gMS4gQ2hlY2sgaWYgdmVuZG9yIGlzIGluIG91ciBtYXBwaW5nIChjYXNlLWluc2Vuc2l0aXZlKVxyXG4gIGxldCB2ZW5kb3JNYXBwaW5nID0gVkVORE9SX0NBVEVHT1JZX01BUFt2ZW5kb3JOb3JtYWxpemVkXTtcclxuXHJcbiAgLy8gSWYgbm8gZXhhY3QgbWF0Y2gsIHRyeSBjYXNlLWluc2Vuc2l0aXZlIGxvb2t1cFxyXG4gIGlmICghdmVuZG9yTWFwcGluZyAmJiB2ZW5kb3JOb3JtYWxpemVkKSB7XHJcbiAgICBjb25zdCB2ZW5kb3JMb3dlciA9IHZlbmRvck5vcm1hbGl6ZWQudG9Mb3dlckNhc2UoKTtcclxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKFZFTkRPUl9DQVRFR09SWV9NQVApKSB7XHJcbiAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gdmVuZG9yTG93ZXIpIHtcclxuICAgICAgICB2ZW5kb3JNYXBwaW5nID0gdmFsdWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmICh2ZW5kb3JNYXBwaW5nKSB7XHJcbiAgICAvLyBIaWdoIGNvbmZpZGVuY2Ugb3ZlcmFsbCBjYXRlZ29yeSBmcm9tIHZlbmRvclxyXG4gICAgcmVzdWx0Lm92ZXJhbGxDYXRlZ29yeSA9IHZlbmRvck1hcHBpbmcub3ZlcmFsbDtcclxuICAgIHJlc3VsdC5vdmVyYWxsQ29uZmlkZW5jZSA9IDk1O1xyXG4gICAgcmVzdWx0LnZlbmRvclByb2R1Y3RDYXRlZ29yaWVzID0gdmVuZG9yTWFwcGluZy5wcm9kdWN0Q2F0ZWdvcmllcztcclxuXHJcbiAgICAvLyBUcnkgdG8gZGV0ZXJtaW5lIHByb2R1Y3QgY2F0ZWdvcnkgZnJvbSB0aXRsZSB3aXRoaW4gdmVuZG9yJ3MgY2F0ZWdvcmllc1xyXG4gICAgaWYgKHRpdGxlKSB7XHJcbiAgICAgIGNvbnN0IHByb2R1Y3RTdWdnZXN0aW9uID0gc3VnZ2VzdFByb2R1Y3RDYXRlZ29yeUZyb21UaXRsZSh0aXRsZSwgdmVuZG9yTWFwcGluZy5wcm9kdWN0Q2F0ZWdvcmllcyk7XHJcbiAgICAgIGlmIChwcm9kdWN0U3VnZ2VzdGlvbi5jYXRlZ29yeSkge1xyXG4gICAgICAgIHJlc3VsdC5wcm9kdWN0Q2F0ZWdvcnkgPSBwcm9kdWN0U3VnZ2VzdGlvbi5jYXRlZ29yeTtcclxuICAgICAgICByZXN1bHQucHJvZHVjdENvbmZpZGVuY2UgPSBwcm9kdWN0U3VnZ2VzdGlvbi5jb25maWRlbmNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIE5vIHZlbmRvciBtYXBwaW5nIC0gdHJ5IHRvIGluZmVyIGZyb20gdGl0bGVcclxuICAgIGlmICh0aXRsZSkge1xyXG4gICAgICAvLyBUcnkgdG8gZGV0ZWN0IHZlbmRvciBmcm9tIHRpdGxlXHJcbiAgICAgIGNvbnN0IGRldGVjdGVkVmVuZG9yID0gZGV0ZWN0VmVuZG9yRnJvbVRpdGxlKHRpdGxlKTtcclxuICAgICAgaWYgKGRldGVjdGVkVmVuZG9yKSB7XHJcbiAgICAgICAgY29uc3QgZGV0ZWN0ZWRNYXBwaW5nID0gVkVORE9SX0NBVEVHT1JZX01BUFtkZXRlY3RlZFZlbmRvcl07XHJcbiAgICAgICAgaWYgKGRldGVjdGVkTWFwcGluZykge1xyXG4gICAgICAgICAgcmVzdWx0Lm92ZXJhbGxDYXRlZ29yeSA9IGRldGVjdGVkTWFwcGluZy5vdmVyYWxsO1xyXG4gICAgICAgICAgcmVzdWx0Lm92ZXJhbGxDb25maWRlbmNlID0gNzA7IC8vIExvd2VyIGNvbmZpZGVuY2Ugc2luY2UgdmVuZG9yIHdhcyBpbmZlcnJlZFxyXG4gICAgICAgICAgcmVzdWx0LnZlbmRvclByb2R1Y3RDYXRlZ29yaWVzID0gZGV0ZWN0ZWRNYXBwaW5nLnByb2R1Y3RDYXRlZ29yaWVzO1xyXG5cclxuICAgICAgICAgIGNvbnN0IHByb2R1Y3RTdWdnZXN0aW9uID0gc3VnZ2VzdFByb2R1Y3RDYXRlZ29yeUZyb21UaXRsZSh0aXRsZSwgZGV0ZWN0ZWRNYXBwaW5nLnByb2R1Y3RDYXRlZ29yaWVzKTtcclxuICAgICAgICAgIGlmIChwcm9kdWN0U3VnZ2VzdGlvbi5jYXRlZ29yeSkge1xyXG4gICAgICAgICAgICByZXN1bHQucHJvZHVjdENhdGVnb3J5ID0gcHJvZHVjdFN1Z2dlc3Rpb24uY2F0ZWdvcnk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5wcm9kdWN0Q29uZmlkZW5jZSA9IE1hdGgubWluKHByb2R1Y3RTdWdnZXN0aW9uLmNvbmZpZGVuY2UsIDcwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIElmIHN0aWxsIG5vIG92ZXJhbGwgY2F0ZWdvcnksIHRyeSBnZW5lcmFsIGtleXdvcmQgbWF0Y2hpbmdcclxuICAgICAgaWYgKCFyZXN1bHQub3ZlcmFsbENhdGVnb3J5KSB7XHJcbiAgICAgICAgY29uc3QgZ2VuZXJhbENhdGVnb3J5ID0gc3VnZ2VzdENhdGVnb3J5RnJvbVRpdGxlKHRpdGxlKTtcclxuICAgICAgICBpZiAoZ2VuZXJhbENhdGVnb3J5LmNhdGVnb3J5KSB7XHJcbiAgICAgICAgICByZXN1bHQucHJvZHVjdENhdGVnb3J5ID0gZ2VuZXJhbENhdGVnb3J5LmNhdGVnb3J5O1xyXG4gICAgICAgICAgcmVzdWx0LnByb2R1Y3RDb25maWRlbmNlID0gNDA7IC8vIExvdyBjb25maWRlbmNlIGZvciBnZW5lcmFsIG1hdGNoaW5nXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBS0E7QUFBQSxFQUNFO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxPQUNLO0FBRVAsU0FBUyw2QkFBNkI7QUFpQi9CLGdCQUFTLHlCQUF5QixPQUF1QztBQUM5RSxNQUFJLENBQUMsTUFBTyxRQUFPLEVBQUUsVUFBVSxJQUFJLFlBQVksRUFBRTtBQUVqRCxRQUFNLGFBQWEsTUFBTSxZQUFZO0FBQ3JDLE1BQUksZUFBZTtBQUNuQixNQUFJLFlBQVk7QUFFaEIsYUFBVyxDQUFDLFVBQVUsUUFBUSxLQUFLLE9BQU8sUUFBUSxpQkFBaUIsR0FBRztBQUNwRSxlQUFXLFdBQVcsVUFBVTtBQUM5QixVQUFJLFdBQVcsU0FBUyxRQUFRLFlBQVksQ0FBQyxHQUFHO0FBRTlDLGNBQU0sUUFBUSxRQUFRLE1BQU0sR0FBRyxFQUFFO0FBQ2pDLFlBQUksUUFBUSxXQUFXO0FBQ3JCLHNCQUFZO0FBQ1oseUJBQWU7QUFBQSxRQUNqQjtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUdBLFFBQU0sYUFBYSxhQUFhLElBQUksS0FBSyxJQUFJLEtBQUssWUFBWSxFQUFFLElBQUksWUFBWTtBQUVoRixTQUFPLEVBQUUsVUFBVSxjQUFjLFdBQVc7QUFDOUM7QUFVTyxnQkFBUyxnQ0FDZCxPQUNBLGtCQUN3QjtBQUN4QixNQUFJLENBQUMsTUFBTyxRQUFPLEVBQUUsVUFBVSxJQUFJLFlBQVksRUFBRTtBQUVqRCxRQUFNLGFBQWEsTUFBTSxZQUFZO0FBQ3JDLE1BQUksZUFBZTtBQUNuQixNQUFJLFlBQVk7QUFFaEIsYUFB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