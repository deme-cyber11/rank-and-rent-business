import.meta.env = {"BASE_URL": "/", "DEV": true, "MODE": "development", "PROD": false, "SSR": false, "VITE_ANTHROPIC_API_KEY": "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", "VITE_GOOGLE_CLIENT_ID": "936844622088-66b5k3k5ohjo06ib7gc3sftai4j7cuij.apps.googleusercontent.com", "VITE_GOOGLE_SHEETS_API_KEY": "AIzaSyCZHv0oBOXYyolGXRMRPP9EttPXQlas_lQ", "VITE_GOOGLE_SHEETS_ID": "1wCc6qFA0aMIqlhCjndqMYKM3n6Iotbcsdwyl-SDPt4k", "VITE_LENDERS_GOOGLE_SHEETS_ID": "1_VMU_ifeNJvfLBf7OxvA_MqWHzYXMaX_7BFUHLHLBak", "VITE_OPENAI_API_KEY": "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", "VITE_SUPABASE_ANON_KEY": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95bXdzZnlzcGR2YmF6a2xxa3BtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMDIyMzUsImV4cCI6MjA3NDg3ODIzNX0.EZUSSmzDwZkqhOvdjcDp6KoZd_Au3i5xRm5t7QlosmU", "VITE_SUPABASE_URL": "https://oymwsfyspdvbazklqkpm.supabase.co"};import __vite__cjsImport0_react from "/node_modules/.vite/deps/react.js?v=aadb9797"; const useState = __vite__cjsImport0_react["useState"]; const useEffect = __vite__cjsImport0_react["useEffect"]; const useCallback = __vite__cjsImport0_react["useCallback"];
import { supabase } from "/src/lib/supabase.ts";
import { useAuth } from "/src/hooks/useAuth.tsx";
const GOOGLE_CLIENT_ID = import.meta.env.VITE_GOOGLE_CLIENT_ID;
const GOOGLE_OAUTH_SCOPES = [
  "https://www.googleapis.com/auth/gmail.compose",
  "https://www.googleapis.com/auth/gmail.readonly"
].join(" ");
function generateOAuthState() {
  const array = new Uint8Array(32);
  crypto.getRandomValues(array);
  return Array.from(array, (byte) => byte.toString(16).padStart(2, "0")).join("");
}
function parseOAuthCallback(url) {
  const urlParams = new URLSearchParams(new URL(url).search);
  return {
    code: urlParams.get("code"),
    state: urlParams.get("state"),
    error: urlParams.get("error")
  };
}
export const useGmailOAuth = () => {
  const { user, session } = useAuth();
  const [state, setState] = useState({
    isGmailConnected: false,
    gmailEmail: null,
    connectedAt: null,
    lastUsedAt: null,
    isLoading: true,
    error: null
  });
  const checkGmailConnection = useCallback(async () => {
    if (!user?.id) {
      setState((prev) => ({
        ...prev,
        isGmailConnected: false,
        gmailEmail: null,
        connectedAt: null,
        lastUsedAt: null,
        isLoading: false
      }));
      return;
    }
    try {
      setState((prev) => ({ ...prev, isLoading: true, error: null }));
      const { data, error } = await supabase.from("gmail_oauth_tokens").select("email, is_valid, connected_at, last_used_at").eq("user_id", user.id).single();
      if (error) {
        if (error.code === "PGRST116") {
          setState((prev) => ({
            ...prev,
            isGmailConnected: false,
            gmailEmail: null,
            connectedAt: null,
            lastUsedAt: null,
            isLoading: false
          }));
          return;
        }
        throw error;
      }
      const tokenRecord = data;
      setState((prev) => ({
        ...prev,
        isGmailConnected: tokenRecord.is_valid,
        gmailEmail: tokenRecord.is_valid ? tokenRecord.email : null,
        connectedAt: tokenRecord.connected_at,
        lastUsedAt: tokenRecord.last_used_at,
        isLoading: false
      }));
    } catch (err) {
      console.error("[useGmailOAuth] Error checking connection:", err);
      setState((prev) => ({
        ...prev,
        isGmailConnected: false,
        gmailEmail: null,
        isLoading: false,
        error: err instanceof Error ? err.message : "Failed to check Gmail connection"
      }));
    }
  }, [user?.id]);
  useEffect(() => {
    checkGmailConnection();
  }, [checkGmailConnection]);
  const connectGmail = useCallback(async () => {
    if (!GOOGLE_CLIENT_ID) {
      setState((prev) => ({
        ...prev,
        error: "Google OAuth is not configured. Missing VITE_GOOGLE_CLIENT_ID."
      }));
      return false;
    }
    if (!session?.access_token) {
      setState((prev) => ({
        ...prev,
        error: "You must be logged in to connect Gmail."
      }));
      return false;
    }
    setState((prev) => ({ ...prev, error: null }));
    const oauthState = generateOAuthState();
    const redirectUri = `${window.location.origin}/auth/gmail-callback`;
    localStorage.setItem("gmail_oauth_state", oauthState);
    localStorage.setItem("gmail_oauth_session_token", session.access_token);
    localStorage.setItem("gmail_oauth_return_url", window.location.href);
    const authUrl = new URL("https://accounts.google.com/o/oauth2/v2/auth");
    authUrl.searchParams.set("client_id", GOOGLE_CLIENT_ID);
    authUrl.searchParams.set("redirect_uri", redirectUri);
    authUrl.searchParams.set("response_type", "code");
    authUrl.searchParams.set("scope", GOOGLE_OAUTH_SCOPES);
    authUrl.searchParams.set("state", oauthState);
    authUrl.searchParams.set("access_type", "offline");
    authUrl.searchParams.set("prompt", "consent");
    window.location.href = authUrl.toString();
    return true;
  }, [session?.access_token]);
  const handleOAuthCallback = useCallback(
    async (callbackUrl) => {
      const { code, state: returnedState, error: oauthError } = parseOAuthCallback(callbackUrl);
      if (oauthError) {
        return { success: false, error: `OAuth error: ${oauthError}` };
      }
      if (!code) {
        return { success: false, error: "No authorization code received" };
      }
      const storedState = localStorage.getItem("gmail_oauth_state");
      const storedSessionToken = localStorage.getItem("gmail_oauth_session_token");
      if (!storedState || storedState !== returnedState) {
        return { success: false, error: "Invalid state parameter. Possible CSRF attack." };
      }
      if (!storedSessionToken) {
        return { success: false, error: "Session expired. Please try again." };
      }
      localStorage.removeItem("gmail_oauth_state");
      localStorage.removeItem("gmail_oauth_session_token");
      try {
        const redirectUri = `${window.location.origin}/auth/gmail-callback`;
        const { data, error } = await supabase.functions.invoke("exchange-gmail-code", {
          body: {
            code,
            redirect_uri: redirectUri
          },
          headers: {
            Authorization: `Bearer ${storedSessionToken}`
          }
        });
        if (error) {
          console.error("[useGmailOAuth] Token exchange error:", error);
          return { success: false, error: error.message || "Failed to exchange authorization code" };
        }
        if (!data?.success) {
          return { success: false, error: data?.error || "Failed to connect Gmail" };
        }
        return { success: true };
      } catch (err) {
        console.error("[useGmailOAuth] Callback error:", err);
        return {
          success: false,
          error: err instanceof Error ? err.message : "Failed to complete Gmail connection"
        };
      }
    },
    []
  );
  const disconnectGmail = useCallback(async () => {
    if (!user?.id) {
      setState((prev) => ({
        ...prev,
        error: "You must be logged in to disconnect Gmail."
      }));
      return false;
    }
    try {
      setState((prev) => ({ ...prev, isLoading: true, error: null }));
      const { error } = await supabase.from("gmail_oauth_tokens").delete().eq("user_id", user.id);
      if (error) {
        throw error;
      }
      setState({
        isGmailConnected: false,
        gmailEmail: null,
        connectedAt: null,
        lastUsedAt: null,
        isLoading: false,
        error: null
      });
      return true;
    } catch (err) {
      console.error("[useGmailOAuth] Disconnect error:", err);
      setState((prev) => ({
        ...prev,
        isLoading: false,
        error: err instanceof Error ? err.message : "Failed to disconnect Gmail"
      }));
      return false;
    }
  }, [user?.id]);
  const createDraft = useCallback(
    async (to, subject, body, attachments) => {
      if (!session?.access_token) {
        return { success: false, error: "You must be logged in to create drafts." };
      }
      if (!state.isGmailConnected) {
        return { success: false, error: "Gmail is not connected. Please connect your Gmail account first." };
      }
      try {
        const { data, error } = await supabase.functions.invoke("create-gmail-draft", {
          body: {
            to,
            subject,
            body,
            attachments
          },
          headers: {
            Authorization: `Bearer ${session.access_token}`
          }
        });
        if (error) {
          console.error("[useGmailOAuth] Create draft error:", error);
          return { success: false, error: error.message || "Failed to create draft" };
        }
        if (!data?.success) {
          if (data?.error?.includes("reconnect") || data?.error?.includes("invalid")) {
            await checkGmailConnection();
          }
          return { success: false, error: data?.error || "Failed to create draft" };
        }
        return {
          success: true,
          draftId: data.draftId,
          webLink: data.webLink
        };
      } catch (err) {
        console.error("[useGmailOAuth] Create draft error:", err);
        return {
          success: false,
          error: err instanceof Error ? err.message : "Failed to create draft"
        };
      }
    },
    [session?.access_token, state.isGmailConnected, checkGmailConnection]
  );
  const clearError = useCallback(() => {
    setState((prev) => ({ ...prev, error: null }));
  }, []);
  return {
    // State
    isGmailConnected: state.isGmailConnected,
    gmailEmail: state.gmailEmail,
    connectedAt: state.connectedAt,
    lastUsedAt: state.lastUsedAt,
    isLoading: state.isLoading,
    error: state.error,
    // Actions
    checkGmailConnection,
    connectGmail,
    handleOAuthCallback,
    disconnectGmail,
    createDraft,
    clearError
  };
};
export const useGmailOAuthCallback = () => {
  const [status, setStatus] = useState("loading");
  const [error, setError] = useState(null);
  useEffect(() => {
    const handleCallback = async () => {
      const callbackUrl = window.location.href;
      const { code, state: returnedState, error: oauthError } = parseOAuthCallback(callbackUrl);
      const returnUrl = localStorage.getItem("gmail_oauth_return_url") || "/logins";
      if (oauthError) {
        setError(`Google OAuth error: ${oauthError}`);
        setStatus("error");
        localStorage.removeItem("gmail_oauth_state");
        localStorage.removeItem("gmail_oauth_session_token");
        localStorage.removeItem("gmail_oauth_return_url");
        setTimeout(() => {
          window.location.href = returnUrl;
        }, 2e3);
        return;
      }
      if (!code) {
        setError("No authorization code received");
        setStatus("error");
        localStorage.removeItem("gmail_oauth_state");
        localStorage.removeItem("gmail_oauth_session_token");
        localStorage.removeItem("gmail_oauth_return_url");
        setTimeout(() => {
          window.location.href = returnUrl;
        }, 2e3);
        return;
      }
      const storedState = localStorage.getItem("gmail_oauth_state");
      const storedSessionToken = localStorage.getItem("gmail_oauth_session_token");
      if (!storedState || storedState !== returnedState) {
        setError("Invalid state parameter");
        setStatus("error");
        localStorage.removeItem("gmail_oauth_state");
        localStorage.removeItem("gmail_oauth_session_token");
        localStorage.removeItem("gmail_oauth_return_url");
        setTimeout(() => {
          window.location.href = returnUrl;
        }, 2e3);
        return;
      }
      if (!storedSessionToken) {
        setError("Session expired");
        setStatus("error");
        localStorage.removeItem("gmail_oauth_state");
        localStorage.removeItem("gmail_oauth_session_token");
        localStorage.removeItem("gmail_oauth_return_url");
        setTimeout(() => {
          window.location.href = returnUrl;
        }, 2e3);
        return;
      }
      localStorage.removeItem("gmail_oauth_state");
      localStorage.removeItem("gmail_oauth_session_token");
      localStorage.removeItem("gmail_oauth_return_url");
      try {
        const redirectUri = `${window.location.origin}/auth/gmail-callback`;
        const { data, error: fnError } = await supabase.functions.invoke("exchange-gmail-code", {
          body: {
            code,
            redirect_uri: redirectUri
          },
          headers: {
            Authorization: `Bearer ${storedSessionToken}`
          }
        });
        if (fnError || !data?.success) {
          const errorMsg = fnError?.message || data?.error || "Failed to exchange code";
          setError(errorMsg);
          setStatus("error");
          setTimeout(() => {
            window.location.href = returnUrl;
          }, 2e3);
          return;
        }
        setStatus("success");
        setTimeout(() => {
          window.location.href = returnUrl;
        }, 1500);
      } catch (err) {
        const errorMsg = err instanceof Error ? err.message : "Unknown error";
        setError(errorMsg);
        setStatus("error");
        setTimeout(() => {
          window.location.href = returnUrl;
        }, 2e3);
      }
    };
    handleCallback();
  }, []);
  return { status, error };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZUdtYWlsT0F1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi4vbGliL3N1cGFiYXNlJztcclxuaW1wb3J0IHsgdXNlQXV0aCB9IGZyb20gJy4vdXNlQXV0aCc7XHJcblxyXG4vLyBHb29nbGUgT0F1dGggY29uZmlndXJhdGlvblxyXG5jb25zdCBHT09HTEVfQ0xJRU5UX0lEID0gaW1wb3J0Lm1ldGEuZW52LlZJVEVfR09PR0xFX0NMSUVOVF9JRDtcclxuY29uc3QgR09PR0xFX09BVVRIX1NDT1BFUyA9IFtcclxuICAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9nbWFpbC5jb21wb3NlJyxcclxuICAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9nbWFpbC5yZWFkb25seScsXHJcbl0uam9pbignICcpO1xyXG5cclxuaW50ZXJmYWNlIEdtYWlsT0F1dGhTdGF0ZSB7XHJcbiAgaXNHbWFpbENvbm5lY3RlZDogYm9vbGVhbjtcclxuICBnbWFpbEVtYWlsOiBzdHJpbmcgfCBudWxsO1xyXG4gIGNvbm5lY3RlZEF0OiBzdHJpbmcgfCBudWxsO1xyXG4gIGxhc3RVc2VkQXQ6IHN0cmluZyB8IG51bGw7XHJcbiAgaXNMb2FkaW5nOiBib29sZWFuO1xyXG4gIGVycm9yOiBzdHJpbmcgfCBudWxsO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQXR0YWNobWVudCB7XHJcbiAgZmlsZW5hbWU6IHN0cmluZztcclxuICBtaW1lVHlwZTogc3RyaW5nO1xyXG4gIGJhc2U2NERhdGE6IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIENyZWF0ZURyYWZ0UmVzdWx0IHtcclxuICBzdWNjZXNzOiBib29sZWFuO1xyXG4gIGRyYWZ0SWQ/OiBzdHJpbmc7XHJcbiAgd2ViTGluaz86IHN0cmluZztcclxuICBlcnJvcj86IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIEdtYWlsVG9rZW5SZWNvcmQge1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbiAgaXNfdmFsaWQ6IGJvb2xlYW47XHJcbiAgY29ubmVjdGVkX2F0OiBzdHJpbmcgfCBudWxsO1xyXG4gIGxhc3RfdXNlZF9hdDogc3RyaW5nIHwgbnVsbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdlbmVyYXRlIGEgcmFuZG9tIHN0YXRlIHBhcmFtZXRlciBmb3IgT0F1dGggc2VjdXJpdHlcclxuICovXHJcbmZ1bmN0aW9uIGdlbmVyYXRlT0F1dGhTdGF0ZSgpOiBzdHJpbmcge1xyXG4gIGNvbnN0IGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoMzIpO1xyXG4gIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyYXkpO1xyXG4gIHJldHVybiBBcnJheS5mcm9tKGFycmF5LCAoYnl0ZSkgPT4gYnl0ZS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKSkuam9pbignJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQYXJzZSB0aGUgT0F1dGggY2FsbGJhY2sgVVJMIHRvIGV4dHJhY3QgY29kZSBhbmQgc3RhdGVcclxuICovXHJcbmZ1bmN0aW9uIHBhcnNlT0F1dGhDYWxsYmFjayh1cmw6IHN0cmluZyk6IHsgY29kZTogc3RyaW5nIHwgbnVsbDsgc3RhdGU6IHN0cmluZyB8IG51bGw7IGVycm9yOiBzdHJpbmcgfCBudWxsIH0ge1xyXG4gIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMobmV3IFVSTCh1cmwpLnNlYXJjaCk7XHJcbiAgcmV0dXJuIHtcclxuICAgIGNvZGU6IHVybFBhcmFtcy5nZXQoJ2NvZGUnKSxcclxuICAgIHN0YXRlOiB1cmxQYXJhbXMuZ2V0KCdzdGF0ZScpLFxyXG4gICAgZXJyb3I6IHVybFBhcmFtcy5nZXQoJ2Vycm9yJyksXHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHVzZUdtYWlsT0F1dGggPSAoKSA9PiB7XHJcbiAgY29uc3QgeyB1c2VyLCBzZXNzaW9uIH0gPSB1c2VBdXRoKCk7XHJcbiAgY29uc3QgW3N0YXRlLCBzZXRTdGF0ZV0gPSB1c2VTdGF0ZTxHbWFpbE9BdXRoU3RhdGU+KHtcclxuICAgIGlzR21haWxDb25uZWN0ZWQ6IGZhbHNlLFxyXG4gICAgZ21haWxFbWFpbDogbnVsbCxcclxuICAgIGNvbm5lY3RlZEF0OiBudWxsLFxyXG4gICAgbGFzdFVzZWRBdDogbnVsbCxcclxuICAgIGlzTG9hZGluZzogdHJ1ZSxcclxuICAgIGVycm9yOiBudWxsLFxyXG4gIH0pO1xyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBpZiB1c2VyIGhhcyBhIHZhbGlkIEdtYWlsIGNvbm5lY3Rpb25cclxuICAgKi9cclxuICBjb25zdCBjaGVja0dtYWlsQ29ubmVjdGlvbiA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIGlmICghdXNlcj8uaWQpIHtcclxuICAgICAgc2V0U3RhdGUoKHByZXYpID0+ICh7XHJcbiAgICAgICAgLi4ucHJldixcclxuICAgICAgICBpc0dtYWlsQ29ubmVjdGVkOiBmYWxzZSxcclxuICAgICAgICBnbWFpbEVtYWlsOiBudWxsLFxyXG4gICAgICAgIGNvbm5lY3RlZEF0OiBudWxsLFxyXG4gICAgICAgIGxhc3RVc2VkQXQ6IG51bGwsXHJcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgfSkpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgc2V0U3RhdGUoKHByZXYpID0+ICh7IC4uLnByZXYsIGlzTG9hZGluZzogdHJ1ZSwgZXJyb3I6IG51bGwgfSkpO1xyXG5cclxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbSgnZ21haWxfb2F1dGhfdG9rZW5zJylcclxuICAgICAgICAuc2VsZWN0KCdlbWFpbCwgaXNfdmFsaWQsIGNvbm5lY3RlZF9hdCwgbGFzdF91c2VkX2F0JylcclxuICAgICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIC8vIE5vIHJlY29yZCBmb3VuZCAtIHVzZXIgbm90IGNvbm5lY3RlZFxyXG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XHJcbiAgICAgICAgICBzZXRTdGF0ZSgocHJldikgPT4gKHtcclxuICAgICAgICAgICAgLi4ucHJldixcclxuICAgICAgICAgICAgaXNHbWFpbENvbm5lY3RlZDogZmFsc2UsXHJcbiAgICAgICAgICAgIGdtYWlsRW1haWw6IG51bGwsXHJcbiAgICAgICAgICAgIGNvbm5lY3RlZEF0OiBudWxsLFxyXG4gICAgICAgICAgICBsYXN0VXNlZEF0OiBudWxsLFxyXG4gICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxyXG4gICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgdG9rZW5SZWNvcmQgPSBkYXRhIGFzIEdtYWlsVG9rZW5SZWNvcmQ7XHJcbiAgICAgIHNldFN0YXRlKChwcmV2KSA9PiAoe1xyXG4gICAgICAgIC4uLnByZXYsXHJcbiAgICAgICAgaXNHbWFpbENvbm5lY3RlZDogdG9rZW5SZWNvcmQuaXNfdmFsaWQsXHJcbiAgICAgICAgZ21haWxFbWFpbDogdG9rZW5SZWNvcmQuaXNfdmFsaWQgPyB0b2tlblJlY29yZC5lbWFpbCA6IG51bGwsXHJcbiAgICAgICAgY29ubmVjdGVkQXQ6IHRva2VuUmVjb3JkLmNvbm5lY3RlZF9hdCxcclxuICAgICAgICBsYXN0VXNlZEF0OiB0b2tlblJlY29yZC5sYXN0X3VzZWRfYXQsXHJcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgfSkpO1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1t1c2VHbWFpbE9BdXRoXSBFcnJvciBjaGVja2luZyBjb25uZWN0aW9uOicsIGVycik7XHJcbiAgICAgIHNldFN0YXRlKChwcmV2KSA9PiAoe1xyXG4gICAgICAgIC4uLnByZXYsXHJcbiAgICAgICAgaXNHbWFpbENvbm5lY3RlZDogZmFsc2UsXHJcbiAgICAgICAgZ21haWxFbWFpbDogbnVsbCxcclxuICAgICAgICBpc0xvYWRpbmc6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogJ0ZhaWxlZCB0byBjaGVjayBHbWFpbCBjb25uZWN0aW9uJyxcclxuICAgICAgfSkpO1xyXG4gICAgfVxyXG4gIH0sIFt1c2VyPy5pZF0pO1xyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBjb25uZWN0aW9uIG9uIG1vdW50IGFuZCB3aGVuIHVzZXIgY2hhbmdlc1xyXG4gICAqL1xyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBjaGVja0dtYWlsQ29ubmVjdGlvbigpO1xyXG4gIH0sIFtjaGVja0dtYWlsQ29ubmVjdGlvbl0pO1xyXG5cclxuICAvKipcclxuICAgKiBJbml0aWF0ZSBHbWFpbCBPQXV0aCBjb25uZWN0aW9uIGZsb3dcclxuICAgKiBVc2VzIHJlZGlyZWN0LWJhc2VkIGZsb3cgKG5vdCBwb3B1cCkgdG8gYXZvaWQgQ09PUCBpc3N1ZXNcclxuICAgKi9cclxuICBjb25zdCBjb25uZWN0R21haWwgPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XHJcbiAgICBpZiAoIUdPT0dMRV9DTElFTlRfSUQpIHtcclxuICAgICAgc2V0U3RhdGUoKHByZXYpID0+ICh7XHJcbiAgICAgICAgLi4ucHJldixcclxuICAgICAgICBlcnJvcjogJ0dvb2dsZSBPQXV0aCBpcyBub3QgY29uZmlndXJlZC4gTWlzc2luZyBWSVRFX0dPT0dMRV9DTElFTlRfSUQuJyxcclxuICAgICAgfSkpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFzZXNzaW9uPy5hY2Nlc3NfdG9rZW4pIHtcclxuICAgICAgc2V0U3RhdGUoKHByZXYpID0+ICh7XHJcbiAgICAgICAgLi4ucHJldixcclxuICAgICAgICBlcnJvcjogJ1lvdSBtdXN0IGJlIGxvZ2dlZCBpbiB0byBjb25uZWN0IEdtYWlsLicsXHJcbiAgICAgIH0pKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFN0YXRlKChwcmV2KSA9PiAoeyAuLi5wcmV2LCBlcnJvcjogbnVsbCB9KSk7XHJcblxyXG4gICAgLy8gR2VuZXJhdGUgc3RhdGUgZm9yIENTUkYgcHJvdGVjdGlvblxyXG4gICAgY29uc3Qgb2F1dGhTdGF0ZSA9IGdlbmVyYXRlT0F1dGhTdGF0ZSgpO1xyXG4gICAgY29uc3QgcmVkaXJlY3RVcmkgPSBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9hdXRoL2dtYWlsLWNhbGxiYWNrYDtcclxuXHJcbiAgICAvLyBTdG9yZSBzdGF0ZSBhbmQgcmV0dXJuIFVSTCBpbiBsb2NhbFN0b3JhZ2UgZm9yIHZlcmlmaWNhdGlvbiBhZnRlciByZWRpcmVjdFxyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2dtYWlsX29hdXRoX3N0YXRlJywgb2F1dGhTdGF0ZSk7XHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZ21haWxfb2F1dGhfc2Vzc2lvbl90b2tlbicsIHNlc3Npb24uYWNjZXNzX3Rva2VuKTtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdnbWFpbF9vYXV0aF9yZXR1cm5fdXJsJywgd2luZG93LmxvY2F0aW9uLmhyZWYpO1xyXG5cclxuICAgIC8vIEJ1aWxkIEdvb2dsZSBPQXV0aCBVUkxcclxuICAgIGNvbnN0IGF1dGhVcmwgPSBuZXcgVVJMKCdodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvdjIvYXV0aCcpO1xyXG4gICAgYXV0aFVybC5zZWFyY2hQYXJhbXMuc2V0KCdjbGllbnRfaWQnLCBHT09HTEVfQ0xJRU5UX0lEKTtcclxuICAgIGF1dGhVcmwuc2VhcmNoUGFyYW1zLnNldCgncmVkaXJlY3RfdXJpJywgcmVkaXJlY3RVcmkpO1xyXG4gICAgYXV0aFVybC5zZWFyY2hQYXJhbXMuc2V0KCdyZXNwb25zZV90eXBlJywgJ2NvZGUnKTtcclxuICAgIGF1dGhVcmwuc2VhcmNoUGFyYW1zLnNldCgnc2NvcGUnLCBHT09HTEVfT0FVVEhfU0NPUEVTKTtcclxuICAgIGF1dGhVcmwuc2VhcmNoUGFyYW1zLnNldCgnc3RhdGUnLCBvYXV0aFN0YXRlKTtcclxuICAgIGF1dGhVcmwuc2VhcmNoUGFyYW1zLnNldCgnYWNjZXNzX3R5cGUnLCAnb2ZmbGluZScpO1xyXG4gICAgYXV0aFVybC5zZWFyY2hQYXJhbXMuc2V0KCdwcm9tcHQnLCAnY29uc2VudCcpOyAvLyBGb3JjZSBjb25zZW50IHRvIGdldCByZWZyZXNoIHRva2VuXHJcblxyXG4gICAgLy8gUmVkaXJlY3QgdG8gR29vZ2xlIE9BdXRoIChub3QgcG9wdXApXHJcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGF1dGhVcmwudG9TdHJpbmcoKTtcclxuXHJcbiAgICByZXR1cm4gdHJ1ZTsgLy8gV2lsbCByZWRpcmVjdCwgc28gdGhpcyBkb2Vzbid0IHJlYWxseSBtYXR0ZXJcclxuICB9LCBbc2Vzc2lvbj8uYWNjZXNzX3Rva2VuXSk7XHJcblxyXG4gIC8qKlxyXG4gICAqIEhhbmRsZSB0aGUgT0F1dGggY2FsbGJhY2sgLSBjYWxsZWQgZnJvbSB0aGUgY2FsbGJhY2sgcGFnZVxyXG4gICAqIEV4Y2hhbmdlcyBhdXRob3JpemF0aW9uIGNvZGUgZm9yIHRva2VucyBhbmQgc3RvcmVzIHRoZW1cclxuICAgKi9cclxuICBjb25zdCBoYW5kbGVPQXV0aENhbGxiYWNrID0gdXNlQ2FsbGJhY2soXHJcbiAgICBhc3luYyAoY2FsbGJhY2tVcmw6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9PiA9PiB7XHJcbiAgICAgIGNvbnN0IHsgY29kZSwgc3RhdGU6IHJldHVybmVkU3RhdGUsIGVycm9yOiBvYXV0aEVycm9yIH0gPSBwYXJzZU9BdXRoQ2FsbGJhY2soY2FsbGJhY2tVcmwpO1xyXG5cclxuICAgICAgaWYgKG9hdXRoRXJyb3IpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGBPQXV0aCBlcnJvcjogJHtvYXV0aEVycm9yfWAgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFjb2RlKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gYXV0aG9yaXphdGlvbiBjb2RlIHJlY2VpdmVkJyB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWZXJpZnkgc3RhdGUgcGFyYW1ldGVyXHJcbiAgICAgIGNvbnN0IHN0b3JlZFN0YXRlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dtYWlsX29hdXRoX3N0YXRlJyk7XHJcbiAgICAgIGNvbnN0IHN0b3JlZFNlc3Npb25Ub2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnbWFpbF9vYXV0aF9zZXNzaW9uX3Rva2VuJyk7XHJcblxyXG4gICAgICBpZiAoIXN0b3JlZFN0YXRlIHx8IHN0b3JlZFN0YXRlICE9PSByZXR1cm5lZFN0YXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBzdGF0ZSBwYXJhbWV0ZXIuIFBvc3NpYmxlIENTUkYgYXR0YWNrLicgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFzdG9yZWRTZXNzaW9uVG9rZW4pIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdTZXNzaW9uIGV4cGlyZWQuIFBsZWFzZSB0cnkgYWdhaW4uJyB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDbGVhbiB1cCBzdG9yZWQgc3RhdGVcclxuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2dtYWlsX29hdXRoX3N0YXRlJyk7XHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnbWFpbF9vYXV0aF9zZXNzaW9uX3Rva2VuJyk7XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJlZGlyZWN0VXJpID0gYCR7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0vYXV0aC9nbWFpbC1jYWxsYmFja2A7XHJcblxyXG4gICAgICAgIC8vIEV4Y2hhbmdlIGF1dGhvcml6YXRpb24gY29kZSBmb3IgdG9rZW5zIHZpYSBHb29nbGUncyB0b2tlbiBlbmRwb2ludFxyXG4gICAgICAgIC8vIE5vdGU6IFRoaXMgbXVzdCBiZSBkb25lIHNlcnZlci1zaWRlIGluIHByb2R1Y3Rpb24gYXMgaXQgcmVxdWlyZXMgY2xpZW50X3NlY3JldFxyXG4gICAgICAgIC8vIEZvciBub3csIHdlJ2xsIGNhbGwgb3VyIGVkZ2UgZnVuY3Rpb24gd2hpY2ggaGFuZGxlcyB0aGUgZXhjaGFuZ2VcclxuICAgICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mdW5jdGlvbnMuaW52b2tlKCdleGNoYW5nZS1nbWFpbC1jb2RlJywge1xyXG4gICAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgICBjb2RlLFxyXG4gICAgICAgICAgICByZWRpcmVjdF91cmk6IHJlZGlyZWN0VXJpLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3N0b3JlZFNlc3Npb25Ub2tlbn1gLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdbdXNlR21haWxPQXV0aF0gVG9rZW4gZXhjaGFuZ2UgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZXhjaGFuZ2UgYXV0aG9yaXphdGlvbiBjb2RlJyB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFkYXRhPy5zdWNjZXNzKSB7XHJcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGRhdGE/LmVycm9yIHx8ICdGYWlsZWQgdG8gY29ubmVjdCBHbWFpbCcgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcclxuICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignW3VzZUdtYWlsT0F1dGhdIENhbGxiYWNrIGVycm9yOicsIGVycik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNvbXBsZXRlIEdtYWlsIGNvbm5lY3Rpb24nLFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBbXVxyXG4gICk7XHJcblxyXG4gIC8qKlxyXG4gICAqIERpc2Nvbm5lY3QgR21haWwgLSByZW1vdmVzIHN0b3JlZCB0b2tlbnNcclxuICAgKi9cclxuICBjb25zdCBkaXNjb25uZWN0R21haWwgPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTxib29sZWFuPiA9PiB7XHJcbiAgICBpZiAoIXVzZXI/LmlkKSB7XHJcbiAgICAgIHNldFN0YXRlKChwcmV2KSA9PiAoe1xyXG4gICAgICAgIC4uLnByZXYsXHJcbiAgICAgICAgZXJyb3I6ICdZb3UgbXVzdCBiZSBsb2dnZWQgaW4gdG8gZGlzY29ubmVjdCBHbWFpbC4nLFxyXG4gICAgICB9KSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBzZXRTdGF0ZSgocHJldikgPT4gKHsgLi4ucHJldiwgaXNMb2FkaW5nOiB0cnVlLCBlcnJvcjogbnVsbCB9KSk7XHJcblxyXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKCdnbWFpbF9vYXV0aF90b2tlbnMnKVxyXG4gICAgICAgIC5kZWxldGUoKVxyXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXIuaWQpO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHNldFN0YXRlKHtcclxuICAgICAgICBpc0dtYWlsQ29ubmVjdGVkOiBmYWxzZSxcclxuICAgICAgICBnbWFpbEVtYWlsOiBudWxsLFxyXG4gICAgICAgIGNvbm5lY3RlZEF0OiBudWxsLFxyXG4gICAgICAgIGxhc3RVc2VkQXQ6IG51bGwsXHJcbiAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdbdXNlR21haWxPQXV0aF0gRGlzY29ubmVjdCBlcnJvcjonLCBlcnIpO1xyXG4gICAgICBzZXRTdGF0ZSgocHJldikgPT4gKHtcclxuICAgICAgICAuLi5wcmV2LFxyXG4gICAgICAgIGlzTG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGRpc2Nvbm5lY3QgR21haWwnLFxyXG4gICAgICB9KSk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9LCBbdXNlcj8uaWRdKTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlIGEgR21haWwgZHJhZnQgd2l0aCBvcHRpb25hbCBhdHRhY2htZW50c1xyXG4gICAqIFJldHVybnMgdGhlIHdlYiBsaW5rIHRvIG9wZW4gdGhlIGRyYWZ0IGluIEdtYWlsXHJcbiAgICovXHJcbiAgY29uc3QgY3JlYXRlRHJhZnQgPSB1c2VDYWxsYmFjayhcclxuICAgIGFzeW5jIChcclxuICAgICAgdG86IHN0cmluZyxcclxuICAgICAgc3ViamVjdDogc3RyaW5nLFxyXG4gICAgICBib2R5OiBzdHJpbmcsXHJcbiAgICAgIGF0dGFjaG1lbnRzPzogQXR0YWNobWVudFtdXHJcbiAgICApOiBQcm9taXNlPENyZWF0ZURyYWZ0UmVzdWx0PiA9PiB7XHJcbiAgICAgIGlmICghc2Vzc2lvbj8uYWNjZXNzX3Rva2VuKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnWW91IG11c3QgYmUgbG9nZ2VkIGluIHRvIGNyZWF0ZSBkcmFmdHMuJyB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIXN0YXRlLmlzR21haWxDb25uZWN0ZWQpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdHbWFpbCBpcyBub3QgY29ubmVjdGVkLiBQbGVhc2UgY29ubmVjdCB5b3VyIEdtYWlsIGFjY291bnQgZmlyc3QuJyB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZ1bmN0aW9ucy5pbnZva2UoJ2NyZWF0ZS1nbWFpbC1kcmFmdCcsIHtcclxuICAgICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgICAgdG8sXHJcbiAgICAgICAgICAgIHN1YmplY3QsXHJcbiAgICAgICAgICAgIGJvZHksXHJcbiAgICAgICAgICAgIGF0dGFjaG1lbnRzLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Nlc3Npb24uYWNjZXNzX3Rva2VufWAsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1t1c2VHbWFpbE9BdXRoXSBDcmVhdGUgZHJhZnQgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gY3JlYXRlIGRyYWZ0JyB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFkYXRhPy5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgZXJyb3IgaW5kaWNhdGVzIGludmFsaWQgdG9rZW5zIC0gdHJpZ2dlciByZS1jaGVja1xyXG4gICAgICAgICAgaWYgKGRhdGE/LmVycm9yPy5pbmNsdWRlcygncmVjb25uZWN0JykgfHwgZGF0YT8uZXJyb3I/LmluY2x1ZGVzKCdpbnZhbGlkJykpIHtcclxuICAgICAgICAgICAgYXdhaXQgY2hlY2tHbWFpbENvbm5lY3Rpb24oKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZGF0YT8uZXJyb3IgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgZHJhZnQnIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgIGRyYWZ0SWQ6IGRhdGEuZHJhZnRJZCxcclxuICAgICAgICAgIHdlYkxpbms6IGRhdGEud2ViTGluayxcclxuICAgICAgICB9O1xyXG4gICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdbdXNlR21haWxPQXV0aF0gQ3JlYXRlIGRyYWZ0IGVycm9yOicsIGVycik7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIGNyZWF0ZSBkcmFmdCcsXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIFtzZXNzaW9uPy5hY2Nlc3NfdG9rZW4sIHN0YXRlLmlzR21haWxDb25uZWN0ZWQsIGNoZWNrR21haWxDb25uZWN0aW9uXVxyXG4gICk7XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFyIHRoZSBjdXJyZW50IGVycm9yXHJcbiAgICovXHJcbiAgY29uc3QgY2xlYXJFcnJvciA9IHVzZUNhbGxiYWNrKCgpID0+IHtcclxuICAgIHNldFN0YXRlKChwcmV2KSA9PiAoeyAuLi5wcmV2LCBlcnJvcjogbnVsbCB9KSk7XHJcbiAgfSwgW10pO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgLy8gU3RhdGVcclxuICAgIGlzR21haWxDb25uZWN0ZWQ6IHN0YXRlLmlzR21haWxDb25uZWN0ZWQsXHJcbiAgICBnbWFpbEVtYWlsOiBzdGF0ZS5nbWFpbEVtYWlsLFxyXG4gICAgY29ubmVjdGVkQXQ6IHN0YXRlLmNvbm5lY3RlZEF0LFxyXG4gICAgbGFzdFVzZWRBdDogc3RhdGUubGFzdFVzZWRBdCxcclxuICAgIGlzTG9hZGluZzogc3RhdGUuaXNMb2FkaW5nLFxyXG4gICAgZXJyb3I6IHN0YXRlLmVycm9yLFxyXG5cclxuICAgIC8vIEFjdGlvbnNcclxuICAgIGNoZWNrR21haWxDb25uZWN0aW9uLFxyXG4gICAgY29ubmVjdEdtYWlsLFxyXG4gICAgaGFuZGxlT0F1dGhDYWxsYmFjayxcclxuICAgIGRpc2Nvbm5lY3RHbWFpbCxcclxuICAgIGNyZWF0ZURyYWZ0LFxyXG4gICAgY2xlYXJFcnJvcixcclxuICB9O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEhlbHBlciBob29rIGZvciB0aGUgY2FsbGJhY2sgcGFnZSB0byBoYW5kbGUgT0F1dGggcmVzcG9uc2VcclxuICogVXNlcyByZWRpcmVjdC1iYXNlZCBmbG93IC0gcmVkaXJlY3RzIGJhY2sgdG8gb3JpZ2luYWwgcGFnZSBhZnRlciBwcm9jZXNzaW5nXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgdXNlR21haWxPQXV0aENhbGxiYWNrID0gKCkgPT4ge1xyXG4gIGNvbnN0IFtzdGF0dXMsIHNldFN0YXR1c10gPSB1c2VTdGF0ZTwnbG9hZGluZycgfCAnc3VjY2VzcycgfCAnZXJyb3InPignbG9hZGluZycpO1xyXG4gIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBjb25zdCBoYW5kbGVDYWxsYmFjayA9IGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY2FsbGJhY2tVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICAgICAgY29uc3QgeyBjb2RlLCBzdGF0ZTogcmV0dXJuZWRTdGF0ZSwgZXJyb3I6IG9hdXRoRXJyb3IgfSA9IHBhcnNlT0F1dGhDYWxsYmFjayhjYWxsYmFja1VybCk7XHJcblxyXG4gICAgICAvLyBHZXQgcmV0dXJuIFVSTCBmcm9tIGxvY2FsU3RvcmFnZVxyXG4gICAgICBjb25zdCByZXR1cm5VcmwgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZ21haWxfb2F1dGhfcmV0dXJuX3VybCcpIHx8ICcvbG9naW5zJztcclxuXHJcbiAgICAgIC8vIEhhbmRsZSBlcnJvciBmcm9tIEdvb2dsZVxyXG4gICAgICBpZiAob2F1dGhFcnJvcikge1xyXG4gICAgICAgIHNldEVycm9yKGBHb29nbGUgT0F1dGggZXJyb3I6ICR7b2F1dGhFcnJvcn1gKTtcclxuICAgICAgICBzZXRTdGF0dXMoJ2Vycm9yJyk7XHJcbiAgICAgICAgLy8gQ2xlYW4gdXAgYW5kIHJlZGlyZWN0IGFmdGVyIGRlbGF5XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2dtYWlsX29hdXRoX3N0YXRlJyk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2dtYWlsX29hdXRoX3Nlc3Npb25fdG9rZW4nKTtcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZ21haWxfb2F1dGhfcmV0dXJuX3VybCcpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXR1cm5Vcmw7XHJcbiAgICAgICAgfSwgMjAwMCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWYWxpZGF0ZSBjb2RlXHJcbiAgICAgIGlmICghY29kZSkge1xyXG4gICAgICAgIHNldEVycm9yKCdObyBhdXRob3JpemF0aW9uIGNvZGUgcmVjZWl2ZWQnKTtcclxuICAgICAgICBzZXRTdGF0dXMoJ2Vycm9yJyk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2dtYWlsX29hdXRoX3N0YXRlJyk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2dtYWlsX29hdXRoX3Nlc3Npb25fdG9rZW4nKTtcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZ21haWxfb2F1dGhfcmV0dXJuX3VybCcpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXR1cm5Vcmw7XHJcbiAgICAgICAgfSwgMjAwMCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWZXJpZnkgc3RhdGUgcGFyYW1ldGVyICh1c2luZyBsb2NhbFN0b3JhZ2UpXHJcbiAgICAgIGNvbnN0IHN0b3JlZFN0YXRlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dtYWlsX29hdXRoX3N0YXRlJyk7XHJcbiAgICAgIGNvbnN0IHN0b3JlZFNlc3Npb25Ub2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnbWFpbF9vYXV0aF9zZXNzaW9uX3Rva2VuJyk7XHJcblxyXG4gICAgICBpZiAoIXN0b3JlZFN0YXRlIHx8IHN0b3JlZFN0YXRlICE9PSByZXR1cm5lZFN0YXRlKSB7XHJcbiAgICAgICAgc2V0RXJyb3IoJ0ludmFsaWQgc3RhdGUgcGFyYW1ldGVyJyk7XHJcbiAgICAgICAgc2V0U3RhdHVzKCdlcnJvcicpO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnbWFpbF9vYXV0aF9zdGF0ZScpO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnbWFpbF9vYXV0aF9zZXNzaW9uX3Rva2VuJyk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2dtYWlsX29hdXRoX3JldHVybl91cmwnKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmV0dXJuVXJsO1xyXG4gICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKCFzdG9yZWRTZXNzaW9uVG9rZW4pIHtcclxuICAgICAgICBzZXRFcnJvcignU2Vzc2lvbiBleHBpcmVkJyk7XHJcbiAgICAgICAgc2V0U3RhdHVzKCdlcnJvcicpO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnbWFpbF9vYXV0aF9zdGF0ZScpO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnbWFpbF9vYXV0aF9zZXNzaW9uX3Rva2VuJyk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2dtYWlsX29hdXRoX3JldHVybl91cmwnKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmV0dXJuVXJsO1xyXG4gICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ2xlYW4gdXAgc3RvcmVkIHN0YXRlXHJcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdnbWFpbF9vYXV0aF9zdGF0ZScpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZ21haWxfb2F1dGhfc2Vzc2lvbl90b2tlbicpO1xyXG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZ21haWxfb2F1dGhfcmV0dXJuX3VybCcpO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZWRpcmVjdFVyaSA9IGAke3dpbmRvdy5sb2NhdGlvbi5vcmlnaW59L2F1dGgvZ21haWwtY2FsbGJhY2tgO1xyXG5cclxuICAgICAgICAvLyBFeGNoYW5nZSB0aGUgY29kZSBmb3IgdG9rZW5zIHZpYSBlZGdlIGZ1bmN0aW9uXHJcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvcjogZm5FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnVuY3Rpb25zLmludm9rZSgnZXhjaGFuZ2UtZ21haWwtY29kZScsIHtcclxuICAgICAgICAgIGJvZHk6IHtcclxuICAgICAgICAgICAgY29kZSxcclxuICAgICAgICAgICAgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtzdG9yZWRTZXNzaW9uVG9rZW59YCxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChmbkVycm9yIHx8ICFkYXRhPy5zdWNjZXNzKSB7XHJcbiAgICAgICAgICBjb25zdCBlcnJvck1zZyA9IGZuRXJyb3I/Lm1lc3NhZ2UgfHwgZGF0YT8uZXJyb3IgfHwgJ0ZhaWxlZCB0byBleGNoYW5nZSBjb2RlJztcclxuICAgICAgICAgIHNldEVycm9yKGVycm9yTXNnKTtcclxuICAgICAgICAgIHNldFN0YXR1cygnZXJyb3InKTtcclxuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJldHVyblVybDtcclxuICAgICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2V0U3RhdHVzKCdzdWNjZXNzJyk7XHJcblxyXG4gICAgICAgIC8vIFJlZGlyZWN0IGJhY2sgdG8gb3JpZ2luYWwgcGFnZSBhZnRlciBicmllZiBkZWxheVxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXR1cm5Vcmw7XHJcbiAgICAgICAgfSwgMTUwMCk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIGNvbnN0IGVycm9yTXNnID0gZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJztcclxuICAgICAgICBzZXRFcnJvcihlcnJvck1zZyk7XHJcbiAgICAgICAgc2V0U3RhdHVzKCdlcnJvcicpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZXR1cm5Vcmw7XHJcbiAgICAgICAgfSwgMjAwMCk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgaGFuZGxlQ2FsbGJhY2soKTtcclxuICB9LCBbXSk7XHJcblxyXG4gIHJldHVybiB7IHN0YXR1cywgZXJyb3IgfTtcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTLFVBQVUsV0FBVyxtQkFBbUI7QUFDakQsU0FBUyxnQkFBZ0I7QUFDekIsU0FBUyxlQUFlO0FBR3hCLE1BQU0sbUJBQW1CLFlBQVksSUFBSTtBQUN6QyxNQUFNLHNCQUFzQjtBQUFBLEVBQzFCO0FBQUEsRUFDQTtBQUNGLEVBQUUsS0FBSyxHQUFHO0FBa0NWLFNBQVMscUJBQTZCO0FBQ3BDLFFBQU0sUUFBUSxJQUFJLFdBQVcsRUFBRTtBQUMvQixTQUFPLGdCQUFnQixLQUFLO0FBQzVCLFNBQU8sTUFBTSxLQUFLLE9BQU8sQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUFFLEVBQUUsU0FBUyxHQUFHLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRTtBQUNoRjtBQUtBLFNBQVMsbUJBQW1CLEtBQWtGO0FBQzVHLFFBQU0sWUFBWSxJQUFJLGdCQUFnQixJQUFJLElBQUksR0FBRyxFQUFFLE1BQU07QUFDekQsU0FBTztBQUFBLElBQ0wsTUFBTSxVQUFVLElBQUksTUFBTTtBQUFBLElBQzFCLE9BQU8sVUFBVSxJQUFJLE9BQU87QUFBQSxJQUM1QixPQUFPLFVBQVUsSUFBSSxPQUFPO0FBQUEsRUFDOUI7QUFDRjtBQUVPLGFBQU0sZ0JBQWdCLE1BQU07QUFDakMsUUFBTSxFQUFFLE1BQU0sUUFBUSxJQUFJLFFBQVE7QUFDbEMsUUFBTSxDQUFDLE9BQU8sUUFBUSxJQUFJLFNBQTBCO0FBQUEsSUFDbEQsa0JBQWtCO0FBQUEsSUFDbEIsWUFBWTtBQUFBLElBQ1osYUFBYTtBQUFBLElBQ2IsWUFBWTtBQUFBLElBQ1osV0FBVztBQUFBLElBQ1gsT0FBTztBQUFBLEVBQ1QsQ0FBQztBQUtELFFBQU0sdUJBQXVCLFlBQVksWUFBWTtBQUNuRCxRQUFJLENBQUMsTUFBTSxJQUFJO0FBQ2IsZUFBUyxDQUFDLFVBQVU7QUFBQSxRQUNsQixHQUFHO0FBQUEsUUFDSCxrQkFBa0I7QUFBQSxRQUNsQixZQUFZO0FBQUEsUUFDWixhQUFhO0FBQUEsUUFDYixZQUFZO0FBQUEsUUFDWixXQUFXO0FBQUEsTUFDYixFQUFFO0FBQ0Y7QUFBQSxJQUNGO0FBRUEsUUFBSTtBQUNGLGVBQVMsQ0FBQyxVQUFVLEVBQUUsR0FBRyxNQUFNLFdBQVcsTUFBTSxPQUFPLEtBQUssRUFBRTtBQUU5RCxZQUFNLEVBQUUsTUFBTSxNQUFNLElBQUksTUFBTSxTQUMzQixLQUFLLG9CQUFvQixFQUN6QixPQUFPLDZDQUE2QyxFQUNwRCxHQUFHLFdBQVcsS0FBSyxFQUFFLEVBQ3JCLE9BQU87QUFFVixVQUFJLE9BQU87QUFFVCxZQUFJLE1BQU0sU0FBUyxZQUFZO0FBQzdCLG1CQUFTLENBQUMsVUFBVTtBQUFBLFlBQ2xCLEdBQUc7QUFBQSxZQUNILGtCQUFrQjtBQUFBLFlBQ2xCLFlBQVk7QUFBQSxZQUNaLGFBQWE7QUFBQSxZQUNiLFlBQVk7QUFBQSxZQUNaLFdBQVc7QUFBQSxVQUNiLEVBQUU7QUFDRjtBQUFBLFFBQ0Y7QUFDQSxjQUFNO0FBQUEsTUFDUjtBQUVBLFlBQU0sY0FBYztBQUNwQixlQUFTLENBQUMsVUFBVTtBQUFBLFFBQ2xCLEdBQUc7QUFBQSxRQUNILGtCQUFrQixZQUFZO0FBQUEsUUFDOUIsWUFBWSxZQUFZLFdBQVcsWUFBWSxRQUFRO0FBQUEsUUFDdkQsYUFBYSxZQUFZO0FBQUEsUUFDekIsWUFBWSxZQUFZO0FBQUEsUUFDeEIsV0FBVztBQUFBLE1BQ2IsRUFBRTtBQUFBLElBQ0osU0FBUyxLQUFLO0FBQ1osY0FBUSxNQUFNLDhDQUE4QyxHQUFHO0FBQy9ELGVBQVMsQ0FBQyxVQUFVO0FBQUEsUUFDbEIsR0FBRztBQUFBLFFBQ0gsa0JBQWtCO0FBQUEsUUFDbEIsWUFBWTtBQUFBLFFBQ1osV0FBVztBQUFBLFFBQ1gsT0FBTyxlQUFlLFFBQVEsSUFBSSxVQUFVO0FBQUEsTUFDOUMsRUFBRTtBQUFBLElBQ0o7QUFBQSxFQUNGLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUtiLFlBQVUsTUFBTTtBQUNkLHlCQUFxQjtBQUFBLEVBQ3ZCLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQztBQU16QixRQUFNLGVBQWUsWUFBWSxZQUE4QjtBQUM3RCxRQUFJLENBQUMsa0JBQWtCO0FBQ3JCLGVBQVMsQ0FBQyxVQUFVO0FBQUEsUUFDbEIsR0FBRztBQUFBLFFBQ0gsT0FBTztBQUFBLE1BQ1QsRUFBRTtBQUNGLGFBQU87QUFBQSxJQUNUO0FBRUEsUUFBSSxDQUFDLFNBQVMsY0FBYztBQUMxQixlQUFTLENBQUMsVUFBVTtBQUFBLFFBQ2xCLEdBQUc7QUFBQSxRQUNILE9BQU87QUFBQSxNQUNULEVBQUU7QUFDRixhQUFPO0FBQUEsSUFDVDtBQUVBLGFBQVMsQ0FBQyxVQUFVLEVBQUUsR0FBRyxNQUFNLE9BQU8sS0FBSyxFQUFFO0FBRzdDLFVBQU0sYUFBYSxtQkFBbUI7QUFDdEMsVUFBTSxjQUFjLEdBQUcsT0FBTyxTQUFTLE1BQU07QUFHN0MsaUJBQWEsUUFBUSxxQkFBcUIsVUFBVTtBQUNwRCxpQkFBYSxRQUFRLDZCQUE2QixRQUFRLFlBQVk7QUFDdEUsaUJBQWEsUUFBUSwwQkFBMEIsT0FBTyxTQUFTLElBQUk7QUFHbkUsVUFBTSxVQUFVLElBQUksSUFBSSw4Q0FBOEM7QUFDdEUsWUFBUSxhQUFhLElBQUksYUFBYSxnQkFBZ0I7QUFDdEQsWUFBUSxhQUFhLElBQUksZ0JBQWdCLFdBQVc7QUFDcEQsWUFBUSxhQUFhLElBQUksaUJBQWlCLE1BQU07QUFDaEQsWUFBUSxhQUFhLElBQUksU0FBUyxtQkFBbUI7QUFDckQsWUFBUSxhQUFhLElBQUksU0FBUyxVQUFVO0FBQzVDLFlBQVEsYUFBYSxJQUFJLGVBQWUsU0FBUztBQUNqRCxZQUFRLGFBQWEsSUFBSSxVQUFVLFNBQVM7QUFHNUMsV0FBTyxTQUFTLE9BQU8sUUFBUSxTQUFTO0FBRXhDLFdBQU87QUFBQSxFQUNULEdBQUcsQ0FBQyxTQUFTLFlBQVksQ0FBQztBQU0xQixRQUFNLHNCQUFzQjtBQUFBLElBQzFCLE9BQU8sZ0JBQXVFO0FBQzVFLFlBQU0sRUFBRSxNQUFNLE9BQU8sZUFBZSxPQUFPLFdBQVcsSUFBSSxtQkFBbUIsV0FBVztBQUV4RixVQUFJLFlBQVk7QUFDZCxlQUFPLEVBQUUsU0FBUyxPQUFPLE9BQU8sZ0JBQWdCLFVBQVUsR0FBRztBQUFBLE1BQy9EO0FBRUEsVUFBSSxDQUFDLE1BQU07QUFDVCxlQUFPLEVBQUUsU0FBUyxPQUFPLE9BQU8saUNBQWlDO0FBQUEsTUFDbkU7QUFHQSxZQUFNLGNBQWMsYUFBYSxRQUFRLG1CQUFtQjtBQUM1RCxZQUFNLHFCQUFxQixhQUFhLFFBQVEsMkJBQTJCO0FBRTNFLFVBQUksQ0FBQyxlQUFlLGdCQUFnQixlQUFlO0FBQ2pELGVBQU8sRUFBRSxTQUFTLE9BQU8sT0FBTyxpREFBaUQ7QUFBQSxNQUNuRjtBQUVBLFVBQUksQ0FBQyxvQkFBb0I7QUFDdkIsZUFBTyxFQUFFLFNBQVMsT0FBTyxPQUFPLHFDQUFxQztBQUFBLE1BQ3ZFO0FBR0EsbUJBQWEsV0FBVyxtQkFBbUI7QUFDM0MsbUJBQWEsV0FBVywyQkFBMkI7QUFFbkQsVUFBSTtBQUNGLGNBQU0sY0FBYyxHQUFHLE9BQU8sU0FBUyxNQUFNO0FBSzdDLGNBQU0sRUFBRSxNQUFNLE1BQU0sSUFBSSxNQUFNLFNBQVMsVUFBVSxPQUFPLHVCQUF1QjtBQUFBLFVBQzdFLE1BQU07QUFBQSxZQUNKO0FBQUEsWUFDQSxjQUFjO0FBQUEsVUFDaEI7QUFBQSxVQUNBLFNBQVM7QUFBQSxZQUNQLGVBQWUsVUFBVSxrQkFBa0I7QUFBQSxVQUM3QztBQUFBLFFBQ0YsQ0FBQztBQUVELFlBQUksT0FBTztBQUNULGtCQUFRLE1BQU0seUNBQXlDLEtBQUs7QUFDNUQsaUJBQU8sRUFBRSxTQUFTLE9BQU8sT0FBTyxNQUFNLFdBQVcsd0NBQXdDO0FBQUEsUUFDM0Y7QUFFQSxZQUFJLENBQUMsTUFBTSxTQUFTO0FBQ2xCLGlCQUFPLEVBQUUsU0FBUyxPQUFPLE9BQU8sTUFBTSxTQUFTLDBCQUEwQjtBQUFBLFFBQzNFO0FBRUEsZUFBTyxFQUFFLFNBQVMsS0FBSztBQUFBLE1BQ3pCLFNBQVMsS0FBSztBQUNaLGdCQUFRLE1BQU0sbUNBQW1DLEdBQUc7QUFDcEQsZUFBTztBQUFBLFVBQ0wsU0FBUztBQUFBLFVBQ1QsT0FBTyxlQUFlLFFBQVEsSUFBSSxVQUFVO0FBQUEsUUFDOUM7QUFBQSxNQUNGO0FBQUEsSUFDRjtBQUFBLElBQ0EsQ0FBQztBQUFBLEVBQ0g7QUFLQSxRQUFNLGtCQUFrQixZQUFZLFlBQThCO0FBQ2hFLFFBQUksQ0FBQyxNQUFNLElBQUk7QUFDYixlQUFTLENBQUMsVUFBVTtBQUFBLFFBQ2xCLEdBQUc7QUFBQSxRQUNILE9BQU87QUFBQSxNQUNULEVBQUU7QUFDRixhQUFPO0FBQUEsSUFDVDtBQUVBLFFBQUk7QUFDRixlQUFTLENBQUMsVUFBVSxFQUFFLEdBQUcsTUFBTSxXQUFXLE1BQU0sT0FBTyxLQUFLLEVBQUU7QUFFOUQsWUFBTSxFQUFFLE1BQU0sSUFBSSxNQUFNLFNBQ3JCLEtBQUssb0JBQW9CLEVBQ3pCLE9BQU8sRUFDUCxHQUFHLFdBQVcsS0FBSyxFQUFFO0FBRXhCLFVBQUksT0FBTztBQUNULGNBQU07QUFBQSxNQUNSO0FBRUEsZUFBUztBQUFBLFFBQ1Asa0JBQWtCO0FBQUEsUUFDbEIsWUFBWTtBQUFBLFFBQ1osYUFBYTtBQUFBLFFBQ2IsWUFBWTtBQUFBLFFBQ1osV0FBVztBQUFBLFFBQ1gsT0FBTztBQUFBLE1BQ1QsQ0FBQztBQUVELGFBQU87QUFBQSxJQUNULFNBQVMsS0FBSztBQUNaLGNBQVEsTUFBTSxxQ0FBcUMsR0FBRztBQUN0RCxlQUFTLENBQUMsVUFBVTtBQUFBLFFBQ2xCLEdBQUc7QUFBQSxRQUNILFdBQVc7QUFBQSxRQUNYLE9BQU8sZUFBZSxRQUFRLElBQUksVUFBVTtBQUFBLE1BQzlDLEVBQUU7QUFDRixhQUFPO0FBQUEsSUFDVDtBQUFBLEVBQ0YsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBTWIsUUFBTSxjQUFjO0FBQUEsSUFDbEIsT0FDRSxJQUNBLFNBQ0EsTUFDQSxnQkFDK0I7QUFDL0IsVUFBSSxDQUFDLFNBQVMsY0FBYztBQUMxQixlQUFPLEVBQUUsU0FBUyxPQUFPLE9BQU8sMENBQTBDO0FBQUEsTUFDNUU7QUFFQSxVQUFJLENBQUMsTUFBTSxrQkFBa0I7QUFDM0IsZUFBTyxFQUFFLFNBQVMsT0FBTyxPQUFPLG1FQUFtRTtBQUFBLE1BQ3JHO0FBRUEsVUFBSTtBQUNGLGNBQU0sRUFBRSxNQUFNLE1BQU0sSUFBSSxNQUFNLFNBQVMsVUFBVSxPQUFPLHNCQUFzQjtBQUFBLFVBQzVFLE1BQU07QUFBQSxZQUNKO0FBQUEsWUFDQTtBQUFBLFlBQ0E7QUFBQSxZQUNBO0FBQUEsVUFDRjtBQUFBLFVBQ0EsU0FBUztBQUFBLFlBQ1AsZUFBZSxVQUFVLFFBQVEsWUFBWTtBQUFBLFVBQy9DO0FBQUEsUUFDRixDQUFDO0FBRUQsWUFBSSxPQUFPO0FBQ1Qsa0JBQVEsTUFBTSx1Q0FBdUMsS0FBSztBQUMxRCxpQkFBTyxFQUFFLFNBQVMsT0FBTyxPQUFPLE1BQU0sV0FBVyx5QkFBeUI7QUFBQSxRQUM1RTtBQUVBLFlBQUksQ0FBQyxNQUFNLFNBQVM7QUFFbEIsY0FBSSxNQUFNLE9BQU8sU0FBUyxXQUFXLEtBQUssTUFBTSxPQUFPLFNBQVMsU0FBUyxHQUFHO0FBQzFFLGtCQUFNLHFCQUFxQjtBQUFBLFVBQzdCO0FBQ0EsaUJBQU8sRUFBRSxTQUFTLE9BQU8sT0FBTyxNQUFNLFNBQVMseUJBQXlCO0FBQUEsUUFDMUU7QUFFQSxlQUFPO0FBQUEsVUFDTCxTQUFTO0FBQUEsVUFDVCxTQUFTLEtBQUs7QUFBQSxVQUNkLFNBQVMsS0FBSztBQUFBLFFBQ2hCO0FBQUEsTUFDRixTQUFTLEtBQUs7QUFDWixnQkFBUSxNQUFNLHVDQUF1QyxHQUFHO0FBQ3hELGVBQU87QUFBQSxVQUNMLFNBQVM7QUFBQSxVQUNULE9BQU8sZUFBZSxRQUFRLElBQUksVUFBVTtBQUFBLFFBQzlDO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFBQSxJQUNBLENBQUMsU0FBUyxjQUFjLE1BQU0sa0JBQWtCLG9CQUFvQjtBQUFBLEVBQ3RFO0FBS0EsUUFBTSxhQUFhLFlBQVksTUFBTTtBQUNuQyxhQUFTLENBQUMsVUFBVSxFQUFFLEdBQUcsTUFBTSxPQUFPLEtBQUssRUFBRTtBQUFBLEVBQy9DLEdBQUcsQ0FBQyxDQUFDO0FBRUwsU0FBTztBQUFBO0FBQUEsSUFFTCxrQkFBa0IsTUFBTTtBQUFBLElBQ3hCLFlBQVksTUFBTTtBQUFBLElBQ2xCLGFBQWEsTUFBTTtBQUFBLElBQ25CLFlBQVksTUFBTTtBQUFBLElBQ2xCLFdBQVcsTUFBTTtBQUFBLElBQ2pCLE9BQU8sTUFBTTtBQUFBO0FBQUEsSUFHYjtBQUFBLElBQ0E7QUFBQSxJQUNBO0FBQUEsSUFDQTtBQUFBLElBQ0E7QUFBQSxJQUNBO0FBQUEsRUFDRjtBQUNGO0FBTU8sYUFBTSx3QkFBd0IsTUFBTTtBQUN6QyxRQUFNLENBQUMsUUFBUSxTQUFTLElBQUksU0FBMEMsU0FBUztBQUMvRSxRQUFNLENBQUMsT0FBTyxRQUFRLElBQUksU0FBd0IsSUFBSTtBQUV0RCxZQUFVLE1BQU07QUFDZCxVQUFNLGlCQUFpQixZQUFZO0FBQ2pDLFlBQU0sY0FBYyxPQUFPLFNBQVM7QUFDcEMsWUFBTSxFQUFFLE1BQU0sT0FBTyxlQUFlLE9BQU8sV0FBVyxJQUFJLG1CQUFtQixXQUFXO0FBR3hGLFlBQU0sWUFBWSxhQUFhLFFBQVEsd0JBQXdCLEtBQUs7QUFHcEUsVUFBSSxZQUFZO0FBQ2QsaUJBQVMsdUJBQXVCLFVBQVUsRUFBRTtBQUM1QyxrQkFBVSxPQUFPO0FBRWpCLHFCQUFhLFdBQVcsbUJBQW1CO0FBQzNDLHFCQUFhLFdBQVcsMkJBQTJCO0FBQ25ELHFCQUFhLFdBQVcsd0JBQXdCO0FBQ2hELG1CQUFXLE1BQU07QUFDZixpQkFBTyxTQUFTLE9BQU87QUFBQSxRQUN6QixHQUFHLEdBQUk7QUFDUDtBQUFBLE1BQ0Y7QUFHQSxVQUFJLENBQUMsTUFBTTtBQUNULGlCQUFTLGdDQUFnQztBQUN6QyxrQkFBVSxPQUFPO0FBQ2pCLHFCQUFhLFdBQVcsbUJBQW1CO0FBQzNDLHFCQUFhLFdBQVcsMkJBQTJCO0FBQ25ELHFCQUFhLFdBQVcsd0JBQXdCO0FBQ2hELG1CQUFXLE1BQU07QUFDZixpQkFBTyxTQUFTLE9BQU87QUFBQSxRQUN6QixHQUFHLEdBQUk7QUFDUDtBQUFBLE1BQ0Y7QUFHQSxZQUFNLGNBQWMsYUFBYSxRQUFRLG1CQUFtQjtBQUM1RCxZQUFNLHFCQUFxQixhQUFhLFFBQVEsMkJBQTJCO0FBRTNFLFVBQUksQ0FBQyxlQUFlLGdCQUFnQixlQUFlO0FBQ2pELGlCQUFTLHlCQUF5QjtBQUNsQyxrQkFBVSxPQUFPO0FBQ2pCLHFCQUFhLFdBQVcsbUJBQW1CO0FBQzNDLHFCQUFhLFdBQVcsMkJBQTJCO0FBQ25ELHFCQUFhLFdBQVcsd0JBQXdCO0FBQ2hELG1CQUFXLE1BQU07QUFDZixpQkFBTyxTQUFTLE9BQU87QUFBQSxRQUN6QixHQUFHLEdBQUk7QUFDUDtBQUFBLE1BQ0Y7QUFFQSxVQUFJLENBQUMsb0JBQW9CO0FBQ3ZCLGlCQUFTLGlCQUFpQjtBQUMxQixrQkFBVSxPQUFPO0FBQ2pCLHFCQUFhLFdBQVcsbUJBQW1CO0FBQzNDLHFCQUFhLFdBQVcsMkJBQTJCO0FBQ25ELHFCQUFhLFdBQVcsd0JBQXdCO0FBQ2hELG1CQUFXLE1BQU07QUFDZixpQkFBTyxTQUFTLE9BQU87QUFBQSxRQUN6QixHQUFHLEdBQUk7QUFDUDtBQUFBLE1BQ0Y7QUFHQSxtQkFBYSxXQUFXLG1CQUFtQjtBQUMzQyxtQkFBYSxXQUFXLDJCQUEyQjtBQUNuRCxtQkFBYSxXQUFXLHdCQUF3QjtBQUVoRCxVQUFJO0FBQ0YsY0FBTSxjQUFjLEdBQUcsT0FBTyxTQUFTLE1BQU07QUFHN0MsY0FBTSxFQUFFLE1BQU0sT0FBTyxRQUFRLElBQUksTUFBTSxTQUFTLFVBQVUsT0FBTyx1QkFBdUI7QUFBQSxVQUN0RixNQUFNO0FBQUEsWUFDSjtBQUFBLFlBQ0EsY0FBYztBQUFBLFVBQ2hCO0FBQUEsVUFDQSxTQUFTO0FBQUEsWUFDUCxlQUFlLFVBQVUsa0JBQWtCO0FBQUEsVUFDN0M7QUFBQSxRQUNGLENBQUM7QUFFRCxZQUFJLFdBQVcsQ0FBQyxNQUFNLFNBQVM7QUFDN0IsZ0JBQU0sV0FBVyxTQUFTLFdBQVcsTUFBTSxTQUFTO0FBQ3BELG1CQUFTLFFBQVE7QUFDakIsb0JBQVUsT0FBTztBQUNqQixxQkFBVyxNQUFNO0FBQ2YsbUJBQU8sU0FBUyxPQUFPO0FBQUEsVUFDekIsR0FBRyxHQUFJO0FBQ1A7QUFBQSxRQUNGO0FBRUEsa0JBQVUsU0FBUztBQUduQixtQkFBVyxNQUFNO0FBQ2YsaUJBQU8sU0FBUyxPQUFPO0FBQUEsUUFDekIsR0FBRyxJQUFJO0FBQUEsTUFDVCxTQUFTLEtBQUs7QUFDWixjQUFNLFdBQVcsZUFBZSxRQUFRLElBQUksVUFBVTtBQUN0RCxpQkFBUyxRQUFRO0FBQ2pCLGtCQUFVLE9BQU87QUFDakIsbUJBQVcsTUFBTTtBQUNmLGlCQUFPLFNBQVMsT0FBTztBQUFBLFFBQ3pCLEdBQUcsR0FBSTtBQUFBLE1BQ1Q7QUFBQSxJQUNGO0FBRUEsbUJBQWU7QUFBQSxFQUNqQixHQUFHLENBQUMsQ0FBQztBQUVMLFNBQU8sRUFBRSxRQUFRLE1BQU07QUFDekI7IiwibmFtZXMiOltdfQ==